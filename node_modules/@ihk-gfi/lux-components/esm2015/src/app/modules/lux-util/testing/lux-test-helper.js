import { SPACE } from '@angular/cdk/keycodes';
import { CommonModule } from '@angular/common';
import { getTestBed, TestBed, tick } from '@angular/core/testing';
import { FlexLayoutModule } from '@angular/flex-layout';
import { FormsModule, ReactiveFormsModule } from '@angular/forms';
import { MatAutocompleteModule, MatBadgeModule, MatButtonModule, MatCardModule, MatCheckboxModule, MatChipsModule, MatCommonModule, MatDatepickerModule, MatDividerModule, MatExpansionModule, MatFormFieldModule, MatIconModule, MatInputModule, MatNativeDateModule, MatOptionModule, MatPaginatorModule, MatProgressBarModule, MatProgressSpinnerModule, MatRadioModule, MatSelectModule, MatSliderModule, MatSortModule, MatStepperModule, MatTableModule, MatTabsModule, MatTooltipModule } from '@angular/material';
import { BrowserModule, By } from '@angular/platform-browser';
import { NoopAnimationsModule } from '@angular/platform-browser/animations';
import { RouterModule } from '@angular/router';
import { LuxActionModule } from '../../lux-action/lux-action.module';
import { LuxDirectivesModule } from '../../lux-directives/lux-directives.module';
import { LuxFormModule } from '../../lux-form/lux-form.module';
import { LuxIconModule } from '../../lux-icon/lux-icon.module';
import { LuxLayoutModule } from '../../lux-layout/lux-layout.module';
import { LuxPipesModule } from '../../lux-pipes/lux-pipes.module';
import { LuxLookupModule } from '../../lux-lookup/lux-lookup.module';
import { RouterTestingModule } from '@angular/router/testing';
import { LuxComponentsConfigModule } from '../../lux-components-config/lux-components-config.module';
import { LuxErrorModule } from '../../lux-error/lux-error.module';
import { LuxCommonModule } from '../../lux-common/lux-common.module';
import { LuxPopupsModule } from '../../lux-popups/lux-popups.module';
export class LuxTestHelper {
    /**
     * Wichtig: aus fakeAsync-Block heraus aufrufen, da hier tick() genutzt wird.
     */
    static setInputValue(input, value, fixture) {
        if (input) {
            input.value = value;
            input.dispatchEvent(LuxTestHelper.createFakeEvent('input'));
            LuxTestHelper.wait(fixture);
        }
        else {
            console.error('UNIT-TEST FEHLER: input ist nicht definiert.');
        }
    }
    /**
     * Wichtig: aus fakeAsync-Block heraus aufrufen, da hier tick() genutzt wird.
     * Wartet asynchrone Aufrufe ab und ruft die ChangeDetection auf
     * @param fixture
     * @param tickDuration
     */
    static wait(fixture, tickDuration) {
        fixture.detectChanges();
        tick(tickDuration);
        fixture.detectChanges();
    }
    /**
     * Wichtig: aus fakeAsync-Block heraus aufrufen, da hier tick() genutzt wird.
     * Sendet ein Klick-Event ab und wartet dann.
     * @param fixture
     * @param DebugElement
     */
    static click(fixture, debugElement) {
        debugElement.triggerEventHandler('click', null);
        LuxTestHelper.wait(fixture);
    }
    /**
     * Wichtig: aus fakeAsync-Block heraus aufrufen, da hier tick() genutzt wird.
     * Sendet ein Change-Event ab und wartet dann.
     * @param fixture
     * @param DebugElement
     */
    static radioButtonChange(fixture, radioButton) {
        radioButton.nativeElement.dispatchEvent(LuxTestHelper.createFakeEvent('change'));
        LuxTestHelper.wait(fixture);
    }
    /**
     * Erstellt eine ComponentFixture fuer die mitgegebene Komponente, optional ist es moeglich
     * weitere Provider und Declarations einzutragen. Diese werden dann im Testmodul eingetragen.
     * @param component
     * @param providers
     * @param declarations
     * @deprecated Stattdessen configureTestModule in Kombination mit configureTestSuite verwenden --> erheblich performanter
     */
    static createComponent(component, providers = [], declarations = []) {
        TestBed.configureTestingModule({
            imports: [
                ...LuxTestHelper.COMMON_ANGULAR_MODULES,
                ...LuxTestHelper.MATERIAL_MODULES,
                ...LuxTestHelper.LUX_MODULES
            ],
            declarations: [...declarations, component],
            providers: [...providers]
        });
        TestBed.compileComponents();
        return TestBed.createComponent(component);
    }
    /** Utility to dispatch any event on a Node. */
    static dispatchEvent(node, event) {
        node.dispatchEvent(event);
        return event;
    }
    /** Shorthand to dispatch a fake event on a specified node. */
    static dispatchFakeEvent(node, type, canBubble) {
        return LuxTestHelper.dispatchEvent(node, LuxTestHelper.createFakeEvent(type, canBubble));
    }
    /** Shorthand to dispatch a keyboard event with a specified key code. */
    static dispatchKeyboardEvent(node, type, keyCode, target) {
        return LuxTestHelper.dispatchEvent(node, LuxTestHelper.createKeyboardEvent(type, keyCode, target));
    }
    /** Focuses an input and sets its value. Dispatches an fake input event afterwards. */
    static typeInElement(element, value, noInputEvent) {
        element.focus();
        element.value = value;
        if (!noInputEvent) {
            LuxTestHelper.dispatchFakeEvent(element, 'input');
        }
    }
    /** Steuerung und triggern von Overlays implementieren **/
    /**
     * Inserts data into an input field, that has to update asynchrounos before calling a callback-function
     * Allows to use RxJs Interval-Timers within the Target-Components.
     */
    static typeInElementAsynch(text, fixture, element, callback) {
        fixture.whenStable().then(() => {
            LuxTestHelper.typeInElement(element, text);
            fixture.detectChanges();
            fixture.whenStable().then(() => {
                LuxTestHelper.dispatchKeyboardEvent(element, 'keydown', SPACE);
                fixture.detectChanges();
                fixture.whenStable().then(() => {
                    callback();
                });
            });
        });
    }
    /** Dispatches a keydown event from an element. */
    static createKeyboardEvent(type, keyCode, target, key) {
        const event = document.createEvent('KeyboardEvent');
        // Firefox does not support `initKeyboardEvent`, but supports `initKeyEvent`.
        const initEventFn = (event.initKeyEvent || event.initKeyboardEvent).bind(event);
        const originalPreventDefault = event.preventDefault;
        initEventFn(type, true, true, window, 0, 0, 0, 0, 0, keyCode);
        // Webkit Browsers don't set the keyCode when calling the init function.
        // See related bug https://bugs.webkit.org/show_bug.cgi?id=16735
        Object.defineProperties(event, {
            keyCode: { get: () => keyCode },
            key: { get: () => key },
            target: { get: () => target }
        });
        // IE won't set `defaultPrevented` on synthetic events so we need to do it manually.
        event.preventDefault = function () {
            Object.defineProperty(event, 'defaultPrevented', { get: () => true });
            return originalPreventDefault.apply(this, arguments);
        };
        return event;
    }
    /** Creates a fake event object with any desired event type. */
    static createFakeEvent(type, canBubble = false, cancelable = true) {
        let event;
        if (typeof Event === 'function') {
            event = new Event(type);
        }
        else {
            event = document.createEvent('Event');
            event.initEvent(type, canBubble, cancelable);
        }
        return event;
    }
    /**
     * Selektiert ein Element anhand der Query von dem Fixture
     */
    static selectOneFromFixture(fixture, query) {
        return fixture.debugElement.query(By.css(query));
    }
    /**
     * Selektiert ein Array von Elementen anhand der Query von dem Fixture
     */
    static selectAllFromFixture(fixture, query) {
        return fixture.debugElement.queryAll(By.css(query));
    }
    /**
     * Entfernt nicht-ASCII-Chars aus dem String (Beim IE wichtig, dieser fügt gerne versteckte Steuerzeichen
     * in Input-Feldern an die Strings).
     * @param dateString
     */
    static stringWithoutASCIIChars(dateString) {
        const exp = new RegExp('[^A-Za-z 0-9 \\.,\\?""!@#\\$%\\^&\\*\\(\\)-_=\\+;:<>\\/\\\\\\|\\}\\{\\[\\]`~]*', 'g');
        return dateString.replace(exp, '');
    }
    /**
     *  Deaktiviert den Reset des Testmoduls am Ende eines Testdurchlaufs.
     *  Verbessert die Performance der Karma-Tests erheblich.
     *  Am Ende der Testsuite wird diese Funktion wieder aktiviert.
     *
     *  Funktion dafür einfach am Anfang einer Testsuite (erstes describe) aufrufen und in einem beforeAll das Testmodul
     *  erzeugen. Dieses wird nun nicht mehr nach jedem Test neu erzeugt.
     */
    static configureTestSuite() {
        const testBedApi = getTestBed();
        const originReset = TestBed.resetTestingModule;
        beforeAll(() => {
            TestBed.resetTestingModule();
            TestBed.resetTestingModule = () => TestBed;
        });
        afterEach(() => {
            testBedApi._activeFixtures.forEach((fixture) => fixture.destroy());
            testBedApi._instantiated = false;
        });
        afterAll(() => {
            TestBed.resetTestingModule = originReset;
            TestBed.resetTestingModule();
        });
    }
    /**
     * Konfiguriert das TestModul für eine Testsuite, kann dabei Provider und Komponenten (Deklarationen) entgegennehmen.
     * @param providers
     * @param declarations
     * @param imports
     */
    static configureTestModule(providers = [], declarations = [], imports = []) {
        TestBed.configureTestingModule({
            imports: [
                ...LuxTestHelper.COMMON_ANGULAR_MODULES,
                ...LuxTestHelper.MATERIAL_MODULES,
                ...LuxTestHelper.LUX_MODULES,
                ...imports
            ],
            declarations: [...declarations],
            providers: [...providers]
        });
        TestBed.compileComponents();
    }
    /**
     * Erstellt ein leeres File-Objekt mit Namen und Typ via Blob-Constructor (um Edge/IE-Fehler zu vermeiden).
     * @param name
     * @param type
     */
    static createFileBrowserSafe(name, type) {
        const file = new Blob([''], { type: type });
        file['name'] = name;
        return file;
    }
}
LuxTestHelper.COMMON_ANGULAR_MODULES = [
    NoopAnimationsModule,
    CommonModule,
    RouterModule,
    FormsModule,
    ReactiveFormsModule,
    FlexLayoutModule,
    BrowserModule,
    RouterTestingModule
];
LuxTestHelper.MATERIAL_MODULES = [
    MatButtonModule,
    MatCardModule,
    MatIconModule,
    MatFormFieldModule,
    MatTabsModule,
    MatTooltipModule,
    MatChipsModule,
    MatProgressSpinnerModule,
    MatProgressBarModule,
    MatExpansionModule,
    MatStepperModule,
    MatTableModule,
    MatPaginatorModule,
    MatSortModule,
    MatDividerModule,
    MatSelectModule,
    MatInputModule,
    MatCheckboxModule,
    MatRadioModule,
    MatDatepickerModule,
    MatNativeDateModule,
    MatAutocompleteModule,
    MatSliderModule,
    MatOptionModule,
    MatCommonModule,
    MatBadgeModule
];
LuxTestHelper.LUX_MODULES = [
    LuxFormModule,
    LuxLayoutModule,
    LuxActionModule,
    LuxDirectivesModule,
    LuxPipesModule,
    LuxIconModule,
    LuxLookupModule,
    LuxErrorModule,
    LuxCommonModule,
    LuxPopupsModule,
    LuxComponentsConfigModule.forRoot({
        generateLuxTagIds: false,
        displayLuxConsoleLogs: true,
        labelConfiguration: {
            allUppercase: true,
            notAppliedTo: []
        },
        cardExpansionAnimationActive: true
    })
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibHV4LXRlc3QtaGVscGVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGloay1nZmkvbHV4LWNvbXBvbmVudHMvIiwic291cmNlcyI6WyJzcmMvYXBwL21vZHVsZXMvbHV4LXV0aWwvdGVzdGluZy9sdXgtdGVzdC1oZWxwZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzlDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUUvQyxPQUFPLEVBQW9CLFVBQVUsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDcEYsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDeEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2xFLE9BQU8sRUFDTCxxQkFBcUIsRUFDckIsY0FBYyxFQUNkLGVBQWUsRUFDZixhQUFhLEVBQ2IsaUJBQWlCLEVBQ2pCLGNBQWMsRUFDZCxlQUFlLEVBQ2YsbUJBQW1CLEVBQ25CLGdCQUFnQixFQUNoQixrQkFBa0IsRUFDbEIsa0JBQWtCLEVBQ2xCLGFBQWEsRUFDYixjQUFjLEVBQ2QsbUJBQW1CLEVBQ25CLGVBQWUsRUFDZixrQkFBa0IsRUFDbEIsb0JBQW9CLEVBQ3BCLHdCQUF3QixFQUN4QixjQUFjLEVBQ2QsZUFBZSxFQUNmLGVBQWUsRUFDZixhQUFhLEVBQ2IsZ0JBQWdCLEVBQ2hCLGNBQWMsRUFDZCxhQUFhLEVBQ2IsZ0JBQWdCLEVBQ2pCLE1BQU0sbUJBQW1CLENBQUM7QUFDM0IsT0FBTyxFQUFFLGFBQWEsRUFBRSxFQUFFLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUM5RCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUM1RSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0Ms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QUFtQjtJQUNuQixjQUFjO0lBQ2QsYUFBYTtJQUNiLGVBQWU7SUFDZixjQUFjO0lBQ2QsZUFBZTtJQUNmLGVBQWU7SUFDZix5QkFBeUIsQ0FBQyxPQUFPLENBQUM7UUFDaEMsaUJBQWlCLEVBQUUsS0FBSztRQUN4QixxQkFBcUIsRUFBRSxJQUFJO1FBQzNCLGtCQUFrQixFQUFFO1lBQ2xCLFlBQVksRUFBRSxJQUFJO1lBQ2xCLFlBQVksRUFBRSxFQUFFO1NBQ2pCO1FBQ0QsNEJBQTRCLEVBQUUsSUFBSTtLQUNuQyxDQUFDO0NBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFNQQUNFIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2tleWNvZGVzJztcbmltcG9ydCB7IENvbW1vbk1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBEZWJ1Z0VsZW1lbnQsIFByb3ZpZGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb21wb25lbnRGaXh0dXJlLCBnZXRUZXN0QmVkLCBUZXN0QmVkLCB0aWNrIH0gZnJvbSAnQGFuZ3VsYXIvY29yZS90ZXN0aW5nJztcbmltcG9ydCB7IEZsZXhMYXlvdXRNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9mbGV4LWxheW91dCc7XG5pbXBvcnQgeyBGb3Jtc01vZHVsZSwgUmVhY3RpdmVGb3Jtc01vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7XG4gIE1hdEF1dG9jb21wbGV0ZU1vZHVsZSxcbiAgTWF0QmFkZ2VNb2R1bGUsXG4gIE1hdEJ1dHRvbk1vZHVsZSxcbiAgTWF0Q2FyZE1vZHVsZSxcbiAgTWF0Q2hlY2tib3hNb2R1bGUsXG4gIE1hdENoaXBzTW9kdWxlLFxuICBNYXRDb21tb25Nb2R1bGUsXG4gIE1hdERhdGVwaWNrZXJNb2R1bGUsXG4gIE1hdERpdmlkZXJNb2R1bGUsXG4gIE1hdEV4cGFuc2lvbk1vZHVsZSxcbiAgTWF0Rm9ybUZpZWxkTW9kdWxlLFxuICBNYXRJY29uTW9kdWxlLFxuICBNYXRJbnB1dE1vZHVsZSxcbiAgTWF0TmF0aXZlRGF0ZU1vZHVsZSxcbiAgTWF0T3B0aW9uTW9kdWxlLFxuICBNYXRQYWdpbmF0b3JNb2R1bGUsXG4gIE1hdFByb2dyZXNzQmFyTW9kdWxlLFxuICBNYXRQcm9ncmVzc1NwaW5uZXJNb2R1bGUsXG4gIE1hdFJhZGlvTW9kdWxlLFxuICBNYXRTZWxlY3RNb2R1bGUsXG4gIE1hdFNsaWRlck1vZHVsZSxcbiAgTWF0U29ydE1vZHVsZSxcbiAgTWF0U3RlcHBlck1vZHVsZSxcbiAgTWF0VGFibGVNb2R1bGUsXG4gIE1hdFRhYnNNb2R1bGUsXG4gIE1hdFRvb2x0aXBNb2R1bGVcbn0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xuaW1wb3J0IHsgQnJvd3Nlck1vZHVsZSwgQnkgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcbmltcG9ydCB7IE5vb3BBbmltYXRpb25zTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlci9hbmltYXRpb25zJztcbmltcG9ydCB7IFJvdXRlck1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBMdXhBY3Rpb25Nb2R1bGUgfSBmcm9tICcuLi8uLi9sdXgtYWN0aW9uL2x1eC1hY3Rpb24ubW9kdWxlJztcbmltcG9ydCB7IEx1eERpcmVjdGl2ZXNNb2R1bGUgfSBmcm9tICcuLi8uLi9sdXgtZGlyZWN0aXZlcy9sdXgtZGlyZWN0aXZlcy5tb2R1bGUnO1xuaW1wb3J0IHsgTHV4Rm9ybU1vZHVsZSB9IGZyb20gJy4uLy4uL2x1eC1mb3JtL2x1eC1mb3JtLm1vZHVsZSc7XG5pbXBvcnQgeyBMdXhJY29uTW9kdWxlIH0gZnJvbSAnLi4vLi4vbHV4LWljb24vbHV4LWljb24ubW9kdWxlJztcbmltcG9ydCB7IEx1eExheW91dE1vZHVsZSB9IGZyb20gJy4uLy4uL2x1eC1sYXlvdXQvbHV4LWxheW91dC5tb2R1bGUnO1xuaW1wb3J0IHsgTHV4UGlwZXNNb2R1bGUgfSBmcm9tICcuLi8uLi9sdXgtcGlwZXMvbHV4LXBpcGVzLm1vZHVsZSc7XG5pbXBvcnQgeyBMdXhMb29rdXBNb2R1bGUgfSBmcm9tICcuLi8uLi9sdXgtbG9va3VwL2x1eC1sb29rdXAubW9kdWxlJztcbmltcG9ydCB7IFJvdXRlclRlc3RpbmdNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXIvdGVzdGluZyc7XG5pbXBvcnQgeyBMdXhDb21wb25lbnRzQ29uZmlnTW9kdWxlIH0gZnJvbSAnLi4vLi4vbHV4LWNvbXBvbmVudHMtY29uZmlnL2x1eC1jb21wb25lbnRzLWNvbmZpZy5tb2R1bGUnO1xuLy8gV2ljaHRpZywgZGFtaXQgZGllIFRlc3RoZWxwZXItRnVua3Rpb24gXCJjb25maWd1cmVUZXN0U3VpdGVcIiBmdW5rdGlvbmllcnQgKGRhcmYgbmljaHQgd2VnZm9ybWF0aWVydCB3ZXJkZW4pLlxuLy8gaW1wb3J0ICdqYXNtaW5lJyBoYXQgbGVpZGVyIG5pY2h0IGRlbiBnZXfDvG5zY2h0ZW4gRWZmZWt0LlxuLy8gaW1wb3J0IHt9IGZyb20gJ2phc21pbmUnO1xuLy8gbm9pbnNwZWN0aW9uIEVTNlVudXNlZEltcG9ydHNcbmltcG9ydCB7fSBmcm9tICdqYXNtaW5lJztcbmltcG9ydCB7IEx1eEVycm9yTW9kdWxlIH0gZnJvbSAnLi4vLi4vbHV4LWVycm9yL2x1eC1lcnJvci5tb2R1bGUnO1xuaW1wb3J0IHsgTHV4Q29tbW9uTW9kdWxlIH0gZnJvbSAnLi4vLi4vbHV4LWNvbW1vbi9sdXgtY29tbW9uLm1vZHVsZSc7XG5pbXBvcnQgeyBMdXhQb3B1cHNNb2R1bGUgfSBmcm9tICcuLi8uLi9sdXgtcG9wdXBzL2x1eC1wb3B1cHMubW9kdWxlJztcblxuZXhwb3J0IGNsYXNzIEx1eFRlc3RIZWxwZXIge1xuICBwdWJsaWMgc3RhdGljIENPTU1PTl9BTkdVTEFSX01PRFVMRVM6IGFueVtdID0gW1xuICAgIE5vb3BBbmltYXRpb25zTW9kdWxlLFxuICAgIENvbW1vbk1vZHVsZSxcbiAgICBSb3V0ZXJNb2R1bGUsXG4gICAgRm9ybXNNb2R1bGUsXG4gICAgUmVhY3RpdmVGb3Jtc01vZHVsZSxcbiAgICBGbGV4TGF5b3V0TW9kdWxlLFxuICAgIEJyb3dzZXJNb2R1bGUsXG4gICAgUm91dGVyVGVzdGluZ01vZHVsZVxuICBdO1xuXG4gIHB1YmxpYyBzdGF0aWMgTUFURVJJQUxfTU9EVUxFUzogYW55W10gPSBbXG4gICAgTWF0QnV0dG9uTW9kdWxlLFxuICAgIE1hdENhcmRNb2R1bGUsXG4gICAgTWF0SWNvbk1vZHVsZSxcbiAgICBNYXRGb3JtRmllbGRNb2R1bGUsXG4gICAgTWF0VGFic01vZHVsZSxcbiAgICBNYXRUb29sdGlwTW9kdWxlLFxuICAgIE1hdENoaXBzTW9kdWxlLFxuICAgIE1hdFByb2dyZXNzU3Bpbm5lck1vZHVsZSxcbiAgICBNYXRQcm9ncmVzc0Jhck1vZHVsZSxcbiAgICBNYXRFeHBhbnNpb25Nb2R1bGUsXG4gICAgTWF0U3RlcHBlck1vZHVsZSxcbiAgICBNYXRUYWJsZU1vZHVsZSxcbiAgICBNYXRQYWdpbmF0b3JNb2R1bGUsXG4gICAgTWF0U29ydE1vZHVsZSxcbiAgICBNYXREaXZpZGVyTW9kdWxlLFxuICAgIE1hdFNlbGVjdE1vZHVsZSxcbiAgICBNYXRJbnB1dE1vZHVsZSxcbiAgICBNYXRDaGVja2JveE1vZHVsZSxcbiAgICBNYXRSYWRpb01vZHVsZSxcbiAgICBNYXREYXRlcGlja2VyTW9kdWxlLFxuICAgIE1hdE5hdGl2ZURhdGVNb2R1bGUsXG4gICAgTWF0QXV0b2NvbXBsZXRlTW9kdWxlLFxuICAgIE1hdFNsaWRlck1vZHVsZSxcbiAgICBNYXRPcHRpb25Nb2R1bGUsXG4gICAgTWF0Q29tbW9uTW9kdWxlLFxuICAgIE1hdEJhZGdlTW9kdWxlXG4gIF07XG5cbiAgcHVibGljIHN0YXRpYyBMVVhfTU9EVUxFUzogYW55W10gPSBbXG4gICAgTHV4Rm9ybU1vZHVsZSxcbiAgICBMdXhMYXlvdXRNb2R1bGUsXG4gICAgTHV4QWN0aW9uTW9kdWxlLFxuICAgIEx1eERpcmVjdGl2ZXNNb2R1bGUsXG4gICAgTHV4UGlwZXNNb2R1bGUsXG4gICAgTHV4SWNvbk1vZHVsZSxcbiAgICBMdXhMb29rdXBNb2R1bGUsXG4gICAgTHV4RXJyb3JNb2R1bGUsXG4gICAgTHV4Q29tbW9uTW9kdWxlLFxuICAgIEx1eFBvcHVwc01vZHVsZSxcbiAgICBMdXhDb21wb25lbnRzQ29uZmlnTW9kdWxlLmZvclJvb3Qoe1xuICAgICAgZ2VuZXJhdGVMdXhUYWdJZHM6IGZhbHNlLFxuICAgICAgZGlzcGxheUx1eENvbnNvbGVMb2dzOiB0cnVlLFxuICAgICAgbGFiZWxDb25maWd1cmF0aW9uOiB7XG4gICAgICAgIGFsbFVwcGVyY2FzZTogdHJ1ZSxcbiAgICAgICAgbm90QXBwbGllZFRvOiBbXVxuICAgICAgfSxcbiAgICAgIGNhcmRFeHBhbnNpb25BbmltYXRpb25BY3RpdmU6IHRydWVcbiAgICB9KVxuICBdO1xuXG4gIC8qKlxuICAgKiBXaWNodGlnOiBhdXMgZmFrZUFzeW5jLUJsb2NrIGhlcmF1cyBhdWZydWZlbiwgZGEgaGllciB0aWNrKCkgZ2VudXR6dCB3aXJkLlxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBzZXRJbnB1dFZhbHVlKGlucHV0OiBhbnksIHZhbHVlOiBhbnksIGZpeHR1cmU6IGFueSkge1xuICAgIGlmIChpbnB1dCkge1xuICAgICAgaW5wdXQudmFsdWUgPSB2YWx1ZTtcbiAgICAgIGlucHV0LmRpc3BhdGNoRXZlbnQoTHV4VGVzdEhlbHBlci5jcmVhdGVGYWtlRXZlbnQoJ2lucHV0JykpO1xuICAgICAgTHV4VGVzdEhlbHBlci53YWl0KGZpeHR1cmUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdVTklULVRFU1QgRkVITEVSOiBpbnB1dCBpc3QgbmljaHQgZGVmaW5pZXJ0LicpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBXaWNodGlnOiBhdXMgZmFrZUFzeW5jLUJsb2NrIGhlcmF1cyBhdWZydWZlbiwgZGEgaGllciB0aWNrKCkgZ2VudXR6dCB3aXJkLlxuICAgKiBXYXJ0ZXQgYXN5bmNocm9uZSBBdWZydWZlIGFiIHVuZCBydWZ0IGRpZSBDaGFuZ2VEZXRlY3Rpb24gYXVmXG4gICAqIEBwYXJhbSBmaXh0dXJlXG4gICAqIEBwYXJhbSB0aWNrRHVyYXRpb25cbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgd2FpdChmaXh0dXJlOiBhbnksIHRpY2tEdXJhdGlvbj86IG51bWJlcikge1xuICAgIGZpeHR1cmUuZGV0ZWN0Q2hhbmdlcygpO1xuICAgIHRpY2sodGlja0R1cmF0aW9uKTtcbiAgICBmaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBXaWNodGlnOiBhdXMgZmFrZUFzeW5jLUJsb2NrIGhlcmF1cyBhdWZydWZlbiwgZGEgaGllciB0aWNrKCkgZ2VudXR6dCB3aXJkLlxuICAgKiBTZW5kZXQgZWluIEtsaWNrLUV2ZW50IGFiIHVuZCB3YXJ0ZXQgZGFubi5cbiAgICogQHBhcmFtIGZpeHR1cmVcbiAgICogQHBhcmFtIERlYnVnRWxlbWVudFxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBjbGljayhmaXh0dXJlOiBhbnksIGRlYnVnRWxlbWVudDogRGVidWdFbGVtZW50KSB7XG4gICAgZGVidWdFbGVtZW50LnRyaWdnZXJFdmVudEhhbmRsZXIoJ2NsaWNrJywgbnVsbCk7XG4gICAgTHV4VGVzdEhlbHBlci53YWl0KGZpeHR1cmUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFdpY2h0aWc6IGF1cyBmYWtlQXN5bmMtQmxvY2sgaGVyYXVzIGF1ZnJ1ZmVuLCBkYSBoaWVyIHRpY2soKSBnZW51dHp0IHdpcmQuXG4gICAqIFNlbmRldCBlaW4gQ2hhbmdlLUV2ZW50IGFiIHVuZCB3YXJ0ZXQgZGFubi5cbiAgICogQHBhcmFtIGZpeHR1cmVcbiAgICogQHBhcmFtIERlYnVnRWxlbWVudFxuICAgKi9cbiAgcHVibGljIHN0YXRpYyByYWRpb0J1dHRvbkNoYW5nZShmaXh0dXJlOiBhbnksIHJhZGlvQnV0dG9uOiBEZWJ1Z0VsZW1lbnQpIHtcbiAgICByYWRpb0J1dHRvbi5uYXRpdmVFbGVtZW50LmRpc3BhdGNoRXZlbnQoTHV4VGVzdEhlbHBlci5jcmVhdGVGYWtlRXZlbnQoJ2NoYW5nZScpKTtcbiAgICBMdXhUZXN0SGVscGVyLndhaXQoZml4dHVyZSk7XG4gIH1cblxuICAvKipcbiAgICogRXJzdGVsbHQgZWluZSBDb21wb25lbnRGaXh0dXJlIGZ1ZXIgZGllIG1pdGdlZ2ViZW5lIEtvbXBvbmVudGUsIG9wdGlvbmFsIGlzdCBlcyBtb2VnbGljaFxuICAgKiB3ZWl0ZXJlIFByb3ZpZGVyIHVuZCBEZWNsYXJhdGlvbnMgZWluenV0cmFnZW4uIERpZXNlIHdlcmRlbiBkYW5uIGltIFRlc3Rtb2R1bCBlaW5nZXRyYWdlbi5cbiAgICogQHBhcmFtIGNvbXBvbmVudFxuICAgKiBAcGFyYW0gcHJvdmlkZXJzXG4gICAqIEBwYXJhbSBkZWNsYXJhdGlvbnNcbiAgICogQGRlcHJlY2F0ZWQgU3RhdHRkZXNzZW4gY29uZmlndXJlVGVzdE1vZHVsZSBpbiBLb21iaW5hdGlvbiBtaXQgY29uZmlndXJlVGVzdFN1aXRlIHZlcndlbmRlbiAtLT4gZXJoZWJsaWNoIHBlcmZvcm1hbnRlclxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBjcmVhdGVDb21wb25lbnQoXG4gICAgY29tcG9uZW50OiBhbnksXG4gICAgcHJvdmlkZXJzOiBQcm92aWRlcltdID0gW10sXG4gICAgZGVjbGFyYXRpb25zOiBhbnlbXSA9IFtdXG4gICk6IENvbXBvbmVudEZpeHR1cmU8YW55PiB7XG4gICAgVGVzdEJlZC5jb25maWd1cmVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIGltcG9ydHM6IFtcbiAgICAgICAgLi4uTHV4VGVzdEhlbHBlci5DT01NT05fQU5HVUxBUl9NT0RVTEVTLFxuICAgICAgICAuLi5MdXhUZXN0SGVscGVyLk1BVEVSSUFMX01PRFVMRVMsXG4gICAgICAgIC4uLkx1eFRlc3RIZWxwZXIuTFVYX01PRFVMRVNcbiAgICAgIF0sXG4gICAgICBkZWNsYXJhdGlvbnM6IFsuLi5kZWNsYXJhdGlvbnMsIGNvbXBvbmVudF0sXG4gICAgICBwcm92aWRlcnM6IFsuLi5wcm92aWRlcnNdXG4gICAgfSk7XG5cbiAgICBUZXN0QmVkLmNvbXBpbGVDb21wb25lbnRzKCk7XG5cbiAgICByZXR1cm4gVGVzdEJlZC5jcmVhdGVDb21wb25lbnQoY29tcG9uZW50KTtcbiAgfVxuXG4gIC8qKiBVdGlsaXR5IHRvIGRpc3BhdGNoIGFueSBldmVudCBvbiBhIE5vZGUuICovXG4gIHB1YmxpYyBzdGF0aWMgZGlzcGF0Y2hFdmVudChub2RlOiBOb2RlIHwgV2luZG93LCBldmVudDogRXZlbnQpOiBFdmVudCB7XG4gICAgbm9kZS5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcbiAgICByZXR1cm4gZXZlbnQ7XG4gIH1cblxuICAvKiogU2hvcnRoYW5kIHRvIGRpc3BhdGNoIGEgZmFrZSBldmVudCBvbiBhIHNwZWNpZmllZCBub2RlLiAqL1xuICBwdWJsaWMgc3RhdGljIGRpc3BhdGNoRmFrZUV2ZW50KG5vZGU6IE5vZGUgfCBXaW5kb3csIHR5cGU6IHN0cmluZywgY2FuQnViYmxlPzogYm9vbGVhbik6IEV2ZW50IHtcbiAgICByZXR1cm4gTHV4VGVzdEhlbHBlci5kaXNwYXRjaEV2ZW50KG5vZGUsIEx1eFRlc3RIZWxwZXIuY3JlYXRlRmFrZUV2ZW50KHR5cGUsIGNhbkJ1YmJsZSkpO1xuICB9XG5cbiAgLyoqIFNob3J0aGFuZCB0byBkaXNwYXRjaCBhIGtleWJvYXJkIGV2ZW50IHdpdGggYSBzcGVjaWZpZWQga2V5IGNvZGUuICovXG4gIHB1YmxpYyBzdGF0aWMgZGlzcGF0Y2hLZXlib2FyZEV2ZW50KG5vZGU6IE5vZGUsIHR5cGU6IHN0cmluZywga2V5Q29kZTogbnVtYmVyLCB0YXJnZXQ/OiBFbGVtZW50KTogS2V5Ym9hcmRFdmVudCB7XG4gICAgcmV0dXJuIEx1eFRlc3RIZWxwZXIuZGlzcGF0Y2hFdmVudChub2RlLCBMdXhUZXN0SGVscGVyLmNyZWF0ZUtleWJvYXJkRXZlbnQodHlwZSwga2V5Q29kZSwgdGFyZ2V0KSkgYXMgS2V5Ym9hcmRFdmVudDtcbiAgfVxuXG4gIC8qKiBGb2N1c2VzIGFuIGlucHV0IGFuZCBzZXRzIGl0cyB2YWx1ZS4gRGlzcGF0Y2hlcyBhbiBmYWtlIGlucHV0IGV2ZW50IGFmdGVyd2FyZHMuICovXG4gIHB1YmxpYyBzdGF0aWMgdHlwZUluRWxlbWVudChlbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50LCB2YWx1ZTogc3RyaW5nLCBub0lucHV0RXZlbnQ/OiBib29sZWFuKSB7XG4gICAgZWxlbWVudC5mb2N1cygpO1xuICAgIGVsZW1lbnQudmFsdWUgPSB2YWx1ZTtcbiAgICBpZiAoIW5vSW5wdXRFdmVudCkge1xuICAgICAgTHV4VGVzdEhlbHBlci5kaXNwYXRjaEZha2VFdmVudChlbGVtZW50LCAnaW5wdXQnKTtcbiAgICB9XG4gIH1cblxuICAvKiogU3RldWVydW5nIHVuZCB0cmlnZ2VybiB2b24gT3ZlcmxheXMgaW1wbGVtZW50aWVyZW4gKiovXG5cbiAgLyoqXG4gICAqIEluc2VydHMgZGF0YSBpbnRvIGFuIGlucHV0IGZpZWxkLCB0aGF0IGhhcyB0byB1cGRhdGUgYXN5bmNocm91bm9zIGJlZm9yZSBjYWxsaW5nIGEgY2FsbGJhY2stZnVuY3Rpb25cbiAgICogQWxsb3dzIHRvIHVzZSBSeEpzIEludGVydmFsLVRpbWVycyB3aXRoaW4gdGhlIFRhcmdldC1Db21wb25lbnRzLlxuICAgKi9cbiAgcHVibGljIHN0YXRpYyB0eXBlSW5FbGVtZW50QXN5bmNoKHRleHQ6IHN0cmluZywgZml4dHVyZTogQ29tcG9uZW50Rml4dHVyZTxhbnk+LCBlbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50LCBjYWxsYmFjaykge1xuICAgIGZpeHR1cmUud2hlblN0YWJsZSgpLnRoZW4oKCkgPT4ge1xuICAgICAgTHV4VGVzdEhlbHBlci50eXBlSW5FbGVtZW50KGVsZW1lbnQsIHRleHQpO1xuICAgICAgZml4dHVyZS5kZXRlY3RDaGFuZ2VzKCk7XG5cbiAgICAgIGZpeHR1cmUud2hlblN0YWJsZSgpLnRoZW4oKCkgPT4ge1xuICAgICAgICBMdXhUZXN0SGVscGVyLmRpc3BhdGNoS2V5Ym9hcmRFdmVudChlbGVtZW50LCAna2V5ZG93bicsIFNQQUNFKTtcbiAgICAgICAgZml4dHVyZS5kZXRlY3RDaGFuZ2VzKCk7XG5cbiAgICAgICAgZml4dHVyZS53aGVuU3RhYmxlKCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKiBEaXNwYXRjaGVzIGEga2V5ZG93biBldmVudCBmcm9tIGFuIGVsZW1lbnQuICovXG4gIHB1YmxpYyBzdGF0aWMgY3JlYXRlS2V5Ym9hcmRFdmVudCh0eXBlOiBzdHJpbmcsIGtleUNvZGU6IG51bWJlciwgdGFyZ2V0PzogRWxlbWVudCwga2V5Pzogc3RyaW5nKSB7XG4gICAgY29uc3QgZXZlbnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnS2V5Ym9hcmRFdmVudCcpIGFzIGFueTtcbiAgICAvLyBGaXJlZm94IGRvZXMgbm90IHN1cHBvcnQgYGluaXRLZXlib2FyZEV2ZW50YCwgYnV0IHN1cHBvcnRzIGBpbml0S2V5RXZlbnRgLlxuICAgIGNvbnN0IGluaXRFdmVudEZuID0gKGV2ZW50LmluaXRLZXlFdmVudCB8fCBldmVudC5pbml0S2V5Ym9hcmRFdmVudCkuYmluZChldmVudCk7XG4gICAgY29uc3Qgb3JpZ2luYWxQcmV2ZW50RGVmYXVsdCA9IGV2ZW50LnByZXZlbnREZWZhdWx0O1xuXG4gICAgaW5pdEV2ZW50Rm4odHlwZSwgdHJ1ZSwgdHJ1ZSwgd2luZG93LCAwLCAwLCAwLCAwLCAwLCBrZXlDb2RlKTtcblxuICAgIC8vIFdlYmtpdCBCcm93c2VycyBkb24ndCBzZXQgdGhlIGtleUNvZGUgd2hlbiBjYWxsaW5nIHRoZSBpbml0IGZ1bmN0aW9uLlxuICAgIC8vIFNlZSByZWxhdGVkIGJ1ZyBodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTY3MzVcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhldmVudCwge1xuICAgICAga2V5Q29kZTogeyBnZXQ6ICgpID0+IGtleUNvZGUgfSxcbiAgICAgIGtleTogeyBnZXQ6ICgpID0+IGtleSB9LFxuICAgICAgdGFyZ2V0OiB7IGdldDogKCkgPT4gdGFyZ2V0IH1cbiAgICB9KTtcblxuICAgIC8vIElFIHdvbid0IHNldCBgZGVmYXVsdFByZXZlbnRlZGAgb24gc3ludGhldGljIGV2ZW50cyBzbyB3ZSBuZWVkIHRvIGRvIGl0IG1hbnVhbGx5LlxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0ID0gZnVuY3Rpb24oKSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXZlbnQsICdkZWZhdWx0UHJldmVudGVkJywgeyBnZXQ6ICgpID0+IHRydWUgfSk7XG4gICAgICByZXR1cm4gb3JpZ2luYWxQcmV2ZW50RGVmYXVsdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIH07XG5cbiAgICByZXR1cm4gZXZlbnQ7XG4gIH1cblxuICAvKiogQ3JlYXRlcyBhIGZha2UgZXZlbnQgb2JqZWN0IHdpdGggYW55IGRlc2lyZWQgZXZlbnQgdHlwZS4gKi9cbiAgcHVibGljIHN0YXRpYyBjcmVhdGVGYWtlRXZlbnQodHlwZTogc3RyaW5nLCBjYW5CdWJibGUgPSBmYWxzZSwgY2FuY2VsYWJsZSA9IHRydWUpIHtcbiAgICBsZXQgZXZlbnQ7XG4gICAgaWYgKHR5cGVvZiBFdmVudCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgZXZlbnQgPSBuZXcgRXZlbnQodHlwZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ0V2ZW50Jyk7XG4gICAgICBldmVudC5pbml0RXZlbnQodHlwZSwgY2FuQnViYmxlLCBjYW5jZWxhYmxlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZXZlbnQ7XG4gIH1cblxuICAvKipcbiAgICogU2VsZWt0aWVydCBlaW4gRWxlbWVudCBhbmhhbmQgZGVyIFF1ZXJ5IHZvbiBkZW0gRml4dHVyZVxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBzZWxlY3RPbmVGcm9tRml4dHVyZShmaXh0dXJlOiBDb21wb25lbnRGaXh0dXJlPGFueT4sIHF1ZXJ5OiBzdHJpbmcpOiBEZWJ1Z0VsZW1lbnQge1xuICAgIHJldHVybiBmaXh0dXJlLmRlYnVnRWxlbWVudC5xdWVyeShCeS5jc3MocXVlcnkpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZWxla3RpZXJ0IGVpbiBBcnJheSB2b24gRWxlbWVudGVuIGFuaGFuZCBkZXIgUXVlcnkgdm9uIGRlbSBGaXh0dXJlXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIHNlbGVjdEFsbEZyb21GaXh0dXJlKGZpeHR1cmU6IENvbXBvbmVudEZpeHR1cmU8YW55PiwgcXVlcnk6IHN0cmluZyk6IERlYnVnRWxlbWVudFtdIHtcbiAgICByZXR1cm4gZml4dHVyZS5kZWJ1Z0VsZW1lbnQucXVlcnlBbGwoQnkuY3NzKHF1ZXJ5KSk7XG4gIH1cblxuICAvKipcbiAgICogRW50ZmVybnQgbmljaHQtQVNDSUktQ2hhcnMgYXVzIGRlbSBTdHJpbmcgKEJlaW0gSUUgd2ljaHRpZywgZGllc2VyIGbDvGd0IGdlcm5lIHZlcnN0ZWNrdGUgU3RldWVyemVpY2hlblxuICAgKiBpbiBJbnB1dC1GZWxkZXJuIGFuIGRpZSBTdHJpbmdzKS5cbiAgICogQHBhcmFtIGRhdGVTdHJpbmdcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgc3RyaW5nV2l0aG91dEFTQ0lJQ2hhcnMoZGF0ZVN0cmluZzogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCBleHAgPSBuZXcgUmVnRXhwKCdbXkEtWmEteiAwLTkgXFxcXC4sXFxcXD9cIlwiIUAjXFxcXCQlXFxcXF4mXFxcXCpcXFxcKFxcXFwpLV89XFxcXCs7Ojw+XFxcXC9cXFxcXFxcXFxcXFx8XFxcXH1cXFxce1xcXFxbXFxcXF1gfl0qJywgJ2cnKTtcbiAgICByZXR1cm4gZGF0ZVN0cmluZy5yZXBsYWNlKGV4cCwgJycpO1xuICB9XG5cbiAgLyoqXG4gICAqICBEZWFrdGl2aWVydCBkZW4gUmVzZXQgZGVzIFRlc3Rtb2R1bHMgYW0gRW5kZSBlaW5lcyBUZXN0ZHVyY2hsYXVmcy5cbiAgICogIFZlcmJlc3NlcnQgZGllIFBlcmZvcm1hbmNlIGRlciBLYXJtYS1UZXN0cyBlcmhlYmxpY2guXG4gICAqICBBbSBFbmRlIGRlciBUZXN0c3VpdGUgd2lyZCBkaWVzZSBGdW5rdGlvbiB3aWVkZXIgYWt0aXZpZXJ0LlxuICAgKlxuICAgKiAgRnVua3Rpb24gZGFmw7xyIGVpbmZhY2ggYW0gQW5mYW5nIGVpbmVyIFRlc3RzdWl0ZSAoZXJzdGVzIGRlc2NyaWJlKSBhdWZydWZlbiB1bmQgaW4gZWluZW0gYmVmb3JlQWxsIGRhcyBUZXN0bW9kdWxcbiAgICogIGVyemV1Z2VuLiBEaWVzZXMgd2lyZCBudW4gbmljaHQgbWVociBuYWNoIGplZGVtIFRlc3QgbmV1IGVyemV1Z3QuXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGNvbmZpZ3VyZVRlc3RTdWl0ZSgpIHtcbiAgICBjb25zdCB0ZXN0QmVkQXBpOiBhbnkgPSBnZXRUZXN0QmVkKCk7XG4gICAgY29uc3Qgb3JpZ2luUmVzZXQgPSBUZXN0QmVkLnJlc2V0VGVzdGluZ01vZHVsZTtcblxuICAgIGJlZm9yZUFsbCgoKSA9PiB7XG4gICAgICBUZXN0QmVkLnJlc2V0VGVzdGluZ01vZHVsZSgpO1xuICAgICAgVGVzdEJlZC5yZXNldFRlc3RpbmdNb2R1bGUgPSAoKSA9PiBUZXN0QmVkO1xuICAgIH0pO1xuXG4gICAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICAgIHRlc3RCZWRBcGkuX2FjdGl2ZUZpeHR1cmVzLmZvckVhY2goKGZpeHR1cmU6IENvbXBvbmVudEZpeHR1cmU8YW55PikgPT4gZml4dHVyZS5kZXN0cm95KCkpO1xuICAgICAgdGVzdEJlZEFwaS5faW5zdGFudGlhdGVkID0gZmFsc2U7XG4gICAgfSk7XG5cbiAgICBhZnRlckFsbCgoKSA9PiB7XG4gICAgICBUZXN0QmVkLnJlc2V0VGVzdGluZ01vZHVsZSA9IG9yaWdpblJlc2V0O1xuICAgICAgVGVzdEJlZC5yZXNldFRlc3RpbmdNb2R1bGUoKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBLb25maWd1cmllcnQgZGFzIFRlc3RNb2R1bCBmw7xyIGVpbmUgVGVzdHN1aXRlLCBrYW5uIGRhYmVpIFByb3ZpZGVyIHVuZCBLb21wb25lbnRlbiAoRGVrbGFyYXRpb25lbikgZW50Z2VnZW5uZWhtZW4uXG4gICAqIEBwYXJhbSBwcm92aWRlcnNcbiAgICogQHBhcmFtIGRlY2xhcmF0aW9uc1xuICAgKiBAcGFyYW0gaW1wb3J0c1xuICAgKi9cbiAgcHVibGljIHN0YXRpYyBjb25maWd1cmVUZXN0TW9kdWxlKHByb3ZpZGVyczogUHJvdmlkZXJbXSA9IFtdLCBkZWNsYXJhdGlvbnM6IGFueVtdID0gW10sIGltcG9ydHM6IGFueVtdID0gW10pIHtcbiAgICBUZXN0QmVkLmNvbmZpZ3VyZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgaW1wb3J0czogW1xuICAgICAgICAuLi5MdXhUZXN0SGVscGVyLkNPTU1PTl9BTkdVTEFSX01PRFVMRVMsXG4gICAgICAgIC4uLkx1eFRlc3RIZWxwZXIuTUFURVJJQUxfTU9EVUxFUyxcbiAgICAgICAgLi4uTHV4VGVzdEhlbHBlci5MVVhfTU9EVUxFUyxcbiAgICAgICAgLi4uaW1wb3J0c1xuICAgICAgXSxcbiAgICAgIGRlY2xhcmF0aW9uczogWy4uLmRlY2xhcmF0aW9uc10sXG4gICAgICBwcm92aWRlcnM6IFsuLi5wcm92aWRlcnNdXG4gICAgfSk7XG5cbiAgICBUZXN0QmVkLmNvbXBpbGVDb21wb25lbnRzKCk7XG4gIH1cblxuICAvKipcbiAgICogRXJzdGVsbHQgZWluIGxlZXJlcyBGaWxlLU9iamVrdCBtaXQgTmFtZW4gdW5kIFR5cCB2aWEgQmxvYi1Db25zdHJ1Y3RvciAodW0gRWRnZS9JRS1GZWhsZXIgenUgdmVybWVpZGVuKS5cbiAgICogQHBhcmFtIG5hbWVcbiAgICogQHBhcmFtIHR5cGVcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgY3JlYXRlRmlsZUJyb3dzZXJTYWZlKG5hbWUsIHR5cGUpIHtcbiAgICBjb25zdCBmaWxlID0gbmV3IEJsb2IoWycnXSwgeyB0eXBlOiB0eXBlIH0pO1xuICAgIGZpbGVbJ25hbWUnXSA9IG5hbWU7XG5cbiAgICByZXR1cm4gPEZpbGU+ZmlsZTtcbiAgfVxufVxuIl19