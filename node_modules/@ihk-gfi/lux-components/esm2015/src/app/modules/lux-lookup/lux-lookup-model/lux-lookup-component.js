// tslint:disable:max-line-length
import * as tslib_1 from "tslib";
import { EventEmitter, Input, Output } from '@angular/core';
import { LuxBehandlungsOptionenUngueltige, LuxLookupParameters } from './lux-lookup-parameters';
import { LuxFormComponentBase } from '../../lux-form/lux-form-model/lux-form-component-base.class';
export class LuxLookupComponent extends LuxFormComponentBase {
    constructor(lookupService, lookupHandler, controlContainer, cdr, logger, componentsConfigService) {
        super(controlContainer, cdr, logger, componentsConfigService);
        this.LuxBehandlungsOptionenUngueltige = LuxBehandlungsOptionenUngueltige;
        this.luxBehandlungUngueltige = LuxBehandlungsOptionenUngueltige.ausgrauen;
        this.luxDataLoaded = new EventEmitter();
        this.luxValueChange = new EventEmitter();
        this.entries = [];
        this.lookupService = lookupService;
        this.lookupHandler = lookupHandler;
        this.componentsConfigService = componentsConfigService;
    }
    get luxValue() {
        return this.getValue();
    }
    set luxValue(value) {
        this.setValue(value);
    }
    ngOnInit() {
        super.ngOnInit();
        if (!this.luxLookupId) {
            console.error(`Die Lookup-Komponente mit der Tabellen-Nr. ${this.luxTableNo} besitzt keine LookupId. Bitte tragen Sie diese nach.`);
        }
        this.lookupHandler.addLookupElement(this.luxLookupId);
        this.lookupHandler.getLookupElementObsv(this.luxLookupId).subscribe(() => {
            this.fetchLookupData();
        });
        this.configSubscription = this.componentsConfigService.config.subscribe((newConfig) => {
            this.apiPath = newConfig.lookupServiceUrl;
            this.lookupHandler.reloadData(this.luxLookupId);
        });
    }
    ngOnDestroy() {
        super.ngOnDestroy();
        this.configSubscription.unsubscribe();
    }
    /**
     * Gibt zurueck, ob die RenderProperty eine Funktion ist oder nicht.
     *
     * @returns boolean
     */
    isRenderPropAFunction() {
        return typeof this.luxRenderProp === 'function';
    }
    /**
     * Gibt zurück ob sich das entsprechende Element in der Liste ungültiger Elemente befindet.
     * @param LuxLookupTableEntry entry
     * @returns boolean
     */
    isUngueltig(entry) {
        let isUngueltig = false;
        if (entry) {
            if (!Array.isArray(entry)) {
                if (entry.gueltigkeitBis) {
                    isUngueltig = Date.now() > +entry.gueltigkeitBis;
                }
            }
            else {
                entry.forEach(element => {
                    if (element.gueltigkeitBis && !isUngueltig) {
                        isUngueltig = Date.now() > +element.gueltigkeitBis;
                    }
                });
            }
        }
        return isUngueltig;
    }
    /**
     * Gibt zurück ob ungültige Einträge angezeigt werden sollen.
     * @returns boolean
     */
    showUngueltige() {
        return (this.luxBehandlungUngueltige === this.LuxBehandlungsOptionenUngueltige.ausgrauen ||
            this.luxBehandlungUngueltige === this.LuxBehandlungsOptionenUngueltige.anzeigen);
    }
    /**
     * Gibt zurück ob ungültige Einträge deaktiviert werden sollen.
     * @returns boolean
     */
    disableUngueltige() {
        return this.luxBehandlungUngueltige === this.LuxBehandlungsOptionenUngueltige.ausgrauen;
    }
    /**
     * Gibt die mitgegebenen Styles abhaengig ob das Element invalid ist zurueck.
     * @param boolean invalid
     * @returns LuxLookupOptionStyle
     */
    getStyles(invalid) {
        if (invalid) {
            return this.luxCustomInvalidStyles ? this.luxCustomInvalidStyles : {};
        }
        return this.luxCustomStyles ? this.luxCustomStyles : {};
    }
    /**
     * @override errorMessageModifier - Modifikation der Fehlermeldung
     * @param value
     * @param errors
     */
    errorMessageModifier(value, errors) {
        if (errors['ungueltig']) {
            return 'Der ausgewählte Wert ist ungültig.';
        }
        return undefined;
    }
    getLabel(entry) {
        if (this.isRenderPropAFunction()) {
            return this.luxRenderProp(entry);
        }
        if (entry[this.luxRenderProp]) {
            return entry[this.luxRenderProp];
        }
        return 'Fehler beim Auslesen (Property unbekannt)';
    }
    /**
     * Holt die Lookup-Table Daten vom Backend
     */
    fetchLookupData() {
        const backendRequest = this.lookupService.getLookupTable(this.luxTableNo, this.luxParameters, this.apiPath);
        backendRequest.subscribe((entries) => {
            this.setLookupData(entries);
            this.luxDataLoaded.emit(true);
        }, () => {
            this.luxDataLoaded.emit(false);
        });
    }
    /**
     * Setzt die aktuellen Werte auf die mitgegebenen Entries.
     * @param entries
     */
    setLookupData(entries) {
        this.entries = entries;
        if (this.entries) {
            // Merken welche Eintraege ungueltig sind, um bei vielen Informationen
            // nicht die ganzen Funktionsaufrufe zu haben
            this.entries.forEach((entry) => {
                entry.isUngueltig = this.isUngueltig(entry);
            });
        }
    }
    // region Overridden methods
    notifyFormValueChanged(formValue) {
        this.luxValueChange.emit(formValue);
    }
    triggerOutputPatternCheck() {
        this.checkOutputPatternViolation(this.luxValueChange.observers);
    }
    triggerInputPatternCheck(simpleChanges) {
        this.checkInputPatternViolation(simpleChanges.luxValue);
    }
}
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", String)
], LuxLookupComponent.prototype, "luxPlaceholder", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Boolean)
], LuxLookupComponent.prototype, "luxReadonly", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", String)
], LuxLookupComponent.prototype, "luxLookupId", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", String)
], LuxLookupComponent.prototype, "luxTableNo", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object)
], LuxLookupComponent.prototype, "luxRenderProp", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", String)
], LuxLookupComponent.prototype, "luxBehandlungUngueltige", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", LuxLookupParameters)
], LuxLookupComponent.prototype, "luxParameters", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object)
], LuxLookupComponent.prototype, "luxCustomStyles", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object)
], LuxLookupComponent.prototype, "luxCustomInvalidStyles", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", String)
], LuxLookupComponent.prototype, "luxTagId", void 0);
tslib_1.__decorate([
    Output(),
    tslib_1.__metadata("design:type", EventEmitter)
], LuxLookupComponent.prototype, "luxDataLoaded", void 0);
tslib_1.__decorate([
    Output(),
    tslib_1.__metadata("design:type", EventEmitter)
], LuxLookupComponent.prototype, "luxValueChange", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object),
    tslib_1.__metadata("design:paramtypes", [Object])
], LuxLookupComponent.prototype, "luxValue", null);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibHV4LWxvb2t1cC1jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AaWhrLWdmaS9sdXgtY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbInNyYy9hcHAvbW9kdWxlcy9sdXgtbG9va3VwL2x1eC1sb29rdXAtbW9kZWwvbHV4LWxvb2t1cC1jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsaUNBQWlDOztBQUVqQyxPQUFPLEVBRUwsWUFBWSxFQUNaLEtBQUssRUFJTCxNQUFNLEVBRVAsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGdDQUFnQyxFQUFFLG1CQUFtQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFJaEcsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sNkRBQTZELENBQUM7QUFRbkcsTUFBTSxPQUFnQixrQkFBbUIsU0FBUSxvQkFBb0I7SUE0Qm5FLFlBQ0UsYUFBK0IsRUFDL0IsYUFBc0MsRUFDdEMsZ0JBQWtDLEVBQ2xDLEdBQXNCLEVBQ3RCLE1BQXlCLEVBQ3pCLHVCQUFtRDtRQUVuRCxLQUFLLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSx1QkFBdUIsQ0FBQyxDQUFDO1FBbkNoRSxxQ0FBZ0MsR0FBRyxnQ0FBZ0MsQ0FBQztRQWMzRCw0QkFBdUIsR0FBcUMsZ0NBQWdDLENBQUMsU0FBUyxDQUFDO1FBS3RHLGtCQUFhLEdBQTBCLElBQUksWUFBWSxFQUFXLENBQUM7UUFDbkUsbUJBQWMsR0FBOEQsSUFBSSxZQUFZLEVBRW5HLENBQUM7UUFDSixZQUFPLEdBQTBCLEVBQUUsQ0FBQztRQWNsQyxJQUFJLENBQUMsYUFBYSxHQUFHLGFBQWEsQ0FBQztRQUNuQyxJQUFJLENBQUMsYUFBYSxHQUFHLGFBQWEsQ0FBQztRQUNuQyxJQUFJLENBQUMsdUJBQXVCLEdBQUcsdUJBQXVCLENBQUM7SUFDekQsQ0FBQztJQUVELElBQUksUUFBUTtRQUNWLE9BQU8sSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFD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XG5cbmltcG9ydCB7XG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIElucHV0LFxuICBPbkNoYW5nZXMsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBPdXRwdXQsXG4gIFNpbXBsZUNoYW5nZXNcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBMdXhCZWhhbmRsdW5nc09wdGlvbmVuVW5ndWVsdGlnZSwgTHV4TG9va3VwUGFyYW1ldGVycyB9IGZyb20gJy4vbHV4LWxvb2t1cC1wYXJhbWV0ZXJzJztcbmltcG9ydCB7IEx1eExvb2t1cFRhYmxlRW50cnkgfSBmcm9tICcuL2x1eC1sb29rdXAtdGFibGUtZW50cnknO1xuaW1wb3J0IHsgTHV4TG9va3VwU2VydmljZSB9IGZyb20gJy4uL2x1eC1sb29rdXAtc2VydmljZS9sdXgtbG9va3VwLnNlcnZpY2UnO1xuaW1wb3J0IHsgQ29udHJvbENvbnRhaW5lciB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IEx1eEZvcm1Db21wb25lbnRCYXNlIH0gZnJvbSAnLi4vLi4vbHV4LWZvcm0vbHV4LWZvcm0tbW9kZWwvbHV4LWZvcm0tY29tcG9uZW50LWJhc2UuY2xhc3MnO1xuaW1wb3J0IHsgTHV4TG9va3VwSGFuZGxlclNlcnZpY2UgfSBmcm9tICcuLi9sdXgtbG9va3VwLXNlcnZpY2UvbHV4LWxvb2t1cC1oYW5kbGVyLnNlcnZpY2UnO1xuaW1wb3J0IHsgTHV4TG9va3VwRXJyb3JTdGF0ZU1hdGNoZXIgfSBmcm9tICcuL2x1eC1sb29rdXAtZXJyb3Itc3RhdGUtbWF0Y2hlcic7XG5pbXBvcnQgeyBMdXhDb25zb2xlU2VydmljZSB9IGZyb20gJy4uLy4uL2x1eC11dGlsL2x1eC1jb25zb2xlLnNlcnZpY2UnO1xuaW1wb3J0IHsgTHV4Q29tcG9uZW50c0NvbmZpZ1NlcnZpY2UgfSBmcm9tICcuLi8uLi9sdXgtY29tcG9uZW50cy1jb25maWcvbHV4LWNvbXBvbmVudHMtY29uZmlnLnNlcnZpY2UnO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBMdXhDb21wb25lbnRzQ29uZmlnUGFyYW1ldGVycyB9IGZyb20gJy4uLy4uL2x1eC1jb21wb25lbnRzLWNvbmZpZy9sdXgtY29tcG9uZW50cy1jb25maWctcGFyYW1ldGVycy5pbnRlcmZhY2UnO1xuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgTHV4TG9va3VwQ29tcG9uZW50IGV4dGVuZHMgTHV4Rm9ybUNvbXBvbmVudEJhc2UgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcbiAgTHV4QmVoYW5kbHVuZ3NPcHRpb25lblVuZ3VlbHRpZ2UgPSBMdXhCZWhhbmRsdW5nc09wdGlvbmVuVW5ndWVsdGlnZTtcblxuICBsb29rdXBTZXJ2aWNlOiBMdXhMb29rdXBTZXJ2aWNlO1xuICBsb29rdXBIYW5kbGVyOiBMdXhMb29rdXBIYW5kbGVyU2VydmljZTtcbiAgY29tcG9uZW50c0NvbmZpZ1NlcnZpY2U6IEx1eENvbXBvbmVudHNDb25maWdTZXJ2aWNlO1xuXG4gIHN0YXRlTWF0Y2hlcjogTHV4TG9va3VwRXJyb3JTdGF0ZU1hdGNoZXI7XG4gIGFwaVBhdGg6IHN0cmluZztcblxuICBASW5wdXQoKSBsdXhQbGFjZWhvbGRlcjogc3RyaW5nO1xuICBASW5wdXQoKSBsdXhSZWFkb25seTogYm9vbGVhbjtcbiAgQElucHV0KCkgbHV4TG9va3VwSWQ6IHN0cmluZztcbiAgQElucHV0KCkgbHV4VGFibGVObzogc3RyaW5nO1xuICBASW5wdXQoKSBsdXhSZW5kZXJQcm9wOiBhbnk7XG4gIEBJbnB1dCgpIGx1eEJlaGFuZGx1bmdVbmd1ZWx0aWdlOiBMdXhCZWhhbmRsdW5nc09wdGlvbmVuVW5ndWVsdGlnZSA9IEx1eEJlaGFuZGx1bmdzT3B0aW9uZW5Vbmd1ZWx0aWdlLmF1c2dyYXVlbjtcbiAgQElucHV0KCkgbHV4UGFyYW1ldGVyczogTHV4TG9va3VwUGFyYW1ldGVycztcbiAgQElucHV0KCkgbHV4Q3VzdG9tU3R5bGVzO1xuICBASW5wdXQoKSBsdXhDdXN0b21JbnZhbGlkU3R5bGVzO1xuICBASW5wdXQoKSBsdXhUYWdJZDogc3RyaW5nO1xuICBAT3V0cHV0KCkgbHV4RGF0YUxvYWRlZDogRXZlbnRFbWl0dGVyPGJvb2xlYW4+ID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xuICBAT3V0cHV0KCkgbHV4VmFsdWVDaGFuZ2U6IEV2ZW50RW1pdHRlcjxMdXhMb29rdXBUYWJsZUVudHJ5IHwgTHV4TG9va3VwVGFibGVFbnRyeVtdPiA9IG5ldyBFdmVudEVtaXR0ZXI8XG4gICAgTHV4TG9va3VwVGFibGVFbnRyeVxuICA+KCk7XG4gIGVudHJpZXM6IEx1eExvb2t1cFRhYmxlRW50cnlbXSA9IFtdO1xuXG4gIHByaXZhdGUgY29uZmlnU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG5cbiAgcHJvdGVjdGVkIGNvbnN0cnVjdG9yKFxuICAgIGxvb2t1cFNlcnZpY2U6IEx1eExvb2t1cFNlcnZpY2UsXG4gICAgbG9va3VwSGFuZGxlcjogTHV4TG9va3VwSGFuZGxlclNlcnZpY2UsXG4gICAgY29udHJvbENvbnRhaW5lcjogQ29udHJvbENvbnRhaW5lcixcbiAgICBjZHI6IENoYW5nZURldGVjdG9yUmVmLFxuICAgIGxvZ2dlcjogTHV4Q29uc29sZVNlcnZpY2UsXG4gICAgY29tcG9uZW50c0NvbmZpZ1NlcnZpY2U6IEx1eENvbXBvbmVudHNDb25maWdTZXJ2aWNlXG4gICkge1xuICAgIHN1cGVyKGNvbnRyb2xDb250YWluZXIsIGNkciwgbG9nZ2VyLCBjb21wb25lbnRzQ29uZmlnU2VydmljZSk7XG5cbiAgICB0aGlzLmxvb2t1cFNlcnZpY2UgPSBsb29rdXBTZXJ2aWNlO1xuICAgIHRoaXMubG9va3VwSGFuZGxlciA9IGxvb2t1cEhhbmRsZXI7XG4gICAgdGhpcy5jb21wb25lbnRzQ29uZmlnU2VydmljZSA9IGNvbXBvbmVudHNDb25maWdTZXJ2aWNlO1xuICB9XG5cbiAgZ2V0IGx1eFZhbHVlKCk6IGFueSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0VmFsdWUoKTtcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBsdXhWYWx1ZSh2YWx1ZTogYW55KSB7XG4gICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZSk7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICBzdXBlci5uZ09uSW5pdCgpO1xuXG4gICAgaWYgKCF0aGlzLmx1eExvb2t1cElkKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFxuICAgICAgICBgRGllIExvb2t1cC1Lb21wb25lbnRlIG1pdCBkZXIgVGFiZWxsZW4tTnIuICR7dGhpcy5sdXhUYWJsZU5vfSBiZXNpdHp0IGtlaW5lIExvb2t1cElkLiBCaXR0ZSB0cmFnZW4gU2llIGRpZXNlIG5hY2guYFxuICAgICAgKTtcbiAgICB9XG5cbiAgICB0aGlzLmxvb2t1cEhhbmRsZXIuYWRkTG9va3VwRWxlbWVudCh0aGlzLmx1eExvb2t1cElkKTtcbiAgICB0aGlzLmxvb2t1cEhhbmRsZXIuZ2V0TG9va3VwRWxlbWVudE9ic3YodGhpcy5sdXhMb29rdXBJZCkuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgIHRoaXMuZmV0Y2hMb29rdXBEYXRhKCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLmNvbmZpZ1N1YnNjcmlwdGlvbiA9IHRoaXMuY29tcG9uZW50c0NvbmZpZ1NlcnZpY2UuY29uZmlnLnN1YnNjcmliZShcbiAgICAgIChuZXdDb25maWc6IEx1eENvbXBvbmVudHNDb25maWdQYXJhbWV0ZXJzKSA9PiB7XG4gICAgICAgIHRoaXMuYXBpUGF0aCA9IG5ld0NvbmZpZy5sb29rdXBTZXJ2aWNlVXJsO1xuXG4gICAgICAgIHRoaXMubG9va3VwSGFuZGxlci5yZWxvYWREYXRhKHRoaXMubHV4TG9va3VwSWQpO1xuICAgICAgfVxuICAgICk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICBzdXBlci5uZ09uRGVzdHJveSgpO1xuXG4gICAgdGhpcy5jb25maWdTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHaWJ0IHp1cnVlY2ssIG9iIGRpZSBSZW5kZXJQcm9wZXJ0eSBlaW5lIEZ1bmt0aW9uIGlzdCBvZGVyIG5pY2h0LlxuICAgKlxuICAgKiBAcmV0dXJucyBib29sZWFuXG4gICAqL1xuICBpc1JlbmRlclByb3BBRnVuY3Rpb24oKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHR5cGVvZiB0aGlzLmx1eFJlbmRlclByb3AgPT09ICdmdW5jdGlvbic7XG4gIH1cblxuICAvKipcbiAgICogR2lidCB6dXLDvGNrIG9iIHNpY2ggZGFzIGVudHNwcmVjaGVuZGUgRWxlbWVudCBpbiBkZXIgTGlzdGUgdW5nw7xsdGlnZXIgRWxlbWVudGUgYmVmaW5kZXQuXG4gICAqIEBwYXJhbSBMdXhMb29rdXBUYWJsZUVudHJ5IGVudHJ5XG4gICAqIEByZXR1cm5zIGJvb2xlYW5cbiAgICovXG4gIGlzVW5ndWVsdGlnKGVudHJ5OiBMdXhMb29rdXBUYWJsZUVudHJ5IHwgTHV4TG9va3VwVGFibGVFbnRyeVtdKSB7XG4gICAgbGV0IGlzVW5ndWVsdGlnID0gZmFsc2U7XG4gICAgaWYgKGVudHJ5KSB7XG4gICAgICBpZiAoIUFycmF5LmlzQXJyYXkoZW50cnkpKSB7XG4gICAgICAgIGlmIChlbnRyeS5ndWVsdGlna2VpdEJpcykge1xuICAgICAgICAgIGlzVW5ndWVsdGlnID0gRGF0ZS5ub3coKSA+ICtlbnRyeS5ndWVsdGlna2VpdEJpcztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZW50cnkuZm9yRWFjaChlbGVtZW50ID0+IHtcbiAgICAgICAgICBpZiAoZWxlbWVudC5ndWVsdGlna2VpdEJpcyAmJiAhaXNVbmd1ZWx0aWcpIHtcbiAgICAgICAgICAgIGlzVW5ndWVsdGlnID0gRGF0ZS5ub3coKSA+ICtlbGVtZW50Lmd1ZWx0aWdrZWl0QmlzO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGlzVW5ndWVsdGlnO1xuICB9XG5cbiAgLyoqXG4gICAqIEdpYnQgenVyw7xjayBvYiB1bmfDvGx0aWdlIEVpbnRyw6RnZSBhbmdlemVpZ3Qgd2VyZGVuIHNvbGxlbi5cbiAgICogQHJldHVybnMgYm9vbGVhblxuICAgKi9cbiAgc2hvd1VuZ3VlbHRpZ2UoKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIHRoaXMubHV4QmVoYW5kbHVuZ1VuZ3VlbHRpZ2UgPT09IHRoaXMuTHV4QmVoYW5kbHVuZ3NPcHRpb25lblVuZ3VlbHRpZ2UuYXVzZ3JhdWVuIHx8XG4gICAgICB0aGlzLmx1eEJlaGFuZGx1bmdVbmd1ZWx0aWdlID09PSB0aGlzLkx1eEJlaGFuZGx1bmdzT3B0aW9uZW5Vbmd1ZWx0aWdlLmFuemVpZ2VuXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHaWJ0IHp1csO8Y2sgb2IgdW5nw7xsdGlnZSBFaW50csOkZ2UgZGVha3RpdmllcnQgd2VyZGVuIHNvbGxlbi5cbiAgICogQHJldHVybnMgYm9vbGVhblxuICAgKi9cbiAgZGlzYWJsZVVuZ3VlbHRpZ2UoKSB7XG4gICAgcmV0dXJuIHRoaXMubHV4QmVoYW5kbHVuZ1VuZ3VlbHRpZ2UgPT09IHRoaXMuTHV4QmVoYW5kbHVuZ3NPcHRpb25lblVuZ3VlbHRpZ2UuYXVzZ3JhdWVuO1xuICB9XG5cbiAgLyoqXG4gICAqIEdpYnQgZGllIG1pdGdlZ2ViZW5lbiBTdHlsZXMgYWJoYWVuZ2lnIG9iIGRhcyBFbGVtZW50IGludmFsaWQgaXN0IHp1cnVlY2suXG4gICAqIEBwYXJhbSBib29sZWFuIGludmFsaWRcbiAgICogQHJldHVybnMgTHV4TG9va3VwT3B0aW9uU3R5bGVcbiAgICovXG4gIGdldFN0eWxlcyhpbnZhbGlkOiBib29sZWFuKSB7XG4gICAgaWYgKGludmFsaWQpIHtcbiAgICAgIHJldHVybiB0aGlzLmx1eEN1c3RvbUludmFsaWRTdHlsZXMgPyB0aGlzLmx1eEN1c3RvbUludmFsaWRTdHlsZXMgOiB7fTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMubHV4Q3VzdG9tU3R5bGVzID8gdGhpcy5sdXhDdXN0b21TdHlsZXMgOiB7fTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAb3ZlcnJpZGUgZXJyb3JNZXNzYWdlTW9kaWZpZXIgLSBNb2RpZmlrYXRpb24gZGVyIEZlaGxlcm1lbGR1bmdcbiAgICogQHBhcmFtIHZhbHVlXG4gICAqIEBwYXJhbSBlcnJvcnNcbiAgICovXG4gIGVycm9yTWVzc2FnZU1vZGlmaWVyKHZhbHVlLCBlcnJvcnMpIHtcbiAgICBpZiAoZXJyb3JzWyd1bmd1ZWx0aWcnXSkge1xuICAgICAgcmV0dXJuICdEZXIgYXVzZ2V3w6RobHRlIFdlcnQgaXN0IHVuZ8O8bHRpZy4nO1xuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgZ2V0TGFiZWwoZW50cnk6IGFueSk6IHN0cmluZyB7XG4gICAgaWYgKHRoaXMuaXNSZW5kZXJQcm9wQUZ1bmN0aW9uKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLmx1eFJlbmRlclByb3AoZW50cnkpO1xuICAgIH1cbiAgICBpZiAoZW50cnlbdGhpcy5sdXhSZW5kZXJQcm9wIGFzIHN0cmluZ10pIHtcbiAgICAgIHJldHVybiBlbnRyeVs8c3RyaW5nPnRoaXMubHV4UmVuZGVyUHJvcF07XG4gICAgfVxuICAgIHJldHVybiAnRmVobGVyIGJlaW0gQXVzbGVzZW4gKFByb3BlcnR5IHVuYmVrYW5udCknO1xuICB9XG5cbiAgLyoqXG4gICAqIEhvbHQgZGllIExvb2t1cC1UYWJsZSBEYXRlbiB2b20gQmFja2VuZFxuICAgKi9cbiAgcHJvdGVjdGVkIGZldGNoTG9va3VwRGF0YSgpIHtcbiAgICBjb25zdCBiYWNrZW5kUmVxdWVzdCA9IHRoaXMubG9va3VwU2VydmljZS5nZXRMb29rdXBUYWJsZSh0aGlzLmx1eFRhYmxlTm8sIHRoaXMubHV4UGFyYW1ldGVycywgdGhpcy5hcGlQYXRoKTtcbiAgICBiYWNrZW5kUmVxdWVzdC5zdWJzY3JpYmUoXG4gICAgICAoZW50cmllczogTHV4TG9va3VwVGFibGVFbnRyeVtdKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0TG9va3VwRGF0YShlbnRyaWVzKTtcbiAgICAgICAgdGhpcy5sdXhEYXRhTG9hZGVkLmVtaXQodHJ1ZSk7XG4gICAgICB9LFxuICAgICAgKCkgPT4ge1xuICAgICAgICB0aGlzLmx1eERhdGFMb2FkZWQuZW1pdChmYWxzZSk7XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXR6dCBkaWUgYWt0dWVsbGVuIFdlcnRlIGF1ZiBkaWUgbWl0Z2VnZWJlbmVuIEVudHJpZXMuXG4gICAqIEBwYXJhbSBlbnRyaWVzXG4gICAqL1xuICBwcm90ZWN0ZWQgc2V0TG9va3VwRGF0YShlbnRyaWVzOiBMdXhMb29rdXBUYWJsZUVudHJ5W10pIHtcbiAgICB0aGlzLmVudHJpZXMgPSBlbnRyaWVzO1xuICAgIGlmICh0aGlzLmVudHJpZXMpIHtcbiAgICAgIC8vIE1lcmtlbiB3ZWxjaGUgRWludHJhZWdlIHVuZ3VlbHRpZyBzaW5kLCB1bSBiZWkgdmllbGVuIEluZm9ybWF0aW9uZW5cbiAgICAgIC8vIG5pY2h0IGRpZSBnYW56ZW4gRnVua3Rpb25zYXVmcnVmZSB6dSBoYWJlblxuICAgICAgdGhpcy5lbnRyaWVzLmZvckVhY2goKGVudHJ5OiBMdXhMb29rdXBUYWJsZUVudHJ5KSA9PiB7XG4gICAgICAgIGVudHJ5LmlzVW5ndWVsdGlnID0gdGhpcy5pc1VuZ3VlbHRpZyhlbnRyeSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICAvLyByZWdpb24gT3ZlcnJpZGRlbiBtZXRob2RzXG4gIG5vdGlmeUZvcm1WYWx1ZUNoYW5nZWQoZm9ybVZhbHVlOiBhbnkpIHtcbiAgICB0aGlzLmx1eFZhbHVlQ2hhbmdlLmVtaXQoZm9ybVZhbHVlKTtcbiAgfVxuXG4gIHByb3RlY3RlZCB0cmlnZ2VyT3V0cHV0UGF0dGVybkNoZWNrKCkge1xuICAgIHRoaXMuY2hlY2tPdXRwdXRQYXR0ZXJuVmlvbGF0aW9uKHRoaXMubHV4VmFsdWVDaGFuZ2Uub2JzZXJ2ZXJzKTtcbiAgfVxuXG4gIHByb3RlY3RlZCB0cmlnZ2VySW5wdXRQYXR0ZXJuQ2hlY2soc2ltcGxlQ2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgIHRoaXMuY2hlY2tJbnB1dFBhdHRlcm5WaW9sYXRpb24oc2ltcGxlQ2hhbmdlcy5sdXhWYWx1ZSk7XG4gIH1cblxuICAvLyBlbmRyZWdpb25cbn1cbiJdfQ==