import * as tslib_1 from "tslib";
var LuxInfiniteScrollDirective_1;
import { AfterViewInit, Directive, ElementRef, EventEmitter, Input, OnDestroy, OnInit, Output } from '@angular/core';
import { Subject } from 'rxjs';
import { debounceTime } from 'rxjs/operators';
let LuxInfiniteScrollDirective = LuxInfiniteScrollDirective_1 = class LuxInfiniteScrollDirective {
    /**
     * Constructor
     * @param elementRef Ziel-Element dieser Direktive
     */
    constructor(elementRef) {
        this.elementRef = elementRef;
        this.scroll$ = new Subject();
        this.lastPosition = { scrollHeight: 0, scrollTop: 0, clientHeight: 0 };
        // Prozentzahl nach der ein scrollCallback ausgeloest wird
        this.luxScrollPercent = 85;
        // Direkt bei Initialisierung einen ScrollEvent emitten
        this.luxImmediateCallback = true;
        // Flag ob aktuell Daten geladen werden (aus aufrufender Komponente)
        this.luxIsLoading = false;
        // Emitter an den sich andere Komponenten haengen koennen um auf den Scroll zu reagieren
        this.luxScrolled = new EventEmitter();
    }
    ngOnInit() {
        window.addEventListener('scroll', this.onScroll.bind(this), true);
        // Die neuen Scroll-Events bündeln und nach der Zeitspanne SCROLL_DEBOUNCE_TIME prüfen ob ein
        // "luxScrolled" emitten soll oder nicht.
        this.scrollSubscription = this.scroll$
            .pipe(debounceTime(LuxInfiniteScrollDirective_1.SCROLL_DEBOUNCE_TIME))
            .subscribe(() => {
            this.performScrollCheck();
        });
    }
    ngAfterViewInit() {
        // Prüfen ob ein initiales Laden von Daten starten soll
        if (this.hasScrollbar() && this.luxImmediateCallback && !this.luxIsLoading) {
            this.luxScrolled.emit();
        }
    }
    ngOnDestroy() {
        window.removeEventListener('scroll', this.onScroll, true);
        this.scrollSubscription.unsubscribe();
    }
    /**
     * Prüft ob ein Scroll-Event auf dem Zielelement stattgefunden hat.
     * Wenn ja, wird das Subject scroll$ angestoßen.
     * @param event
     */
    onScroll(event) {
        const target = event.target ? event.target : event.srcElement;
        if (target === this.elementRef.nativeElement) {
            this.scroll$.next();
        }
    }
    /**
     * Holt die aktuelle Position im Scroll-Bereich und fuehrt
     * einen Event-Emit durch wenn die Bedingungen erfuellt sind.
     */
    performScrollCheck() {
        const position = {
            scrollTop: this.elementRef.nativeElement.scrollTop,
            scrollHeight: this.elementRef.nativeElement.scrollHeight,
            clientHeight: this.elementRef.nativeElement.clientHeight
        };
        // Wenn nach unten gescrollt wird und die angegebene Prozentzahl ueberschritten wird
        if (this.isUserScrollingDown(position) && this.isScrollExpectedPercent(position) && !this.luxIsLoading) {
            this.luxScrolled.emit();
        }
        this.lastPosition = position;
    }
    /**
     * Prueft ob der User gerade nach unten scrollt.
     * Vergleicht dabei die scrollTop Position des Users mit der des Elements.
     * @param curPos
     */
    isUserScrollingDown(curPos) {
        return this.lastPosition.scrollTop < curPos.scrollTop;
    }
    /**
     * Prueft ob der Scrollbereich ueberschritten wurde.
     * @param position
     * @returns boolean
     */
    isScrollExpectedPercent(position) {
        return (position.scrollTop + position.clientHeight) / position.scrollHeight > this.luxScrollPercent / 100;
    }
    /**
     * Prüft ob das Zielelement eine Scrollbar gesetzt hat.
     */
    hasScrollbar() {
        return this.elementRef.nativeElement.scrollHeight > this.elementRef.nativeElement.clientHeight;
    }
};
// Zeitgrenze (ms) nach der das neuste Scroll-Event des Subjects genommen wird
LuxInfiniteScrollDirective.SCROLL_DEBOUNCE_TIME = 200;
LuxInfiniteScrollDirective.ctorParameters = () => [
    { type: ElementRef }
];
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object)
], LuxInfiniteScrollDirective.prototype, "luxScrollPercent", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object)
], LuxInfiniteScrollDirective.prototype, "luxImmediateCallback", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object)
], LuxInfiniteScrollDirective.prototype, "luxIsLoading", void 0);
tslib_1.__decorate([
    Output(),
    tslib_1.__metadata("design:type", EventEmitter)
], LuxInfiniteScrollDirective.prototype, "luxScrolled", void 0);
LuxInfiniteScrollDirective = LuxInfiniteScrollDirective_1 = tslib_1.__decorate([
    Directive({
        selector: '[luxInfiniteScroll]'
    }),
    tslib_1.__metadata("design:paramtypes", [ElementRef])
], LuxInfiniteScrollDirective);
export { LuxInfiniteScrollDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibHV4LWluZmluaXRlLXNjcm9sbC5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AaWhrLWdmaS9sdXgtY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbInNyYy9hcHAvbW9kdWxlcy9sdXgtZGlyZWN0aXZlcy9sdXgtaW5maW5pdGUtc2Nyb2xsL2x1eC1pbmZpbml0ZS1zY3JvbGwuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsT0FBTyxFQUFFLGFBQWEsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFckgsT0FBTyxFQUFFLE9BQU8sRUFBZ0IsTUFBTSxNQUFNLENBQUM7QUFDN0MsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBSzlDLElBQWEsMEJBQTBCLGtDQUF2QyxNQUFhLDBCQUEwQjtJQWlCckM7OztPQUdHO0lBQ0gsWUFBb0IsVUFBc0I7UUFBdEIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQWhCbEMsWUFBTyxHQUFrQixJQUFJLE9BQU8sRUFBUSxDQUFDO1FBQzdDLGlCQUFZLEdBQXNCLEVBQUUsWUFBWSxFQUFFLENBQUMsRUFBRSxTQUFTLEVBQUUsQ0FBQyxFQUFFLFlBQVksRUFBRSxDQUFDLEVBQUUsQ0FBQztRQUU3RiwwREFBMEQ7UUFDakQscUJBQWdCLEdBQUcsRUFBRSxDQUFDO1FBQy9CLHVEQUF1RDtRQUM5Qyx5QkFBb0IsR0FBRyxJQUFJLENBQUM7UUFDckMsb0VBQW9FO1FBQzNELGlCQUFZLEdBQUcsS0FBSyxDQUFDO1FBQzlCLHdGQUF3RjtRQUM5RSxnQkFBVyxHQUF1QixJQUFJLFlBQVksRUFBUSxDQUFDO0lBTXhCLENBQUM7SUFFOUMsUUFBUTtRQUNOLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMs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QjtJQUh0QyxTQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUscUJBQXFCO0tBQ2hDLENBQUM7NkNBc0JnQyxVQUFVO0dBckIvQiwwQkFBMEIsQ0FxR3RDO1NBckdZLDBCQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFmdGVyVmlld0luaXQsIERpcmVjdGl2ZSwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25EZXN0cm95LCBPbkluaXQsIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTHV4U2Nyb2xsUG9zaXRpb24gfSBmcm9tICcuL2x1eC1zY3JvbGwtcG9zaXRpb24nO1xuaW1wb3J0IHsgU3ViamVjdCwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ1tsdXhJbmZpbml0ZVNjcm9sbF0nXG59KVxuZXhwb3J0IGNsYXNzIEx1eEluZmluaXRlU2Nyb2xsRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xuICAvLyBaZWl0Z3JlbnplIChtcykgbmFjaCBkZXIgZGFzIG5ldXN0ZSBTY3JvbGwtRXZlbnQgZGVzIFN1YmplY3RzIGdlbm9tbWVuIHdpcmRcbiAgc3RhdGljIHJlYWRvbmx5IFNDUk9MTF9ERUJPVU5DRV9USU1FOiBudW1iZXIgPSAyMDA7XG5cbiAgcHJpdmF0ZSBzY3JvbGxTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcbiAgcHJpdmF0ZSBzY3JvbGwkOiBTdWJqZWN0PHZvaWQ+ID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcbiAgcHJpdmF0ZSBsYXN0UG9zaXRpb246IEx1eFNjcm9sbFBvc2l0aW9uID0geyBzY3JvbGxIZWlnaHQ6IDAsIHNjcm9sbFRvcDogMCwgY2xpZW50SGVpZ2h0OiAwIH07XG5cbiAgLy8gUHJvemVudHphaGwgbmFjaCBkZXIgZWluIHNjcm9sbENhbGxiYWNrIGF1c2dlbG9lc3Qgd2lyZFxuICBASW5wdXQoKSBsdXhTY3JvbGxQZXJjZW50ID0gODU7XG4gIC8vIERpcmVrdCBiZWkgSW5pdGlhbGlzaWVydW5nIGVpbmVuIFNjcm9sbEV2ZW50IGVtaXR0ZW5cbiAgQElucHV0KCkgbHV4SW1tZWRpYXRlQ2FsbGJhY2sgPSB0cnVlO1xuICAvLyBGbGFnIG9iIGFrdHVlbGwgRGF0ZW4gZ2VsYWRlbiB3ZXJkZW4gKGF1cyBhdWZydWZlbmRlciBLb21wb25lbnRlKVxuICBASW5wdXQoKSBsdXhJc0xvYWRpbmcgPSBmYWxzZTtcbiAgLy8gRW1pdHRlciBhbiBkZW4gc2ljaCBhbmRlcmUgS29tcG9uZW50ZW4gaGFlbmdlbiBrb2VubmVuIHVtIGF1ZiBkZW4gU2Nyb2xsIHp1IHJlYWdpZXJlblxuICBAT3V0cHV0KCkgbHV4U2Nyb2xsZWQ6IEV2ZW50RW1pdHRlcjx2b2lkPiA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcblxuICAvKipcbiAgICogQ29uc3RydWN0b3JcbiAgICogQHBhcmFtIGVsZW1lbnRSZWYgWmllbC1FbGVtZW50IGRpZXNlciBEaXJla3RpdmVcbiAgICovXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZikge31cblxuICBuZ09uSW5pdCgpIHtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgdGhpcy5vblNjcm9sbC5iaW5kKHRoaXMpLCB0cnVlKTtcbiAgICAvLyBEaWUgbmV1ZW4gU2Nyb2xsLUV2ZW50cyBiw7xuZGVsbiB1bmQgbmFjaCBkZXIgWmVpdHNwYW5uZSBTQ1JPTExfREVCT1VOQ0VfVElNRSBwcsO8ZmVuIG9iIGVpblxuICAgIC8vIFwibHV4U2Nyb2xsZWRcIiBlbWl0dGVuIHNvbGwgb2RlciBuaWNodC5cbiAgICB0aGlzLnNjcm9sbFN1YnNjcmlwdGlvbiA9IHRoaXMuc2Nyb2xsJFxuICAgICAgLnBpcGUoZGVib3VuY2VUaW1lKEx1eEluZmluaXRlU2Nyb2xsRGlyZWN0aXZlLlNDUk9MTF9ERUJPVU5DRV9USU1FKSlcbiAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICB0aGlzLnBlcmZvcm1TY3JvbGxDaGVjaygpO1xuICAgICAgfSk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgLy8gUHLDvGZlbiBvYiBlaW4gaW5pdGlhbGVzIExhZGVuIHZvbiBEYXRlbiBzdGFydGVuIHNvbGxcbiAgICBpZiAodGhpcy5oYXNTY3JvbGxiYXIoKSAmJiB0aGlzLmx1eEltbWVkaWF0ZUNhbGxiYWNrICYmICF0aGlzLmx1eElzTG9hZGluZykge1xuICAgICAgdGhpcy5sdXhTY3JvbGxlZC5lbWl0KCk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHRoaXMub25TY3JvbGwsIHRydWUpO1xuICAgIHRoaXMuc2Nyb2xsU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gIH1cblxuICAvKipcbiAgICogUHLDvGZ0IG9iIGVpbiBTY3JvbGwtRXZlbnQgYXVmIGRlbSBaaWVsZWxlbWVudCBzdGF0dGdlZnVuZGVuIGhhdC5cbiAgICogV2VubiBqYSwgd2lyZCBkYXMgU3ViamVjdCBzY3JvbGwkIGFuZ2VzdG/Dn2VuLlxuICAgKiBAcGFyYW0gZXZlbnRcbiAgICovXG4gIG9uU2Nyb2xsKGV2ZW50OiBhbnkpIHtcbiAgICBjb25zdCB0YXJnZXQgPSBldmVudC50YXJnZXQgPyBldmVudC50YXJnZXQgOiBldmVudC5zcmNFbGVtZW50O1xuICAgIGlmICh0YXJnZXQgPT09IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50KSB7XG4gICAgICB0aGlzLnNjcm9sbCQubmV4dCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBIb2x0IGRpZSBha3R1ZWxsZSBQb3NpdGlvbiBpbSBTY3JvbGwtQmVyZWljaCB1bmQgZnVlaHJ0XG4gICAqIGVpbmVuIEV2ZW50LUVtaXQgZHVyY2ggd2VubiBkaWUgQmVkaW5ndW5nZW4gZXJmdWVsbHQgc2luZC5cbiAgICovXG4gIHByaXZhdGUgcGVyZm9ybVNjcm9sbENoZWNrKCkge1xuICAgIGNvbnN0IHBvc2l0aW9uOiBMdXhTY3JvbGxQb3NpdGlvbiA9IHtcbiAgICAgIHNjcm9sbFRvcDogdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsVG9wLFxuICAgICAgc2Nyb2xsSGVpZ2h0OiB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5zY3JvbGxIZWlnaHQsXG4gICAgICBjbGllbnRIZWlnaHQ6IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmNsaWVudEhlaWdodFxuICAgIH07XG5cbiAgICAvLyBXZW5uIG5hY2ggdW50ZW4gZ2VzY3JvbGx0IHdpcmQgdW5kIGRpZSBhbmdlZ2ViZW5lIFByb3plbnR6YWhsIHVlYmVyc2Nocml0dGVuIHdpcmRcbiAgICBpZiAodGhpcy5pc1VzZXJTY3JvbGxpbmdEb3duKHBvc2l0aW9uKSAmJiB0aGlzLmlzU2Nyb2xsRXhwZWN0ZWRQZXJjZW50KHBvc2l0aW9uKSAmJiAhdGhpcy5sdXhJc0xvYWRpbmcpIHtcbiAgICAgIHRoaXMubHV4U2Nyb2xsZWQuZW1pdCgpO1xuICAgIH1cblxuICAgIHRoaXMubGFzdFBvc2l0aW9uID0gcG9zaXRpb247XG4gIH1cblxuICAvKipcbiAgICogUHJ1ZWZ0IG9iIGRlciBVc2VyIGdlcmFkZSBuYWNoIHVudGVuIHNjcm9sbHQuXG4gICAqIFZlcmdsZWljaHQgZGFiZWkgZGllIHNjcm9sbFRvcCBQb3NpdGlvbiBkZXMgVXNlcnMgbWl0IGRlciBkZXMgRWxlbWVudHMuXG4gICAqIEBwYXJhbSBjdXJQb3NcbiAgICovXG4gIHByaXZhdGUgaXNVc2VyU2Nyb2xsaW5nRG93bihjdXJQb3M6IEx1eFNjcm9sbFBvc2l0aW9uKSB7XG4gICAgcmV0dXJuIHRoaXMubGFzdFBvc2l0aW9uLnNjcm9sbFRvcCA8IGN1clBvcy5zY3JvbGxUb3A7XG4gIH1cblxuICAvKipcbiAgICogUHJ1ZWZ0IG9iIGRlciBTY3JvbGxiZXJlaWNoIHVlYmVyc2Nocml0dGVuIHd1cmRlLlxuICAgKiBAcGFyYW0gcG9zaXRpb25cbiAgICogQHJldHVybnMgYm9vbGVhblxuICAgKi9cbiAgcHJpdmF0ZSBpc1Njcm9sbEV4cGVjdGVkUGVyY2VudChwb3NpdGlvbikge1xuICAgIHJldHVybiAocG9zaXRpb24uc2Nyb2xsVG9wICsgcG9zaXRpb24uY2xpZW50SGVpZ2h0KSAvIHBvc2l0aW9uLnNjcm9sbEhlaWdodCA+IHRoaXMubHV4U2Nyb2xsUGVyY2VudCAvIDEwMDtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcsO8ZnQgb2IgZGFzIFppZWxlbGVtZW50IGVpbmUgU2Nyb2xsYmFyIGdlc2V0enQgaGF0LlxuICAgKi9cbiAgcHJpdmF0ZSBoYXNTY3JvbGxiYXIoKSB7XG4gICAgcmV0dXJuIHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnNjcm9sbEhlaWdodCA+IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmNsaWVudEhlaWdodDtcbiAgfVxufVxuIl19