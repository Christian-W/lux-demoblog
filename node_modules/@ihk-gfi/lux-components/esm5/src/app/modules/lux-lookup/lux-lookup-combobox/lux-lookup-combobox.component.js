import * as tslib_1 from "tslib";
import { AfterViewInit, ChangeDetectorRef, Component, Input, Optional, ViewChild } from '@angular/core';
import { LuxLookupService } from '../lux-lookup-service/lux-lookup.service';
import { ControlContainer } from '@angular/forms';
import { LuxLookupComponent } from '../lux-lookup-model/lux-lookup-component';
import { MatSelect } from '@angular/material';
import { LuxLookupHandlerService } from '../lux-lookup-service/lux-lookup-handler.service';
import { LuxLookupErrorStateMatcher } from '../lux-lookup-model/lux-lookup-error-state-matcher';
import { LuxConsoleService } from '../../lux-util/lux-console.service';
import { LuxComponentsConfigService } from '../../lux-components-config/lux-components-config.service';
var LuxLookupComboboxComponent = /** @class */ (function (_super) {
    tslib_1.__extends(LuxLookupComboboxComponent, _super);
    function LuxLookupComboboxComponent(lookupService, lookupHandler, controlContainer, cdr, logger, componentsConfigService) {
        var _this = _super.call(this, lookupService, lookupHandler, controlContainer, cdr, logger, componentsConfigService) || this;
        _this.luxMultiple = false;
        _this.luxEntryBlockSize = 25;
        _this.stateMatcher = new LuxLookupErrorStateMatcher(_this);
        return _this;
    }
    LuxLookupComboboxComponent.prototype.ngAfterViewInit = function () {
        var _this = this;
        this.matSelect.openedChange.subscribe(function (open) {
            if (open) {
                _this.registerPanelScrollEvent(_this.matSelect.panel.nativeElement);
            }
        });
    };
    /**
     * Vergleicht die Optionen anhand der Key-Werte
     * @param value1
     * @param value2
     * @returns boolean
     */
    LuxLookupComboboxComponent.prototype.compareByKey = function (value1, value2) {
        var key1 = value1 ? value1.key : -1;
        var key2 = value2 ? value2.key : -2;
        return key1 === key2;
    };
    LuxLookupComboboxComponent.prototype.setLookupData = function (entries) {
        _super.prototype.setLookupData.call(this, entries);
        if (this.entries.length > this.luxEntryBlockSize) {
            this.displayedEntries = this.entries.splice(0, this.luxEntryBlockSize);
        }
        else {
            this.displayedEntries = tslib_1.__spread(this.entries);
        }
    };
    /**
     * Setzt den aktuellen Value-Wert auf den ausgewÃ¤hlten Wert.
     * @param $event
     */
    LuxLookupComboboxComponent.prototype.selected = function ($event) {
        this.luxValue = $event.value;
    };
    /**
     * Fuegt beim Oeffnen des Selects einen Scrolllistener hinzu.
     */
    LuxLookupComboboxComponent.prototype.registerPanelScrollEvent = function (panelElement) {
        var _this = this;
        panelElement.addEventListener('scroll', function (event) { return _this.loadOnScroll(event); });
    };
    /**
     * Stoesst das Nachladen von Elementen an, wenn ein bestimmter Scrollwert erreicht wurde.
     * @param event - ScrollEvent
     */
    LuxLookupComboboxComponent.prototype.loadOnScroll = function (event) {
        var position = event.target;
        if ((position.scrollTop + position.clientHeight) / position.scrollHeight > 85 / 100) {
            this.reloadNextDataBlock();
        }
    };
    /**
     * Laed den naechsten Block Daten aus den Entries nach.
     */
    LuxLookupComboboxComponent.prototype.reloadNextDataBlock = function () {
        var _a;
        var start = this.displayedEntries.length - 1;
        var end = start + this.luxEntryBlockSize > this.entries.length
            ? this.entries.length - start
            : start + this.luxEntryBlockSize;
        (_a = this.displayedEntries).push.apply(_a, tslib_1.__spread(this.entries.splice(start, end)));
    };
    LuxLookupComboboxComponent.ctorParameters = function () { return [
        { type: LuxLookupService },
        { type: LuxLookupHandlerService },
        { type: ControlContainer, decorators: [{ type: Optional }] },
        { type: ChangeDetectorRef },
        { type: LuxConsoleService },
        { type: LuxComponentsConfigService }
    ]; };
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Boolean)
    ], LuxLookupComboboxComponent.prototype, "luxMultiple", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Number)
    ], LuxLookupComboboxComponent.prototype, "luxEntryBlockSize", void 0);
    tslib_1.__decorate([
        ViewChild(MatSelect, { static: false }),
        tslib_1.__metadata("design:type", MatSelect)
    ], LuxLookupComboboxComponent.prototype, "matSelect", void 0);
    LuxLookupComboboxComponent = tslib_1.__decorate([
        Component({
            selector: 'lux-lookup-combobox',
            template: "<lux-form-control [luxFormComponent]=\"this\" [formGroup]=\"formGroup\" *ngIf=\"formGroup\">\n  <mat-select\n    [placeholder]=\"luxPlaceholder\"\n    [multiple]=\"luxMultiple\"\n    [required]=\"luxRequired\"\n    [formControl]=\"formControl\"\n    luxTagIdHandler\n    [luxTagId]=\"luxTagId\"\n    [panelClass]=\"'lux-select-panel'\"\n    [errorStateMatcher]=\"stateMatcher\"\n    [compareWith]=\"compareByKey\"\n    (focusin)=\"luxFocusIn.emit($event)\"\n    [panelClass]=\"'lux-lookup-panel'\"\n    (focusout)=\"luxFocusOut.emit($event)\"\n    [id]=\"uid\"\n    [luxAriaDescribedby]=\"uid + '-error ' + uid + '-hint'\"\n    [attr.aria-invalid]=\"formControl.invalid\"\n    [attr.aria-required]=\"luxRequired\"\n  >\n    <ng-container *ngFor=\"let entry of displayedEntries\">\n      <mat-option\n        [value]=\"entry\"\n        [ngClass]=\"{ invalid: entry.isUngueltig }\"\n        [ngStyle]=\"getStyles(entry.isUngueltig)\"\n        [disabled]=\"entry.isUngueltig && disableUngueltige()\"\n        *ngIf=\"!entry.isUngueltig || (entry.isUngueltig && showUngueltige())\"\n      >\n        <span>{{ getLabel(entry) }}</span>\n      </mat-option>\n    </ng-container>\n  </mat-select>\n</lux-form-control>\n",
            styles: ["@charset \"UTF-8\";lux-side-nav .lux-side-nav-item,lux-side-nav lux-link{box-sizing:border-box}lux-side-nav .lux-side-nav-item.lux-side-nav-item-selected,lux-side-nav lux-link.lux-side-nav-item-selected{background-color:rgba(112,141,170,.2)!important;position:relative;border-radius:4px}lux-side-nav .lux-side-nav-item.lux-side-nav-item-selected:after,lux-side-nav lux-link.lux-side-nav-item-selected:after{content:'';left:0;width:6px;top:0;bottom:0;position:absolute;border-left:6px solid #0073b3;border-radius:4px 0 0 4px}lux-side-nav .lux-side-nav-item button .mat-button-focus-overlay,lux-side-nav lux-link button .mat-button-focus-overlay{display:none}lux-side-nav .lux-side-nav-item button:focus,lux-side-nav lux-link button:focus{outline-width:0!important;outline-style:unset;background-color:rgba(112,141,170,.2)!important;border-radius:4px}lux-side-nav .lux-side-nav-item button:hover,lux-side-nav lux-link button:hover{background-color:rgba(0,0,0,.2)!important;border-radius:4px}lux-list{border:4px solid transparent}lux-list:focus{outline-width:0;border:4px solid rgba(112,141,170,.2)!important}lux-list lux-list-item:focus{outline-width:0}lux-list lux-list-item:focus mat-card{outline-width:0!important;outline-style:unset;background-color:rgba(112,141,170,.2)!important;border-radius:4px}lux-list lux-list-item lux-card.lux-list-item-selected mat-card{background-color:rgba(112,141,170,.2)!important;position:relative;border-radius:4px}lux-list lux-list-item lux-card.lux-list-item-selected mat-card:after{content:'';left:0;width:6px;top:0;bottom:0;position:absolute;border-left:6px solid #0073b3;border-radius:4px 0 0 4px}lux-list lux-list-item lux-card mat-card{box-sizing:border-box}lux-list lux-list-item lux-card mat-card:hover{background-color:rgba(0,0,0,.2)!important;border-radius:4px}lux-form-control .lux-form-control:not(.lux-form-control-disabled).lux-focused .lux-form-control-label>*{color:#335c85}lux-form-control .lux-form-control:not(.lux-form-control-disabled).lux-focused .cdk-focused .mat-radio-container,lux-form-control .lux-form-control:not(.lux-form-control-disabled).lux-focused .mat-checkbox-inner-container,lux-form-control .lux-form-control:not(.lux-form-control-disabled).lux-focused .mat-slide-toggle-thumb{position:relative}lux-form-control .lux-form-control:not(.lux-form-control-disabled).lux-focused .cdk-focused .mat-radio-container:after,lux-form-control .lux-form-control:not(.lux-form-control-disabled).lux-focused .mat-checkbox-inner-container:after,lux-form-control .lux-form-control:not(.lux-form-control-disabled).lux-focused .mat-slide-toggle-thumb:after{content:\"\";border:1px solid rgba(112,141,170,.2);background-color:rgba(112,141,170,.2);display:block;top:-4px;left:-4px;right:-4px;bottom:-4px;border-radius:15px;z-index:1;position:absolute}lux-form-control .lux-form-control:not(.lux-form-control-disabled).lux-focused .lux-form-control-container:after{content:'';display:block;box-sizing:border-box;left:0;right:0;position:absolute;height:2px;border-bottom:2px solid #0073b3}lux-datepicker mat-datepicker-toggle button:focus:after{content:\"\";border:1px solid rgba(112,141,170,.2);background-color:rgba(112,141,170,.2);display:block;top:-4px;left:-4px;right:-4px;bottom:-4px;border-radius:15px;z-index:1;position:absolute}.lux-datepicker-panel .mat-calendar-header button .mat-button-focus-overlay,lux-datepicker mat-datepicker-toggle .mat-button-focus-overlay{display:none}.lux-datepicker-panel .mat-calendar-header button:focus{outline-width:0!important;outline-style:unset;background-color:rgba(112,141,170,.2)!important;border-radius:4px}.lux-datepicker-panel .mat-calendar-header button:hover{background-color:rgba(0,0,0,.2)!important;border-radius:4px}.lux-datepicker-panel .mat-calendar-content td.mat-calendar-body-cell:hover>div{background-color:rgba(0,0,0,.2)!important;border-radius:999px}.lux-datepicker-panel .mat-calendar-content td.mat-calendar-body-cell.mat-calendar-body-active>div{outline-width:0!important;outline-style:unset;background-color:rgba(112,141,170,.2)!important;border-radius:999px}lux-table tr:hover>td,lux-table tr:hover>th{border-radius:0;background-color:#cfcfcf!important}lux-table th button.mat-sort-header-button:focus{outline-width:0!important;outline-style:unset;background-color:rgba(112,141,170,.2)!important;border-radius:4px}.lux-select-panel mat-option{border-left:0;box-sizing:border-box}.lux-select-panel mat-option.mat-selected{background-color:rgba(112,141,170,.2)!important;position:relative;border-radius:4px}.lux-select-panel mat-option.mat-selected:after{content:'';left:0;width:6px;top:0;bottom:0;position:absolute;border-left:6px solid #0073b3;border-radius:4px 0 0 4px}.lux-select-panel mat-option:focus{outline-width:0!important;outline-style:unset;background-color:rgba(112,141,170,.2)!important;border-radius:4px}.lux-select-panel mat-option.mat-active,.lux-select-panel mat-option:hover{background-color:rgba(0,0,0,.2)!important;border-radius:4px}lux-button button:not([disabled]) .mat-button-focus-overlay{display:none}lux-button button:not([disabled]):not(.mat-fab):not(.mat-raised-button):focus{background-color:rgba(112,141,170,.2)!important}lux-button button:not([disabled]):not(.mat-fab):not(.mat-raised-button):hover{background-color:rgba(0,0,0,.2)!important;border-radius:4px}lux-button button:not([disabled]).mat-fab:focus,lux-button button:not([disabled]).mat-raised-button:focus{background-color:rgba(112,141,170,.2)!important}lux-button button:not([disabled]).mat-fab:focus.mat-accent,lux-button button:not([disabled]).mat-raised-button:focus.mat-accent{background-color:#b6d184!important}lux-button button:not([disabled]).mat-fab:focus.mat-warn,lux-button button:not([disabled]).mat-raised-button:focus.mat-warn{background-color:#ea2524!important}lux-button button:not([disabled]).mat-fab:focus.mat-primary,lux-button button:not([disabled]).mat-raised-button:focus.mat-primary{background-color:#4b82ba!important}.lux-autocomplete-panel mat-option{border-left:0;box-sizing:border-box}.lux-autocomplete-panel mat-option:focus{outline-width:0!important;outline-style:unset;background-color:rgba(112,141,170,.2)!important;border-radius:4px}.lux-autocomplete-panel mat-option.mat-active,.lux-autocomplete-panel mat-option:hover{background-color:rgba(0,0,0,.2)!important;border-radius:4px}lux-tabs mat-ink-bar{background-color:#0073b3!important}lux-tabs .mat-tab-label:focus{outline-width:0!important;outline-style:unset;background-color:rgba(112,141,170,.2)!important;border-radius:4px}lux-panel mat-expansion-panel-header:hover,lux-stepper mat-step-header:hover{background-color:rgba(0,0,0,.2)!important;border-radius:4px}lux-panel mat-expansion-panel-header:focus,lux-stepper mat-step-header:focus,lux-stepper mat-step-header[aria-selected=true],lux-tile mat-card:focus{outline-width:0!important;outline-style:unset;background-color:rgba(112,141,170,.2)!important;border-radius:4px}lux-master-detail lux-master-header .lux-master-header-collapse button.lux-button:not(.mat-fab):not(.mat-raised-button):focus{background-color:rgba(0,0,0,.2)!important}lux-file-list .lux-file-list{border:4px solid transparent}lux-file-list .lux-file-list:focus{outline-width:0;border:4px solid rgba(112,141,170,.2)!important}lux-file-list .lux-file-list .lux-file-list-entry{border:4px solid transparent}lux-file-list .lux-file-list .lux-file-list-entry:focus{outline-width:0;border:4px solid rgba(112,141,170,.2)!important}lux-file-list .lux-file-list mat-card{margin:4px}.lux-menu-panel .lux-menu-item:not([disabled=true]):focus{outline-width:0!important;outline-style:unset;background-color:rgba(112,141,170,.2)!important;border-radius:4px}.lux-menu-panel .lux-menu-item:not([disabled=true]):hover{background-color:rgba(0,0,0,.2)!important;border-radius:4px}lux-dialog-structure lux-dialog-content:focus,lux-dialog-structure lux-dialog-title:focus{outline-width:0!important;outline-style:unset;background-color:rgba(112,141,170,.2)!important;border-radius:4px}example-root .example-base-components-list .example-component-list-item,example-root .example-base-components-list mat-expansion-panel-header{box-sizing:border-box}example-root .example-base-components-list .example-component-list-item.example-component-list-item-selected,example-root .example-base-components-list mat-expansion-panel-header.example-component-list-item-selected{background-color:rgba(112,141,170,.2)!important;position:relative;border-radius:4px}example-root .example-base-components-list .example-component-list-item.example-component-list-item-selected:after,example-root .example-base-components-list mat-expansion-panel-header.example-component-list-item-selected:after{content:'';left:0;width:6px;top:0;bottom:0;position:absolute;border-left:6px solid #0073b3;border-radius:4px 0 0 4px}example-root .example-base-components-list .example-component-list-item:focus,example-root .example-base-components-list mat-expansion-panel-header:focus{outline-width:0!important;outline-style:unset;background-color:rgba(112,141,170,.2)!important;border-radius:4px}example-root .example-base-components-list .example-component-list-item:hover,example-root .example-base-components-list mat-expansion-panel-header:hover{background-color:rgba(0,0,0,.2)!important;border-radius:4px}.lux-app-container,body,html{height:100%}.lux-app-container{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;box-sizing:border-box;display:-webkit-box;display:-ms-flexbox;display:flex}body{-webkit-overflow-scrolling:touch}div{font-family:Roboto,Helvetica Neue,sans-serif}.cdk-overlay-backdrop.cdk-overlay-backdrop-showing.lux-file-preview-backdrop{background:#000;opacity:.8!important}lux-card.lux-card-grow{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto;width:400px;min-width:0}lux-card.lux-card-grow mat-card,lux-card.lux-card-grow mat-card-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto;min-width:0}.lux-crop{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.lux-label{color:rgba(0,0,0,.54);font-size:75%}.lux-hint{color:rgba(0,0,0,.6);font-size:12px}.lux-display-none{display:none}.lux-hidden{visibility:hidden}.lux-nowrap{white-space:nowrap}.lux-cursor{cursor:pointer}.lux-block-pointer-events{pointer-events:none}.lux-vertical-align-baseline{vertical-align:baseline!important}.lux-black-semi-transparent{color:rgba(0,0,0,.87)}.lux-semi-transparent{opacity:.6}.lux-overflow-y-hidden{overflow-y:hidden}.lux-overflow-y-auto{overflow-y:auto}.lux-overflow-wrap-break-word{overflow-wrap:break-word}.lux-bold{font-weight:700!important}.lux-uppercase{text-transform:uppercase!important}.lux-lowercase{text-transform:lowercase!important}.lux-hyphenate{overflow-wrap:break-word;word-wrap:break-word;word-break:normal;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow-x:auto}.lux-p-footer,.lux-p-header{padding:8px}.lux-snackbar{top:68px;right:8px;position:absolute;margin:0!important;min-width:unset!important;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12)}.mat-snack-bar-handset .lux-snackbar{left:8px;width:auto!important}.lux-mt-0{margin-top:0}.lux-pt-0{padding-top:0}.lux-mt-1{margin-top:2px}.lux-pt-1{padding-top:2px}.lux-mt-2{margin-top:4px}.lux-pt-2{padding-top:4px}.lux-mt-3{margin-top:8px}.lux-pt-3{padding-top:8px}.lux-mt-4{margin-top:16px}.lux-pt-4{padding-top:16px}.lux-mb-0{margin-bottom:0}.lux-pb-0{padding-bottom:0}.lux-mb-1{margin-bottom:2px}.lux-pb-1{padding-bottom:2px}.lux-mb-2{margin-bottom:4px}.lux-pb-2{padding-bottom:4px}.lux-mb-3{margin-bottom:8px}.lux-pb-3{padding-bottom:8px}.lux-mb-4{margin-bottom:16px}.lux-pb-4{padding-bottom:16px}.lux-ml-0{margin-left:0}.lux-pl-0{padding-left:0}.lux-ml-1{margin-left:2px}.lux-pl-1{padding-left:2px}.lux-ml-2{margin-left:4px}.lux-pl-2{padding-left:4px}.lux-ml-3{margin-left:8px}.lux-pl-3{padding-left:8px}.lux-ml-4{margin-left:16px}.lux-pl-4{padding-left:16px}.lux-m-0{margin:0}.lux-mr-0{margin-right:0}.lux-p-0{padding:0}.lux-pr-0{padding-right:0}.lux-m-1{margin:2px}.lux-mr-1{margin-right:2px}.lux-p-1{padding:2px}.lux-pr-1{padding-right:2px}.lux-m-2{margin:4px}.lux-mr-2{margin-right:4px}.lux-p-2{padding:4px}.lux-pr-2{padding-right:4px}.lux-m-3{margin:8px}.lux-mr-3{margin-right:8px}.lux-p-3{padding:8px}.lux-pr-3{padding-right:8px}.lux-m-4{margin:16px}.lux-mr-4{margin-right:16px}.lux-p-4{padding:16px}.lux-pr-4{padding-right:16px}.lux-flex-layout-gap-10[style*=row]>:not(:last-child){margin-right:10px}.lux-flex-layout-gap-10[style*=column]>:not(:last-child){margin-bottom:10px}.lux-flex-layout-gap-20[style*=row]>:not(:last-child){margin-right:20px}.lux-flex-layout-gap-20[style*=column]>:not(:last-child){margin-bottom:20px}.lux-flex-layout-gap-30[style*=row]>:not(:last-child){margin-right:30px}.lux-flex-layout-gap-30[style*=column]>:not(:last-child){margin-bottom:30px}.lux-z-index-100{z-index:100}.lux-z-index-500{z-index:500}.lux-z-index-1000{z-index:1000}.lux-uppercase>lux-button .lux-button-label,lux-button.lux-uppercase .lux-button-label{text-transform:uppercase}.lux-bg-color-red{background:#b01211}.lux-bg-color-green{background:#95bc4c}.lux-bg-color-yellow{background:#ebc000}.lux-bg-color-blue{background:#335c85}.lux-bg-color-gray{background:#c8c8c8}.lux-bg-color-orange{background:#ec9c1b}.lux-bg-color-brown{background:#783f04}.lux-font-color-black{color:#000}.lux-font-color-white{color:#fff}.lux-badge-notification.mat-badge-large .mat-badge-content{font-size:15px}.lux-badge-notification.lux-badge-color-default .mat-badge-content{color:#000;background:#fff;border:1px solid rgba(0,0,0,.87)}mat-error,mat-hint{font-size:.75em;position:absolute;top:0}.mat-form-field-invalid+.hint-error-box .mat-hint{display:none}.hint-error-box{position:relative;margin-top:-2em}::ng-deep mat-option{border-left:2px solid #fff}::ng-deep mat-option.invalid{border-left:2px solid #b01211}.lux-readonly{pointer-events:none}::ng-deep .lux-lookup-panel.mat-select-panel{max-width:100%!important}::ng-deep .lux-select-panel mat-option:not(:last-of-type){margin-bottom:2px}"]
        }),
        tslib_1.__param(2, Optional()),
        tslib_1.__metadata("design:paramtypes", [LuxLookupService,
            LuxLookupHandlerService,
            ControlContainer,
            ChangeDetectorRef,
            LuxConsoleService,
            LuxComponentsConfigService])
    ], LuxLookupComboboxComponent);
    return LuxLookupComboboxComponent;
}(LuxLookupComponent));
export { LuxLookupComboboxComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibHV4LWxvb2t1cC1jb21ib2JveC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AaWhrLWdmaS9sdXgtY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbInNyYy9hcHAvbW9kdWxlcy9sdXgtbG9va3VwL2x1eC1sb29rdXAtY29tYm9ib3gvbHV4LWxvb2t1cC1jb21ib2JveC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxhQUFhLEVBQUUsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXhHLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLDBDQUEwQyxDQUFDO0FBQzVFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLDBDQUEwQyxDQUFDO0FBQzlFLE9BQU8sRUFBRSxTQUFTLEVBQW1CLE1BQU0sbUJBQW1CLENBQUM7QUFDL0QsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sa0RBQWtELENBQUM7QUFDM0YsT0FBTyxFQUFFLDBCQUEwQixFQUFFLE1BQU0sb0RBQW9ELENBQUM7QUFDaEcsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFDdkUsT0FBTyxFQUFFLDBCQUEwQixFQUFFLE1BQU0sMkRBQTJELENBQUM7QUFPdkc7SUFBZ0Qsc0RBQWtCO0lBT2hFLG9DQUNFLGFBQStCLEVBQy9CLGFBQXNDLEVBQzFCLGdCQUFrQyxFQUM5QyxHQUFzQixFQUN0QixNQUF5QixFQUN6Qix1QkFBbUQ7UUFOckQsWUFRRSxrQkFBTSxhQUFhLEVBQUUsYUFBYSxFQUFFLGdCQUFnQixFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsdUJBQXVCLENBQUMsU0FHNUY7UUFqQlEsaUJBQVcsR0FBWSxLQUFLLENBQUM7UUFDN0IsdUJBQWlCLEdBQVcs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O2dCQUNKLGlCQUFpQjtnQkFDZCxpQkFBaUI7Z0JBQ0EsMEJBQTBCOztJQVo1QztRQUFSLEtBQUssRUFBRTs7bUVBQThCO0lBQzdCO1FBQVIsS0FBSyxFQUFFOzt5RUFBZ0M7SUFHQztRQUF4QyxTQUFTLENBQUMsU0FBUyxFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxDQUFDOzBDQUFZLFNBQVM7aUVBQUM7SUFMbkQsMEJBQTBCO1FBTHRDLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSxxQkFBcUI7WUFDL0Isd3NDQUFtRDs7U0FFcEQsQ0FBQztRQVdHLG1CQUFBLFFBQVEsRUFBRSxDQUFBO2lEQUZJLGdCQUFnQjtZQUNoQix1QkFBdUI7WUFDUixnQkFBZ0I7WUFDekMsaUJBQWlCO1lBQ2QsaUJBQWlCO1lBQ0EsMEJBQTBCO09BYjFDLDBCQUEwQixDQXVGdEM7SUFBRCxpQ0FBQztDQUFBLEFBdkZELENBQWdELGtCQUFrQixHQXVGakU7U0F2RlksMEJBQTBCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWZ0ZXJWaWV3SW5pdCwgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgSW5wdXQsIE9wdGlvbmFsLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEx1eExvb2t1cFRhYmxlRW50cnkgfSBmcm9tICcuLi9sdXgtbG9va3VwLW1vZGVsL2x1eC1sb29rdXAtdGFibGUtZW50cnknO1xuaW1wb3J0IHsgTHV4TG9va3VwU2VydmljZSB9IGZyb20gJy4uL2x1eC1sb29rdXAtc2VydmljZS9sdXgtbG9va3VwLnNlcnZpY2UnO1xuaW1wb3J0IHsgQ29udHJvbENvbnRhaW5lciB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IEx1eExvb2t1cENvbXBvbmVudCB9IGZyb20gJy4uL2x1eC1sb29rdXAtbW9kZWwvbHV4LWxvb2t1cC1jb21wb25lbnQnO1xuaW1wb3J0IHsgTWF0U2VsZWN0LCBNYXRTZWxlY3RDaGFuZ2UgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbCc7XG5pbXBvcnQgeyBMdXhMb29rdXBIYW5kbGVyU2VydmljZSB9IGZyb20gJy4uL2x1eC1sb29rdXAtc2VydmljZS9sdXgtbG9va3VwLWhhbmRsZXIuc2VydmljZSc7XG5pbXBvcnQgeyBMdXhMb29rdXBFcnJvclN0YXRlTWF0Y2hlciB9IGZyb20gJy4uL2x1eC1sb29rdXAtbW9kZWwvbHV4LWxvb2t1cC1lcnJvci1zdGF0ZS1tYXRjaGVyJztcbmltcG9ydCB7IEx1eENvbnNvbGVTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vbHV4LXV0aWwvbHV4LWNvbnNvbGUuc2VydmljZSc7XG5pbXBvcnQgeyBMdXhDb21wb25lbnRzQ29uZmlnU2VydmljZSB9IGZyb20gJy4uLy4uL2x1eC1jb21wb25lbnRzLWNvbmZpZy9sdXgtY29tcG9uZW50cy1jb25maWcuc2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2x1eC1sb29rdXAtY29tYm9ib3gnLFxuICB0ZW1wbGF0ZVVybDogJy4vbHV4LWxvb2t1cC1jb21ib2JveC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2x1eC1sb29rdXAtY29tYm9ib3guY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBMdXhMb29rdXBDb21ib2JveENvbXBvbmVudCBleHRlbmRzIEx1eExvb2t1cENvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQge1xuICBASW5wdXQoKSBsdXhNdWx0aXBsZTogYm9vbGVhbiA9IGZhbHNlO1xuICBASW5wdXQoKSBsdXhFbnRyeUJsb2NrU2l6ZTogbnVtYmVyID0gMjU7XG5cbiAgZGlzcGxheWVkRW50cmllczogTHV4TG9va3VwVGFibGVFbnRyeVtdO1xuICBAVmlld0NoaWxkKE1hdFNlbGVjdCwgeyBzdGF0aWM6IGZhbHNlIH0pIG1hdFNlbGVjdDogTWF0U2VsZWN0O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIGxvb2t1cFNlcnZpY2U6IEx1eExvb2t1cFNlcnZpY2UsXG4gICAgbG9va3VwSGFuZGxlcjogTHV4TG9va3VwSGFuZGxlclNlcnZpY2UsXG4gICAgQE9wdGlvbmFsKCkgY29udHJvbENvbnRhaW5lcjogQ29udHJvbENvbnRhaW5lcixcbiAgICBjZHI6IENoYW5nZURldGVjdG9yUmVmLFxuICAgIGxvZ2dlcjogTHV4Q29uc29sZVNlcnZpY2UsXG4gICAgY29tcG9uZW50c0NvbmZpZ1NlcnZpY2U6IEx1eENvbXBvbmVudHNDb25maWdTZXJ2aWNlXG4gICkge1xuICAgIHN1cGVyKGxvb2t1cFNlcnZpY2UsIGxvb2t1cEhhbmRsZXIsIGNvbnRyb2xDb250YWluZXIsIGNkciwgbG9nZ2VyLCBjb21wb25lbnRzQ29uZmlnU2VydmljZSk7XG5cbiAgICB0aGlzLnN0YXRlTWF0Y2hlciA9IG5ldyBMdXhMb29rdXBFcnJvclN0YXRlTWF0Y2hlcih0aGlzKTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLm1hdFNlbGVjdC5vcGVuZWRDaGFuZ2Uuc3Vic2NyaWJlKChvcGVuOiBib29sZWFuKSA9PiB7XG4gICAgICBpZiAob3Blbikge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyUGFuZWxTY3JvbGxFdmVudCh0aGlzLm1hdFNlbGVjdC5wYW5lbC5uYXRpdmVFbGVtZW50KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJnbGVpY2h0IGRpZSBPcHRpb25lbiBhbmhhbmQgZGVyIEtleS1XZXJ0ZVxuICAgKiBAcGFyYW0gdmFsdWUxXG4gICAqIEBwYXJhbSB2YWx1ZTJcbiAgICogQHJldHVybnMgYm9vbGVhblxuICAgKi9cbiAgY29tcGFyZUJ5S2V5KHZhbHVlMSwgdmFsdWUyKSB7XG4gICAgY29uc3Qga2V5MSA9IHZhbHVlMSA/IHZhbHVlMS5rZXkgOiAtMTtcbiAgICBjb25zdCBrZXkyID0gdmFsdWUyID8gdmFsdWUyLmtleSA6IC0yO1xuXG4gICAgcmV0dXJuIGtleTEgPT09IGtleTI7XG4gIH1cblxuICBzZXRMb29rdXBEYXRhKGVudHJpZXM6IEx1eExvb2t1cFRhYmxlRW50cnlbXSkge1xuICAgIHN1cGVyLnNldExvb2t1cERhdGEoZW50cmllcyk7XG4gICAgaWYgKHRoaXMuZW50cmllcy5sZW5ndGggPiB0aGlzLmx1eEVudHJ5QmxvY2tTaXplKSB7XG4gICAgICB0aGlzLmRpc3BsYXllZEVudHJpZXMgPSB0aGlzLmVudHJpZXMuc3BsaWNlKDAsIHRoaXMubHV4RW50cnlCbG9ja1NpemUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRpc3BsYXllZEVudHJpZXMgPSBbLi4udGhpcy5lbnRyaWVzXTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0enQgZGVuIGFrdHVlbGxlbiBWYWx1ZS1XZXJ0IGF1ZiBkZW4gYXVzZ2V3w6RobHRlbiBXZXJ0LlxuICAgKiBAcGFyYW0gJGV2ZW50XG4gICAqL1xuICBzZWxlY3RlZCgkZXZlbnQ6IE1hdFNlbGVjdENoYW5nZSkge1xuICAgIHRoaXMubHV4VmFsdWUgPSAkZXZlbnQudmFsdWU7XG4gIH1cblxuICAvKipcbiAgICogRnVlZ3QgYmVpbSBPZWZmbmVuIGRlcyBTZWxlY3RzIGVpbmVuIFNjcm9sbGxpc3RlbmVyIGhpbnp1LlxuICAgKi9cbiAgcHJpdmF0ZSByZWdpc3RlclBhbmVsU2Nyb2xsRXZlbnQocGFuZWxFbGVtZW50KSB7XG4gICAgcGFuZWxFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGV2ZW50ID0+IHRoaXMubG9hZE9uU2Nyb2xsKGV2ZW50KSk7XG4gIH1cblxuICAvKipcbiAgICogU3RvZXNzdCBkYXMgTmFjaGxhZGVuIHZvbiBFbGVtZW50ZW4gYW4sIHdlbm4gZWluIGJlc3RpbW10ZXIgU2Nyb2xsd2VydCBlcnJlaWNodCB3dXJkZS5cbiAgICogQHBhcmFtIGV2ZW50IC0gU2Nyb2xsRXZlbnRcbiAgICovXG4gIHByaXZhdGUgbG9hZE9uU2Nyb2xsKGV2ZW50KSB7XG4gICAgY29uc3QgcG9zaXRpb24gPSBldmVudC50YXJnZXQ7XG4gICAgaWYgKChwb3NpdGlvbi5zY3JvbGxUb3AgKyBwb3NpdGlvbi5jbGllbnRIZWlnaHQpIC8gcG9zaXRpb24uc2Nyb2xsSGVpZ2h0ID4gODUgLyAxMDApIHtcbiAgICAgIHRoaXMucmVsb2FkTmV4dERhdGFCbG9jaygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBMYWVkIGRlbiBuYWVjaHN0ZW4gQmxvY2sgRGF0ZW4gYXVzIGRlbiBFbnRyaWVzIG5hY2guXG4gICAqL1xuICBwcml2YXRlIHJlbG9hZE5leHREYXRhQmxvY2soKSB7XG4gICAgY29uc3Qgc3RhcnQgPSB0aGlzLmRpc3BsYXllZEVudHJpZXMubGVuZ3RoIC0gMTtcbiAgICBjb25zdCBlbmQgPVxuICAgICAgc3RhcnQgKyB0aGlzLmx1eEVudHJ5QmxvY2tTaXplID4gdGhpcy5lbnRyaWVzLmxlbmd0aFxuICAgICAgICA/IHRoaXMuZW50cmllcy5sZW5ndGggLSBzdGFydFxuICAgICAgICA6IHN0YXJ0ICsgdGhpcy5sdXhFbnRyeUJsb2NrU2l6ZTtcbiAgICB0aGlzLmRpc3BsYXllZEVudHJpZXMucHVzaCguLi50aGlzLmVudHJpZXMuc3BsaWNlKHN0YXJ0LCBlbmQpKTtcbiAgfVxufVxuIl19