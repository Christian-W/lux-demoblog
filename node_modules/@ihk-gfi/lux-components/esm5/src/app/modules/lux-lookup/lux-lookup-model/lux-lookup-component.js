// tslint:disable:max-line-length
import * as tslib_1 from "tslib";
import { EventEmitter, Input, Output } from '@angular/core';
import { LuxBehandlungsOptionenUngueltige, LuxLookupParameters } from './lux-lookup-parameters';
import { LuxFormComponentBase } from '../../lux-form/lux-form-model/lux-form-component-base.class';
var LuxLookupComponent = /** @class */ (function (_super) {
    tslib_1.__extends(LuxLookupComponent, _super);
    function LuxLookupComponent(lookupService, lookupHandler, controlContainer, cdr, logger, componentsConfigService) {
        var _this = _super.call(this, controlContainer, cdr, logger, componentsConfigService) || this;
        _this.LuxBehandlungsOptionenUngueltige = LuxBehandlungsOptionenUngueltige;
        _this.luxBehandlungUngueltige = LuxBehandlungsOptionenUngueltige.ausgrauen;
        _this.luxDataLoaded = new EventEmitter();
        _this.luxValueChange = new EventEmitter();
        _this.entries = [];
        _this.lookupService = lookupService;
        _this.lookupHandler = lookupHandler;
        _this.componentsConfigService = componentsConfigService;
        return _this;
    }
    Object.defineProperty(LuxLookupComponent.prototype, "luxValue", {
        get: function () {
            return this.getValue();
        },
        set: function (value) {
            this.setValue(value);
        },
        enumerable: true,
        configurable: true
    });
    LuxLookupComponent.prototype.ngOnInit = function () {
        var _this = this;
        _super.prototype.ngOnInit.call(this);
        if (!this.luxLookupId) {
            console.error("Die Lookup-Komponente mit der Tabellen-Nr. " + this.luxTableNo + " besitzt keine LookupId. Bitte tragen Sie diese nach.");
        }
        this.lookupHandler.addLookupElement(this.luxLookupId);
        this.lookupHandler.getLookupElementObsv(this.luxLookupId).subscribe(function () {
            _this.fetchLookupData();
        });
        this.configSubscription = this.componentsConfigService.config.subscribe(function (newConfig) {
            _this.apiPath = newConfig.lookupServiceUrl;
            _this.lookupHandler.reloadData(_this.luxLookupId);
        });
    };
    LuxLookupComponent.prototype.ngOnDestroy = function () {
        _super.prototype.ngOnDestroy.call(this);
        this.configSubscription.unsubscribe();
    };
    /**
     * Gibt zurueck, ob die RenderProperty eine Funktion ist oder nicht.
     *
     * @returns boolean
     */
    LuxLookupComponent.prototype.isRenderPropAFunction = function () {
        return typeof this.luxRenderProp === 'function';
    };
    /**
     * Gibt zurück ob sich das entsprechende Element in der Liste ungültiger Elemente befindet.
     * @param LuxLookupTableEntry entry
     * @returns boolean
     */
    LuxLookupComponent.prototype.isUngueltig = function (entry) {
        var isUngueltig = false;
        if (entry) {
            if (!Array.isArray(entry)) {
                if (entry.gueltigkeitBis) {
                    isUngueltig = Date.now() > +entry.gueltigkeitBis;
                }
            }
            else {
                entry.forEach(function (element) {
                    if (element.gueltigkeitBis && !isUngueltig) {
                        isUngueltig = Date.now() > +element.gueltigkeitBis;
                    }
                });
            }
        }
        return isUngueltig;
    };
    /**
     * Gibt zurück ob ungültige Einträge angezeigt werden sollen.
     * @returns boolean
     */
    LuxLookupComponent.prototype.showUngueltige = function () {
        return (this.luxBehandlungUngueltige === this.LuxBehandlungsOptionenUngueltige.ausgrauen ||
            this.luxBehandlungUngueltige === this.LuxBehandlungsOptionenUngueltige.anzeigen);
    };
    /**
     * Gibt zurück ob ungültige Einträge deaktiviert werden sollen.
     * @returns boolean
     */
    LuxLookupComponent.prototype.disableUngueltige = function () {
        return this.luxBehandlungUngueltige === this.LuxBehandlungsOptionenUngueltige.ausgrauen;
    };
    /**
     * Gibt die mitgegebenen Styles abhaengig ob das Element invalid ist zurueck.
     * @param boolean invalid
     * @returns LuxLookupOptionStyle
     */
    LuxLookupComponent.prototype.getStyles = function (invalid) {
        if (invalid) {
            return this.luxCustomInvalidStyles ? this.luxCustomInvalidStyles : {};
        }
        return this.luxCustomStyles ? this.luxCustomStyles : {};
    };
    /**
     * @override errorMessageModifier - Modifikation der Fehlermeldung
     * @param value
     * @param errors
     */
    LuxLookupComponent.prototype.errorMessageModifier = function (value, errors) {
        if (errors['ungueltig']) {
            return 'Der ausgewählte Wert ist ungültig.';
        }
        return undefined;
    };
    LuxLookupComponent.prototype.getLabel = function (entry) {
        if (this.isRenderPropAFunction()) {
            return this.luxRenderProp(entry);
        }
        if (entry[this.luxRenderProp]) {
            return entry[this.luxRenderProp];
        }
        return 'Fehler beim Auslesen (Property unbekannt)';
    };
    /**
     * Holt die Lookup-Table Daten vom Backend
     */
    LuxLookupComponent.prototype.fetchLookupData = function () {
        var _this = this;
        var backendRequest = this.lookupService.getLookupTable(this.luxTableNo, this.luxParameters, this.apiPath);
        backendRequest.subscribe(function (entries) {
            _this.setLookupData(entries);
            _this.luxDataLoaded.emit(true);
        }, function () {
            _this.luxDataLoaded.emit(false);
        });
    };
    /**
     * Setzt die aktuellen Werte auf die mitgegebenen Entries.
     * @param entries
     */
    LuxLookupComponent.prototype.setLookupData = function (entries) {
        var _this = this;
        this.entries = entries;
        if (this.entries) {
            // Merken welche Eintraege ungueltig sind, um bei vielen Informationen
            // nicht die ganzen Funktionsaufrufe zu haben
            this.entries.forEach(function (entry) {
                entry.isUngueltig = _this.isUngueltig(entry);
            });
        }
    };
    // region Overridden methods
    LuxLookupComponent.prototype.notifyFormValueChanged = function (formValue) {
        this.luxValueChange.emit(formValue);
    };
    LuxLookupComponent.prototype.triggerOutputPatternCheck = function () {
        this.checkOutputPatternViolation(this.luxValueChange.observers);
    };
    LuxLookupComponent.prototype.triggerInputPatternCheck = function (simpleChanges) {
        this.checkInputPatternViolation(simpleChanges.luxValue);
    };
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", String)
    ], LuxLookupComponent.prototype, "luxPlaceholder", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Boolean)
    ], LuxLookupComponent.prototype, "luxReadonly", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", String)
    ], LuxLookupComponent.prototype, "luxLookupId", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", String)
    ], LuxLookupComponent.prototype, "luxTableNo", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], LuxLookupComponent.prototype, "luxRenderProp", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", String)
    ], LuxLookupComponent.prototype, "luxBehandlungUngueltige", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", LuxLookupParameters)
    ], LuxLookupComponent.prototype, "luxParameters", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], LuxLookupComponent.prototype, "luxCustomStyles", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], LuxLookupComponent.prototype, "luxCustomInvalidStyles", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", String)
    ], LuxLookupComponent.prototype, "luxTagId", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", EventEmitter)
    ], LuxLookupComponent.prototype, "luxDataLoaded", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", EventEmitter)
    ], LuxLookupComponent.prototype, "luxValueChange", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object),
        tslib_1.__metadata("design:paramtypes", [Object])
    ], LuxLookupComponent.prototype, "luxValue", null);
    return LuxLookupComponent;
}(LuxFormComponentBase));
export { LuxLookupComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibHV4LWxvb2t1cC1jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AaWhrLWdmaS9sdXgtY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbInNyYy9hcHAvbW9kdWxlcy9sdXgtbG9va3VwL2x1eC1sb29rdXAtbW9kZWwvbHV4LWxvb2t1cC1jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsaUNBQWlDOztBQUVqQyxPQUFPLEVBRUwsWUFBWSxFQUNaLEtBQUssRUFJTCxNQUFNLEVBRVAsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGdDQUFnQyxFQUFFLG1CQUFtQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFJaEcsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sNkRBQTZELENBQUM7QUFRbkc7SUFBaUQsOENBQW9CO0lBNEJuRSw0QkFDRSxhQUErQixFQUMvQixhQUFzQyxFQUN0QyxnQkFBa0MsRUFDbEMsR0FBc0IsRUFDdEIsTUFBeUIsRUFDekIsdUJBQW1EO1FBTnJELFlBUUUsa0JBQU0sZ0JBQWdCLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSx1QkFBdUIsQ0FBQyxTQUs5RDtRQXhDRCxzQ0FBZ0MsR0FBRyxnQ0FBZ0MsQ0FBQztRQWMzRCw2QkFBdUIsR0FBcUMsZ0NBQWdDLENBQUMsU0FBUyxDQUFDO1FBS3RHLG1CQUFhLEdBQTBCLElBQUksWUFBWSxFQUFXLENBQUM7UUFDbkUsb0JBQWMsR0FBOEQsSUFBSSxZQUFZLEVBRW5HLENBQUM7UUFDSixhQUFPLEdBQTBCLEVBQUUsQ0FBQztRQWNsQyxLQUFJLENBQUMsYUFBYSxHQUFHLGFBQWEsQ0FBQztRQUNuQyxLQUFJLENBQUMsYUFBYSxHQUFHLGFBQWEsQ0FBQztRQUNuQyxLQUFJLENBQUMsdUJBQXVCLEdBQUcsdUJBQXVCLENBQUM7O0lBQ3pELENBQUM7SUFFRCxzQkFBSSx3Q0FBUTthQUFaO1lBQ0UsT0FBTyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDekIs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QUM7Q0FBQSxBQW5ORCxDQUFpRCxvQkFBb0IsR0FtTnBFO1NBbk5xQixrQkFBa0IiLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0c2xpbnQ6ZGlzYWJsZTptYXgtbGluZS1sZW5ndGhcblxuaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSW5wdXQsXG4gIE9uQ2hhbmdlcyxcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgU2ltcGxlQ2hhbmdlc1xufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEx1eEJlaGFuZGx1bmdzT3B0aW9uZW5Vbmd1ZWx0aWdlLCBMdXhMb29rdXBQYXJhbWV0ZXJzIH0gZnJvbSAnLi9sdXgtbG9va3VwLXBhcmFtZXRlcnMnO1xuaW1wb3J0IHsgTHV4TG9va3VwVGFibGVFbnRyeSB9IGZyb20gJy4vbHV4LWxvb2t1cC10YWJsZS1lbnRyeSc7XG5pbXBvcnQgeyBMdXhMb29rdXBTZXJ2aWNlIH0gZnJvbSAnLi4vbHV4LWxvb2t1cC1zZXJ2aWNlL2x1eC1sb29rdXAuc2VydmljZSc7XG5pbXBvcnQgeyBDb250cm9sQ29udGFpbmVyIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgTHV4Rm9ybUNvbXBvbmVudEJhc2UgfSBmcm9tICcuLi8uLi9sdXgtZm9ybS9sdXgtZm9ybS1tb2RlbC9sdXgtZm9ybS1jb21wb25lbnQtYmFzZS5jbGFzcyc7XG5pbXBvcnQgeyBMdXhMb29rdXBIYW5kbGVyU2VydmljZSB9IGZyb20gJy4uL2x1eC1sb29rdXAtc2VydmljZS9sdXgtbG9va3VwLWhhbmRsZXIuc2VydmljZSc7XG5pbXBvcnQgeyBMdXhMb29rdXBFcnJvclN0YXRlTWF0Y2hlciB9IGZyb20gJy4vbHV4LWxvb2t1cC1lcnJvci1zdGF0ZS1tYXRjaGVyJztcbmltcG9ydCB7IEx1eENvbnNvbGVTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vbHV4LXV0aWwvbHV4LWNvbnNvbGUuc2VydmljZSc7XG5pbXBvcnQgeyBMdXhDb21wb25lbnRzQ29uZmlnU2VydmljZSB9IGZyb20gJy4uLy4uL2x1eC1jb21wb25lbnRzLWNvbmZpZy9sdXgtY29tcG9uZW50cy1jb25maWcuc2VydmljZSc7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IEx1eENvbXBvbmVudHNDb25maWdQYXJhbWV0ZXJzIH0gZnJvbSAnLi4vLi4vbHV4LWNvbXBvbmVudHMtY29uZmlnL2x1eC1jb21wb25lbnRzLWNvbmZpZy1wYXJhbWV0ZXJzLmludGVyZmFjZSc7XG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBMdXhMb29rdXBDb21wb25lbnQgZXh0ZW5kcyBMdXhGb3JtQ29tcG9uZW50QmFzZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3kge1xuICBMdXhCZWhhbmRsdW5nc09wdGlvbmVuVW5ndWVsdGlnZSA9IEx1eEJlaGFuZGx1bmdzT3B0aW9uZW5Vbmd1ZWx0aWdlO1xuXG4gIGxvb2t1cFNlcnZpY2U6IEx1eExvb2t1cFNlcnZpY2U7XG4gIGxvb2t1cEhhbmRsZXI6IEx1eExvb2t1cEhhbmRsZXJTZXJ2aWNlO1xuICBjb21wb25lbnRzQ29uZmlnU2VydmljZTogTHV4Q29tcG9uZW50c0NvbmZpZ1NlcnZpY2U7XG5cbiAgc3RhdGVNYXRjaGVyOiBMdXhMb29rdXBFcnJvclN0YXRlTWF0Y2hlcjtcbiAgYXBpUGF0aDogc3RyaW5nO1xuXG4gIEBJbnB1dCgpIGx1eFBsYWNlaG9sZGVyOiBzdHJpbmc7XG4gIEBJbnB1dCgpIGx1eFJlYWRvbmx5OiBib29sZWFuO1xuICBASW5wdXQoKSBsdXhMb29rdXBJZDogc3RyaW5nO1xuICBASW5wdXQoKSBsdXhUYWJsZU5vOiBzdHJpbmc7XG4gIEBJbnB1dCgpIGx1eFJlbmRlclByb3A6IGFueTtcbiAgQElucHV0KCkgbHV4QmVoYW5kbHVuZ1VuZ3VlbHRpZ2U6IEx1eEJlaGFuZGx1bmdzT3B0aW9uZW5Vbmd1ZWx0aWdlID0gTHV4QmVoYW5kbHVuZ3NPcHRpb25lblVuZ3VlbHRpZ2UuYXVzZ3JhdWVuO1xuICBASW5wdXQoKSBsdXhQYXJhbWV0ZXJzOiBMdXhMb29rdXBQYXJhbWV0ZXJzO1xuICBASW5wdXQoKSBsdXhDdXN0b21TdHlsZXM7XG4gIEBJbnB1dCgpIGx1eEN1c3RvbUludmFsaWRTdHlsZXM7XG4gIEBJbnB1dCgpIGx1eFRhZ0lkOiBzdHJpbmc7XG4gIEBPdXRwdXQoKSBsdXhEYXRhTG9hZGVkOiBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4gPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XG4gIEBPdXRwdXQoKSBsdXhWYWx1ZUNoYW5nZTogRXZlbnRFbWl0dGVyPEx1eExvb2t1cFRhYmxlRW50cnkgfCBMdXhMb29rdXBUYWJsZUVudHJ5W10+ID0gbmV3IEV2ZW50RW1pdHRlcjxcbiAgICBMdXhMb29rdXBUYWJsZUVudHJ5XG4gID4oKTtcbiAgZW50cmllczogTHV4TG9va3VwVGFibGVFbnRyeVtdID0gW107XG5cbiAgcHJpdmF0ZSBjb25maWdTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcblxuICBwcm90ZWN0ZWQgY29uc3RydWN0b3IoXG4gICAgbG9va3VwU2VydmljZTogTHV4TG9va3VwU2VydmljZSxcbiAgICBsb29rdXBIYW5kbGVyOiBMdXhMb29rdXBIYW5kbGVyU2VydmljZSxcbiAgICBjb250cm9sQ29udGFpbmVyOiBDb250cm9sQ29udGFpbmVyLFxuICAgIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgbG9nZ2VyOiBMdXhDb25zb2xlU2VydmljZSxcbiAgICBjb21wb25lbnRzQ29uZmlnU2VydmljZTogTHV4Q29tcG9uZW50c0NvbmZpZ1NlcnZpY2VcbiAgKSB7XG4gICAgc3VwZXIoY29udHJvbENvbnRhaW5lciwgY2RyLCBsb2dnZXIsIGNvbXBvbmVudHNDb25maWdTZXJ2aWNlKTtcblxuICAgIHRoaXMubG9va3VwU2VydmljZSA9IGxvb2t1cFNlcnZpY2U7XG4gICAgdGhpcy5sb29rdXBIYW5kbGVyID0gbG9va3VwSGFuZGxlcjtcbiAgICB0aGlzLmNvbXBvbmVudHNDb25maWdTZXJ2aWNlID0gY29tcG9uZW50c0NvbmZpZ1NlcnZpY2U7XG4gIH1cblxuICBnZXQgbHV4VmFsdWUoKTogYW55IHtcbiAgICByZXR1cm4gdGhpcy5nZXRWYWx1ZSgpO1xuICB9XG5cbiAgQElucHV0KCkgc2V0IGx1eFZhbHVlKHZhbHVlOiBhbnkpIHtcbiAgICB0aGlzLnNldFZhbHVlKHZhbHVlKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHN1cGVyLm5nT25Jbml0KCk7XG5cbiAgICBpZiAoIXRoaXMubHV4TG9va3VwSWQpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgIGBEaWUgTG9va3VwLUtvbXBvbmVudGUgbWl0IGRlciBUYWJlbGxlbi1Oci4gJHt0aGlzLmx1eFRhYmxlTm99IGJlc2l0enQga2VpbmUgTG9va3VwSWQuIEJpdHRlIHRyYWdlbiBTaWUgZGllc2UgbmFjaC5gXG4gICAgICApO1xuICAgIH1cblxuICAgIHRoaXMubG9va3VwSGFuZGxlci5hZGRMb29rdXBFbGVtZW50KHRoaXMubHV4TG9va3VwSWQpO1xuICAgIHRoaXMubG9va3VwSGFuZGxlci5nZXRMb29rdXBFbGVtZW50T2Jzdih0aGlzLmx1eExvb2t1cElkKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgdGhpcy5mZXRjaExvb2t1cERhdGEoKTtcbiAgICB9KTtcblxuICAgIHRoaXMuY29uZmlnU3Vic2NyaXB0aW9uID0gdGhpcy5jb21wb25lbnRzQ29uZmlnU2VydmljZS5jb25maWcuc3Vic2NyaWJlKFxuICAgICAgKG5ld0NvbmZpZzogTHV4Q29tcG9uZW50c0NvbmZpZ1BhcmFtZXRlcnMpID0+IHtcbiAgICAgICAgdGhpcy5hcGlQYXRoID0gbmV3Q29uZmlnLmxvb2t1cFNlcnZpY2VVcmw7XG5cbiAgICAgICAgdGhpcy5sb29rdXBIYW5kbGVyLnJlbG9hZERhdGEodGhpcy5sdXhMb29rdXBJZCk7XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHN1cGVyLm5nT25EZXN0cm95KCk7XG5cbiAgICB0aGlzLmNvbmZpZ1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdpYnQgenVydWVjaywgb2IgZGllIFJlbmRlclByb3BlcnR5IGVpbmUgRnVua3Rpb24gaXN0IG9kZXIgbmljaHQuXG4gICAqXG4gICAqIEByZXR1cm5zIGJvb2xlYW5cbiAgICovXG4gIGlzUmVuZGVyUHJvcEFGdW5jdGlvbigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdHlwZW9mIHRoaXMubHV4UmVuZGVyUHJvcCA9PT0gJ2Z1bmN0aW9uJztcbiAgfVxuXG4gIC8qKlxuICAgKiBHaWJ0IHp1csO8Y2sgb2Igc2ljaCBkYXMgZW50c3ByZWNoZW5kZSBFbGVtZW50IGluIGRlciBMaXN0ZSB1bmfDvGx0aWdlciBFbGVtZW50ZSBiZWZpbmRldC5cbiAgICogQHBhcmFtIEx1eExvb2t1cFRhYmxlRW50cnkgZW50cnlcbiAgICogQHJldHVybnMgYm9vbGVhblxuICAgKi9cbiAgaXNVbmd1ZWx0aWcoZW50cnk6IEx1eExvb2t1cFRhYmxlRW50cnkgfCBMdXhMb29rdXBUYWJsZUVudHJ5W10pIHtcbiAgICBsZXQgaXNVbmd1ZWx0aWcgPSBmYWxzZTtcbiAgICBpZiAoZW50cnkpIHtcbiAgICAgIGlmICghQXJyYXkuaXNBcnJheShlbnRyeSkpIHtcbiAgICAgICAgaWYgKGVudHJ5Lmd1ZWx0aWdrZWl0QmlzKSB7XG4gICAgICAgICAgaXNVbmd1ZWx0aWcgPSBEYXRlLm5vdygpID4gK2VudHJ5Lmd1ZWx0aWdrZWl0QmlzO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBlbnRyeS5mb3JFYWNoKGVsZW1lbnQgPT4ge1xuICAgICAgICAgIGlmIChlbGVtZW50Lmd1ZWx0aWdrZWl0QmlzICYmICFpc1VuZ3VlbHRpZykge1xuICAgICAgICAgICAgaXNVbmd1ZWx0aWcgPSBEYXRlLm5vdygpID4gK2VsZW1lbnQuZ3VlbHRpZ2tlaXRCaXM7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gaXNVbmd1ZWx0aWc7XG4gIH1cblxuICAvKipcbiAgICogR2lidCB6dXLDvGNrIG9iIHVuZ8O8bHRpZ2UgRWludHLDpGdlIGFuZ2V6ZWlndCB3ZXJkZW4gc29sbGVuLlxuICAgKiBAcmV0dXJucyBib29sZWFuXG4gICAqL1xuICBzaG93VW5ndWVsdGlnZSgpIHtcbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy5sdXhCZWhhbmRsdW5nVW5ndWVsdGlnZSA9PT0gdGhpcy5MdXhCZWhhbmRsdW5nc09wdGlvbmVuVW5ndWVsdGlnZS5hdXNncmF1ZW4gfHxcbiAgICAgIHRoaXMubHV4QmVoYW5kbHVuZ1VuZ3VlbHRpZ2UgPT09IHRoaXMuTHV4QmVoYW5kbHVuZ3NPcHRpb25lblVuZ3VlbHRpZ2UuYW56ZWlnZW5cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdpYnQgenVyw7xjayBvYiB1bmfDvGx0aWdlIEVpbnRyw6RnZSBkZWFrdGl2aWVydCB3ZXJkZW4gc29sbGVuLlxuICAgKiBAcmV0dXJucyBib29sZWFuXG4gICAqL1xuICBkaXNhYmxlVW5ndWVsdGlnZSgpIHtcbiAgICByZXR1cm4gdGhpcy5sdXhCZWhhbmRsdW5nVW5ndWVsdGlnZSA9PT0gdGhpcy5MdXhCZWhhbmRsdW5nc09wdGlvbmVuVW5ndWVsdGlnZS5hdXNncmF1ZW47XG4gIH1cblxuICAvKipcbiAgICogR2lidCBkaWUgbWl0Z2VnZWJlbmVuIFN0eWxlcyBhYmhhZW5naWcgb2IgZGFzIEVsZW1lbnQgaW52YWxpZCBpc3QgenVydWVjay5cbiAgICogQHBhcmFtIGJvb2xlYW4gaW52YWxpZFxuICAgKiBAcmV0dXJucyBMdXhMb29rdXBPcHRpb25TdHlsZVxuICAgKi9cbiAgZ2V0U3R5bGVzKGludmFsaWQ6IGJvb2xlYW4pIHtcbiAgICBpZiAoaW52YWxpZCkge1xuICAgICAgcmV0dXJuIHRoaXMubHV4Q3VzdG9tSW52YWxpZFN0eWxlcyA/IHRoaXMubHV4Q3VzdG9tSW52YWxpZFN0eWxlcyA6IHt9O1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5sdXhDdXN0b21TdHlsZXMgPyB0aGlzLmx1eEN1c3RvbVN0eWxlcyA6IHt9O1xuICB9XG5cbiAgLyoqXG4gICAqIEBvdmVycmlkZSBlcnJvck1lc3NhZ2VNb2RpZmllciAtIE1vZGlmaWthdGlvbiBkZXIgRmVobGVybWVsZHVuZ1xuICAgKiBAcGFyYW0gdmFsdWVcbiAgICogQHBhcmFtIGVycm9yc1xuICAgKi9cbiAgZXJyb3JNZXNzYWdlTW9kaWZpZXIodmFsdWUsIGVycm9ycykge1xuICAgIGlmIChlcnJvcnNbJ3VuZ3VlbHRpZyddKSB7XG4gICAgICByZXR1cm4gJ0RlciBhdXNnZXfDpGhsdGUgV2VydCBpc3QgdW5nw7xsdGlnLic7XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBnZXRMYWJlbChlbnRyeTogYW55KTogc3RyaW5nIHtcbiAgICBpZiAodGhpcy5pc1JlbmRlclByb3BBRnVuY3Rpb24oKSkge1xuICAgICAgcmV0dXJuIHRoaXMubHV4UmVuZGVyUHJvcChlbnRyeSk7XG4gICAgfVxuICAgIGlmIChlbnRyeVt0aGlzLmx1eFJlbmRlclByb3AgYXMgc3RyaW5nXSkge1xuICAgICAgcmV0dXJuIGVudHJ5WzxzdHJpbmc+dGhpcy5sdXhSZW5kZXJQcm9wXTtcbiAgICB9XG4gICAgcmV0dXJuICdGZWhsZXIgYmVpbSBBdXNsZXNlbiAoUHJvcGVydHkgdW5iZWthbm50KSc7XG4gIH1cblxuICAvKipcbiAgICogSG9sdCBkaWUgTG9va3VwLVRhYmxlIERhdGVuIHZvbSBCYWNrZW5kXG4gICAqL1xuICBwcm90ZWN0ZWQgZmV0Y2hMb29rdXBEYXRhKCkge1xuICAgIGNvbnN0IGJhY2tlbmRSZXF1ZXN0ID0gdGhpcy5sb29rdXBTZXJ2aWNlLmdldExvb2t1cFRhYmxlKHRoaXMubHV4VGFibGVObywgdGhpcy5sdXhQYXJhbWV0ZXJzLCB0aGlzLmFwaVBhdGgpO1xuICAgIGJhY2tlbmRSZXF1ZXN0LnN1YnNjcmliZShcbiAgICAgIChlbnRyaWVzOiBMdXhMb29rdXBUYWJsZUVudHJ5W10pID0+IHtcbiAgICAgICAgdGhpcy5zZXRMb29rdXBEYXRhKGVudHJpZXMpO1xuICAgICAgICB0aGlzLmx1eERhdGFMb2FkZWQuZW1pdCh0cnVlKTtcbiAgICAgIH0sXG4gICAgICAoKSA9PiB7XG4gICAgICAgIHRoaXMubHV4RGF0YUxvYWRlZC5lbWl0KGZhbHNlKTtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHp0IGRpZSBha3R1ZWxsZW4gV2VydGUgYXVmIGRpZSBtaXRnZWdlYmVuZW4gRW50cmllcy5cbiAgICogQHBhcmFtIGVudHJpZXNcbiAgICovXG4gIHByb3RlY3RlZCBzZXRMb29rdXBEYXRhKGVudHJpZXM6IEx1eExvb2t1cFRhYmxlRW50cnlbXSkge1xuICAgIHRoaXMuZW50cmllcyA9IGVudHJpZXM7XG4gICAgaWYgKHRoaXMuZW50cmllcykge1xuICAgICAgLy8gTWVya2VuIHdlbGNoZSBFaW50cmFlZ2UgdW5ndWVsdGlnIHNpbmQsIHVtIGJlaSB2aWVsZW4gSW5mb3JtYXRpb25lblxuICAgICAgLy8gbmljaHQgZGllIGdhbnplbiBGdW5rdGlvbnNhdWZydWZlIHp1IGhhYmVuXG4gICAgICB0aGlzLmVudHJpZXMuZm9yRWFjaCgoZW50cnk6IEx1eExvb2t1cFRhYmxlRW50cnkpID0+IHtcbiAgICAgICAgZW50cnkuaXNVbmd1ZWx0aWcgPSB0aGlzLmlzVW5ndWVsdGlnKGVudHJ5KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8vIHJlZ2lvbiBPdmVycmlkZGVuIG1ldGhvZHNcbiAgbm90aWZ5Rm9ybVZhbHVlQ2hhbmdlZChmb3JtVmFsdWU6IGFueSkge1xuICAgIHRoaXMubHV4VmFsdWVDaGFuZ2UuZW1pdChmb3JtVmFsdWUpO1xuICB9XG5cbiAgcHJvdGVjdGVkIHRyaWdnZXJPdXRwdXRQYXR0ZXJuQ2hlY2soKSB7XG4gICAgdGhpcy5jaGVja091dHB1dFBhdHRlcm5WaW9sYXRpb24odGhpcy5sdXhWYWx1ZUNoYW5nZS5vYnNlcnZlcnMpO1xuICB9XG5cbiAgcHJvdGVjdGVkIHRyaWdnZXJJbnB1dFBhdHRlcm5DaGVjayhzaW1wbGVDaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgdGhpcy5jaGVja0lucHV0UGF0dGVyblZpb2xhdGlvbihzaW1wbGVDaGFuZ2VzLmx1eFZhbHVlKTtcbiAgfVxuXG4gIC8vIGVuZHJlZ2lvblxufVxuIl19