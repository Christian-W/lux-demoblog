import * as tslib_1 from "tslib";
import { Component, EventEmitter, HostBinding, Input, Output } from '@angular/core';
import { visibilityTrigger } from './lux-message-box-model/lux-message-box.animations';
import { MatPaginatorIntl } from '@angular/material';
import { LuxPaginatorIntl } from '../../lux-util/lux-paginator-intl';
var LuxMessageBoxComponent = /** @class */ (function () {
    function LuxMessageBoxComponent() {
        this._luxMessages = [];
        this._luxMaximumDisplayed = 1;
        this._luxIndex = 0;
        this.displayedMessages = [];
        this.boxShadow = true;
        this.luxMessageChanged = new EventEmitter();
        this.luxMessageClosed = new EventEmitter();
        this.luxMessageBoxClosed = new EventEmitter();
    }
    Object.defineProperty(LuxMessageBoxComponent.prototype, "luxIndex", {
        get: function () {
            return this._luxIndex;
        },
        set: function (index) {
            if (index < 0) {
                index = 0;
            }
            if (index > this.luxMessages.length) {
                index = this.luxMessages.length;
            }
            this._luxIndex = index;
            this.updateDisplayedMessages(index);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LuxMessageBoxComponent.prototype, "luxMaximumDisplayed", {
        get: function () {
            return this._luxMaximumDisplayed;
        },
        set: function (max) {
            if (max < 0) {
                max = 0;
            }
            this._luxMaximumDisplayed = max;
            this.updateDisplayedMessages(this.luxIndex);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LuxMessageBoxComponent.prototype, "luxMessages", {
        get: function () {
            return this._luxMessages;
        },
        set: function (messages) {
            if (messages && messages.length > 0) {
                this._luxMessages = messages;
                this.updateDisplayedMessages(this.luxIndex);
            }
            else {
                // Wenn es vorher Werte gab, ein Closed-Event ausgeben
                if (this.luxMessages.length > 0) {
                    this.luxMessageBoxClosed.emit();
                }
                this._luxMessages = [];
            }
        },
        enumerable: true,
        configurable: true
    });
    LuxMessageBoxComponent.prototype.ngOnInit = function () { };
    /**
     * Wird aufgerufen, wenn der Close-Button für eine MessageBox aufgerufen wurde.
     *
     * Gibt eine Event-Payload mit der betroffenen Nachricht mit Index weiter.
     * @param $event
     */
    LuxMessageBoxComponent.prototype.messageClosed = function ($event) {
        var eventPayload = {
            index: this.luxMessages.findIndex(function (compareMessage) { return compareMessage === $event; }),
            message: $event
        };
        this.luxMessageClosed.emit(eventPayload);
        this.luxMessages = this.luxMessages.filter(function (message) { return message !== $event; });
    };
    /**
     * Aktualisiert die angezeigten Nachrichten und den Paginator,
     * gibt außerdem das Change-Event mit den angezeigten/vorherigen Nachrichten.
     * @param $event
     */
    LuxMessageBoxComponent.prototype.pageChanged = function ($event) {
        var previousDisplayedMessages = tslib_1.__spread(this.displayedMessages);
        var previousIndex = this.luxIndex;
        this.updateDisplayedMessages($event.pageIndex);
        var messageChangePayload = {
            currentPage: {
                index: this.luxIndex,
                messages: tslib_1.__spread(this.displayedMessages)
            },
            previousPage: {
                index: previousIndex,
                messages: previousDisplayedMessages
            }
        };
        this.luxMessageChanged.emit(messageChangePayload);
    };
    /**
     * Aktualisiert die aktuell angezeigten Nachrichten anhand des Index.
     * @param pageIndex
     * @param pageSize
     */
    LuxMessageBoxComponent.prototype.updateDisplayedMessages = function (pageIndex) {
        var start = pageIndex * this.luxMaximumDisplayed;
        var end = start + this.luxMaximumDisplayed;
        // Wenn der luxIndex und der PageIndex ungleich sind, den luxIndex aktualisieren
        if (this.luxIndex !== pageIndex) {
            this._luxIndex = pageIndex;
        }
        // Checken, ob der Index nicht die Array-Größe sprengt
        if (this.luxIndex > this.luxMessages.length) {
            this._luxIndex = this.luxMessages.length;
        }
        if (this.luxIndex < 0) {
            this._luxIndex = 0;
        }
        // Nachrichten aktualisieren
        this.displayedMessages = this.luxMessages.slice(start, end);
        // Wenn die angezeigten Nachrichten leer sind, aber noch weitere vorhanden sind, die vorherige Seite anzeigen
        if (this.displayedMessages.length === 0 && this.luxMessages.length > 0 && this.luxIndex > 0) {
            this.updateDisplayedMessages(this.luxIndex - 1);
        }
    };
    tslib_1.__decorate([
        HostBinding('class.mat-elevation-z4'),
        tslib_1.__metadata("design:type", Boolean)
    ], LuxMessageBoxComponent.prototype, "boxShadow", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", EventEmitter)
    ], LuxMessageBoxComponent.prototype, "luxMessageChanged", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", EventEmitter)
    ], LuxMessageBoxComponent.prototype, "luxMessageClosed", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", EventEmitter)
    ], LuxMessageBoxComponent.prototype, "luxMessageBoxClosed", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Number),
        tslib_1.__metadata("design:paramtypes", [Number])
    ], LuxMessageBoxComponent.prototype, "luxIndex", null);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Number),
        tslib_1.__metadata("design:paramtypes", [Number])
    ], LuxMessageBoxComponent.prototype, "luxMaximumDisplayed", null);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Array),
        tslib_1.__metadata("design:paramtypes", [Array])
    ], LuxMessageBoxComponent.prototype, "luxMessages", null);
    LuxMessageBoxComponent = tslib_1.__decorate([
        Component({
            selector: 'lux-message-box',
            template: "<div fxLayout=\"column\" [@messageBoxVisibility] luxAriaRole=\"list\" *ngIf=\"luxMessages && luxMessages.length > 0\">\n  <ng-container *ngFor=\"let displayedMessage of displayedMessages\">\n    <lux-message\n      class=\"lux-message-box mat-elevation-z1\"\n      [luxMessage]=\"displayedMessage\"\n      (luxMessageClosed)=\"messageClosed($event)\"\n    >\n    </lux-message>\n  </ng-container>\n  <div\n    class=\"lux-message-box-footer\"\n    [ngClass]=\"{ 'lux-display-none': luxMessages.length === 1 || luxMaximumDisplayed >= luxMessages.length }\"\n  >\n    <mat-paginator\n      [length]=\"luxMessages.length\"\n      [pageSize]=\"luxMaximumDisplayed\"\n      [hidePageSize]=\"true\"\n      [pageIndex]=\"luxIndex\"\n      (page)=\"pageChanged($event)\"\n    >\n    </mat-paginator>\n  </div>\n</div>\n",
            animations: [visibilityTrigger],
            providers: [{ provide: MatPaginatorIntl, useClass: LuxPaginatorIntl }],
            styles: [":host{display:block;overflow:hidden}:host .lux-message-box{margin-bottom:2px}:host .lux-display-none{display:none}:host ::ng-deep lux-button ::ng-deep button,:host ::ng-deep lux-button ::ng-deep lux-icon{width:32px;max-width:32px;min-width:32px;font-size:.75em;padding:0}:host ::ng-deep lux-button ::ng-deep .mat-button-focus-overlay,:host ::ng-deep lux-button ::ng-deep .mat-button-ripple{display:none}:host ::ng-deep .lux-message-container{padding:0 24px}:host ::ng-deep .lux-hidden{visibility:hidden}:host mat-paginator ::ng-deep .mat-paginator-container{padding:0 20px!important}"]
        }),
        tslib_1.__metadata("design:paramtypes", [])
    ], LuxMessageBoxComponent);
    return LuxMessageBoxComponent;
}());
export { LuxMessageBoxComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibHV4LW1lc3NhZ2UtYm94LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BpaGstZ2ZpL2x1eC1jb21wb25lbnRzLyIsInNvdXJjZXMiOlsic3JjL2FwcC9tb2R1bGVzL2x1eC1jb21tb24vbHV4LW1lc3NhZ2UtYm94L2x1eC1tZXNzYWdlLWJveC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQVUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzVGLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLG9EQUFvRCxDQUFDO0FBR3ZGLE9BQU8sRUFBRSxnQkFBZ0IsRUFBYSxNQUFNLG1CQUFtQixDQUFDO0FBQ2hFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBU3JFO0lBMkRFO1FBMURRLGlCQUFZLEdBQWtCLEVBQUUsQ0FBQztRQUNqQyx5QkFBb0IsR0FBVyxDQUFDLENBQUM7UUFDakMsY0FBUyxHQUFXLENBQUMsQ0FBQztRQUU5QixzQkFBaUIsR0FBa0IsRUFBRSxDQUFDO1FBRUMsY0FBUyxHQUFZLElBQUksQ0FBQztRQUV2RCxzQkFBaUIsR0FBeUMsSUFBSSxZQUFZLEVBQTBCLENBQUM7UUFDckcscUJBQWdCLEdBQXdDLElBQUksWUFBWSxFQUF5QixDQUFDO1FBQ2xHLHdCQUFtQixHQUF1QixJQUFJLFlBQVksRUFBUSxDQUFDO0lBZ0Q5RCxDQUFDO0lBOUNQLHNCQUFJLDRDQUFRO2FBWXJCO1lBQ0UsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDO1FBQ3hCLENBQUM7YUFkUSxVQUFhLEtBQWE7WUFDakMsSUFBSSxLQUFLLEdBQUcsQ0FBQyxFQUFFO2dCQUNiLEtBQUssR0FBRyxDQUFDLENBQUM7YUFDWDtZQUNELElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxFQUFFO2dCQUNuQyxL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QVEsRUFBRSxpQkFBaUI7WUFDM0IsdXpCQUErQztZQUUvQyxVQUFVLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQztZQUMvQixTQUFTLEVBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxRQUFRLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQzs7U0FDdkUsQ0FBQzs7T0FDVyxzQkFBc0IsQ0F1SWxDO0lBQUQsNkJBQUM7Q0FBQSxBQXZJRCxJQXVJQztTQXZJWSxzQkFBc0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSG9zdEJpbmRpbmcsIElucHV0LCBPbkluaXQsIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgdmlzaWJpbGl0eVRyaWdnZXIgfSBmcm9tICcuL2x1eC1tZXNzYWdlLWJveC1tb2RlbC9sdXgtbWVzc2FnZS1ib3guYW5pbWF0aW9ucyc7XG5pbXBvcnQgeyBJTHV4TWVzc2FnZUNoYW5nZUV2ZW50LCBJTHV4TWVzc2FnZUNsb3NlRXZlbnQgfSBmcm9tICcuL2x1eC1tZXNzYWdlLWJveC1tb2RlbC9sdXgtbWVzc2FnZS1ldmVudHMuaW50ZXJmYWNlJztcbmltcG9ydCB7IElMdXhNZXNzYWdlIH0gZnJvbSAnLi9sdXgtbWVzc2FnZS1ib3gtbW9kZWwvbHV4LW1lc3NhZ2UuaW50ZXJmYWNlJztcbmltcG9ydCB7IE1hdFBhZ2luYXRvckludGwsIFBhZ2VFdmVudCB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsJztcbmltcG9ydCB7IEx1eFBhZ2luYXRvckludGwgfSBmcm9tICcuLi8uLi9sdXgtdXRpbC9sdXgtcGFnaW5hdG9yLWludGwnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdsdXgtbWVzc2FnZS1ib3gnLFxuICB0ZW1wbGF0ZVVybDogJy4vbHV4LW1lc3NhZ2UtYm94LmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vbHV4LW1lc3NhZ2UtYm94LmNvbXBvbmVudC5zY3NzJ10sXG4gIGFuaW1hdGlvbnM6IFt2aXNpYmlsaXR5VHJpZ2dlcl0sXG4gIHByb3ZpZGVyczogW3sgcHJvdmlkZTogTWF0UGFnaW5hdG9ySW50bCwgdXNlQ2xhc3M6IEx1eFBhZ2luYXRvckludGwgfV1cbn0pXG5leHBvcnQgY2xhc3MgTHV4TWVzc2FnZUJveENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIHByaXZhdGUgX2x1eE1lc3NhZ2VzOiBJTHV4TWVzc2FnZVtdID0gW107XG4gIHByaXZhdGUgX2x1eE1heGltdW1EaXNwbGF5ZWQ6IG51bWJlciA9IDE7XG4gIHByaXZhdGUgX2x1eEluZGV4OiBudW1iZXIgPSAwO1xuXG4gIGRpc3BsYXllZE1lc3NhZ2VzOiBJTHV4TWVzc2FnZVtdID0gW107XG5cbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5tYXQtZWxldmF0aW9uLXo0JykgYm94U2hhZG93OiBib29sZWFuID0gdHJ1ZTtcblxuICBAT3V0cHV0KCkgbHV4TWVzc2FnZUNoYW5nZWQ6IEV2ZW50RW1pdHRlcjxJTHV4TWVzc2FnZUNoYW5nZUV2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8SUx1eE1lc3NhZ2VDaGFuZ2VFdmVudD4oKTtcbiAgQE91dHB1dCgpIGx1eE1lc3NhZ2VDbG9zZWQ6IEV2ZW50RW1pdHRlcjxJTHV4TWVzc2FnZUNsb3NlRXZlbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxJTHV4TWVzc2FnZUNsb3NlRXZlbnQ+KCk7XG4gIEBPdXRwdXQoKSBsdXhNZXNzYWdlQm94Q2xvc2VkOiBFdmVudEVtaXR0ZXI8dm9pZD4gPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XG5cbiAgQElucHV0KCkgc2V0IGx1eEluZGV4KGluZGV4OiBudW1iZXIpIHtcbiAgICBpZiAoaW5kZXggPCAwKSB7XG4gICAgICBpbmRleCA9IDA7XG4gICAgfVxuICAgIGlmIChpbmRleCA+IHRoaXMubHV4TWVzc2FnZXMubGVuZ3RoKSB7XG4gICAgICBpbmRleCA9IHRoaXMubHV4TWVzc2FnZXMubGVuZ3RoO1xuICAgIH1cblxuICAgIHRoaXMuX2x1eEluZGV4ID0gaW5kZXg7XG4gICAgdGhpcy51cGRhdGVEaXNwbGF5ZWRNZXNzYWdlcyhpbmRleCk7XG4gIH1cblxuICBnZXQgbHV4SW5kZXgoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5fbHV4SW5kZXg7XG4gIH1cblxuICBASW5wdXQoKSBzZXQgbHV4TWF4aW11bURpc3BsYXllZChtYXg6IG51bWJlcikge1xuICAgIGlmIChtYXggPCAwKSB7XG4gICAgICBtYXggPSAwO1xuICAgIH1cbiAgICB0aGlzLl9sdXhNYXhpbXVtRGlzcGxheWVkID0gbWF4O1xuXG4gICAgdGhpcy51cGRhdGVEaXNwbGF5ZWRNZXNzYWdlcyh0aGlzLmx1eEluZGV4KTtcbiAgfVxuXG4gIGdldCBsdXhNYXhpbXVtRGlzcGxheWVkKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuX2x1eE1heGltdW1EaXNwbGF5ZWQ7XG4gIH1cblxuICBASW5wdXQoKSBzZXQgbHV4TWVzc2FnZXMobWVzc2FnZXM6IElMdXhNZXNzYWdlW10pIHtcbiAgICBpZiAobWVzc2FnZXMgJiYgbWVzc2FnZXMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5fbHV4TWVzc2FnZXMgPSBtZXNzYWdlcztcbiAgICAgIHRoaXMudXBkYXRlRGlzcGxheWVkTWVzc2FnZXModGhpcy5sdXhJbmRleCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFdlbm4gZXMgdm9yaGVyIFdlcnRlIGdhYiwgZWluIENsb3NlZC1FdmVudCBhdXNnZWJlblxuICAgICAgaWYgKHRoaXMubHV4TWVzc2FnZXMubGVuZ3RoID4gMCkge1xuICAgICAgICB0aGlzLmx1eE1lc3NhZ2VCb3hDbG9zZWQuZW1pdCgpO1xuICAgICAgfVxuICAgICAgdGhpcy5fbHV4TWVzc2FnZXMgPSBbXTtcbiAgICB9XG4gIH1cblxuICBnZXQgbHV4TWVzc2FnZXMoKTogSUx1eE1lc3NhZ2VbXSB7XG4gICAgcmV0dXJuIHRoaXMuX2x1eE1lc3NhZ2VzO1xuICB9XG5cbiAgY29uc3RydWN0b3IoKSB7fVxuXG4gIG5nT25Jbml0KCkge31cblxuICAvKipcbiAgICogV2lyZCBhdWZnZXJ1ZmVuLCB3ZW5uIGRlciBDbG9zZS1CdXR0b24gZsO8ciBlaW5lIE1lc3NhZ2VCb3ggYXVmZ2VydWZlbiB3dXJkZS5cbiAgICpcbiAgICogR2lidCBlaW5lIEV2ZW50LVBheWxvYWQgbWl0IGRlciBiZXRyb2ZmZW5lbiBOYWNocmljaHQgbWl0IEluZGV4IHdlaXRlci5cbiAgICogQHBhcmFtICRldmVudFxuICAgKi9cbiAgbWVzc2FnZUNsb3NlZCgkZXZlbnQ6IElMdXhNZXNzYWdlKSB7XG4gICAgY29uc3QgZXZlbnRQYXlsb2FkOiBJTHV4TWVzc2FnZUNsb3NlRXZlbnQgPSB7XG4gICAgICBpbmRleDogdGhpcy5sdXhNZXNzYWdlcy5maW5kSW5kZXgoKGNvbXBhcmVNZXNzYWdlOiBJTHV4TWVzc2FnZSkgPT4gY29tcGFyZU1lc3NhZ2UgPT09ICRldmVudCksXG4gICAgICBtZXNzYWdlOiAkZXZlbnRcbiAgICB9O1xuICAgIHRoaXMubHV4TWVzc2FnZUNsb3NlZC5lbWl0KGV2ZW50UGF5bG9hZCk7XG5cbiAgICB0aGlzLmx1eE1lc3NhZ2VzID0gdGhpcy5sdXhNZXNzYWdlcy5maWx0ZXIoKG1lc3NhZ2U6IElMdXhNZXNzYWdlKSA9PiBtZXNzYWdlICE9PSAkZXZlbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFrdHVhbGlzaWVydCBkaWUgYW5nZXplaWd0ZW4gTmFjaHJpY2h0ZW4gdW5kIGRlbiBQYWdpbmF0b3IsXG4gICAqIGdpYnQgYXXDn2VyZGVtIGRhcyBDaGFuZ2UtRXZlbnQgbWl0IGRlbiBhbmdlemVpZ3Rlbi92b3JoZXJpZ2VuIE5hY2hyaWNodGVuLlxuICAgKiBAcGFyYW0gJGV2ZW50XG4gICAqL1xuICBwYWdlQ2hhbmdlZCgkZXZlbnQ6IFBhZ2VFdmVudCkge1xuICAgIGNvbnN0IHByZXZpb3VzRGlzcGxheWVkTWVzc2FnZXMgPSBbLi4udGhpcy5kaXNwbGF5ZWRNZXNzYWdlc107XG4gICAgY29uc3QgcHJldmlvdXNJbmRleCA9IHRoaXMubHV4SW5kZXg7XG5cbiAgICB0aGlzLnVwZGF0ZURpc3BsYXllZE1lc3NhZ2VzKCRldmVudC5wYWdlSW5kZXgpO1xuXG4gICAgY29uc3QgbWVzc2FnZUNoYW5nZVBheWxvYWQ6IElMdXhNZXNzYWdlQ2hhbmdlRXZlbnQgPSB7XG4gICAgICBjdXJyZW50UGFnZToge1xuICAgICAgICBpbmRleDogdGhpcy5sdXhJbmRleCxcbiAgICAgICAgbWVzc2FnZXM6IFsuLi50aGlzLmRpc3BsYXllZE1lc3NhZ2VzXVxuICAgICAgfSxcbiAgICAgIHByZXZpb3VzUGFnZToge1xuICAgICAgICBpbmRleDogcHJldmlvdXNJbmRleCxcbiAgICAgICAgbWVzc2FnZXM6IHByZXZpb3VzRGlzcGxheWVkTWVzc2FnZXNcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy5sdXhNZXNzYWdlQ2hhbmdlZC5lbWl0KG1lc3NhZ2VDaGFuZ2VQYXlsb2FkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBa3R1YWxpc2llcnQgZGllIGFrdHVlbGwgYW5nZXplaWd0ZW4gTmFjaHJpY2h0ZW4gYW5oYW5kIGRlcyBJbmRleC5cbiAgICogQHBhcmFtIHBhZ2VJbmRleFxuICAgKiBAcGFyYW0gcGFnZVNpemVcbiAgICovXG4gIHVwZGF0ZURpc3BsYXllZE1lc3NhZ2VzKHBhZ2VJbmRleDogbnVtYmVyKSB7XG4gICAgY29uc3Qgc3RhcnQgPSBwYWdlSW5kZXggKiB0aGlzLmx1eE1heGltdW1EaXNwbGF5ZWQ7XG4gICAgY29uc3QgZW5kID0gc3RhcnQgKyB0aGlzLmx1eE1heGltdW1EaXNwbGF5ZWQ7XG5cbiAgICAvLyBXZW5uIGRlciBsdXhJbmRleCB1bmQgZGVyIFBhZ2VJbmRleCB1bmdsZWljaCBzaW5kLCBkZW4gbHV4SW5kZXggYWt0dWFsaXNpZXJlblxuICAgIGlmICh0aGlzLmx1eEluZGV4ICE9PSBwYWdlSW5kZXgpIHtcbiAgICAgIHRoaXMuX2x1eEluZGV4ID0gcGFnZUluZGV4O1xuICAgIH1cblxuICAgIC8vIENoZWNrZW4sIG9iIGRlciBJbmRleCBuaWNodCBkaWUgQXJyYXktR3LDtsOfZSBzcHJlbmd0XG4gICAgaWYgKHRoaXMubHV4SW5kZXggPiB0aGlzLmx1eE1lc3NhZ2VzLmxlbmd0aCkge1xuICAgICAgdGhpcy5fbHV4SW5kZXggPSB0aGlzLmx1eE1lc3NhZ2VzLmxlbmd0aDtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5sdXhJbmRleCA8IDApIHtcbiAgICAgIHRoaXMuX2x1eEluZGV4ID0gMDtcbiAgICB9XG5cbiAgICAvLyBOYWNocmljaHRlbiBha3R1YWxpc2llcmVuXG4gICAgdGhpcy5kaXNwbGF5ZWRNZXNzYWdlcyA9IHRoaXMubHV4TWVzc2FnZXMuc2xpY2Uoc3RhcnQsIGVuZCk7XG5cbiAgICAvLyBXZW5uIGRpZSBhbmdlemVpZ3RlbiBOYWNocmljaHRlbiBsZWVyIHNpbmQsIGFiZXIgbm9jaCB3ZWl0ZXJlIHZvcmhhbmRlbiBzaW5kLCBkaWUgdm9yaGVyaWdlIFNlaXRlIGFuemVpZ2VuXG4gICAgaWYgKHRoaXMuZGlzcGxheWVkTWVzc2FnZXMubGVuZ3RoID09PSAwICYmIHRoaXMubHV4TWVzc2FnZXMubGVuZ3RoID4gMCAmJiB0aGlzLmx1eEluZGV4ID4gMCkge1xuICAgICAgdGhpcy51cGRhdGVEaXNwbGF5ZWRNZXNzYWdlcyh0aGlzLmx1eEluZGV4IC0gMSk7XG4gICAgfVxuICB9XG59XG4iXX0=