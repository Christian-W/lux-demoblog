import * as tslib_1 from "tslib";
import { ChangeDetectorRef, ElementRef, EventEmitter, HostBinding, HostListener, Input, Optional, Output, ViewChild } from '@angular/core';
import { ControlContainer, Validators } from '@angular/forms';
import { LuxConsoleService } from '../../lux-util/lux-console.service';
import { LuxUtil } from '../../lux-util/lux-util';
import { LuxFormComponentBase } from './lux-form-component-base.class';
import { LuxFileErrorCause } from '../lux-file/lux-file-model/lux-file-error.interface';
import { HttpClient, HttpEventType } from '@angular/common/http';
import { isObservable, throwError } from 'rxjs';
import { LuxComponentsConfigService } from '../../lux-components-config/lux-components-config.service';
import { LiveAnnouncer } from '@angular/cdk/a11y';
var LuxFormFileBase = /** @class */ (function (_super) {
    tslib_1.__extends(LuxFormFileBase, _super);
    function LuxFormFileBase(controlContainer, cdr, logger, config, http, liveAnnouncer) {
        var _this = _super.call(this, controlContainer, cdr, logger, config) || this;
        _this.http = http;
        _this.liveAnnouncer = liveAnnouncer;
        _this.defaultReadFileDelay = 1000;
        _this._luxAccept = '';
        _this._luxUploadActionConfig = {
            disabled: false,
            hidden: false,
            iconName: 'fas fa-cloud-upload-alt',
            label: 'Hochladen'
        };
        _this._luxDeleteActionConfig = {
            disabled: false,
            hidden: false,
            iconName: 'fas fa-trash',
            label: 'Löschen'
        };
        _this._luxViewActionConfig = {
            disabled: false,
            hidden: true,
            iconName: 'fas fa-eye',
            label: 'Ansehen'
        };
        _this._luxDownloadActionConfig = {
            disabled: false,
            hidden: true,
            iconName: 'fas fa-download',
            label: 'Download'
        };
        _this.progress = -1;
        _this.forceProgressIndeterminate = false;
        _this.luxSelectedFilesChange = new EventEmitter();
        _this.luxUploadReportProgress = false;
        _this.luxContentsAsBlob = false;
        _this.luxMaxSizeMB = 10;
        _this.luxCapture = '';
        _this.luxUploadUrl = '';
        _this.luxDnDActive = true;
        _this.isDragActive = false;
        return _this;
    }
    LuxFormFileBase.prototype.onDragOver = function ($event) {
        if (this.isDnDAllowed()) {
            this.handleDragOver($event);
        }
    };
    LuxFormFileBase.prototype.onDragLeave = function ($event) {
        if (this.isDnDAllowed()) {
            this.handleDragLeave($event);
        }
    };
    LuxFormFileBase.prototype.onDrop = function ($event) {
        if (this.isDnDAllowed()) {
            this.handleDrop($event);
        }
    };
    Object.defineProperty(LuxFormFileBase.prototype, "luxUploadActionConfig", {
        get: function () {
            return this._luxUploadActionConfig;
        },
        set: function (config) {
            if (config) {
                this._luxUploadActionConfig = config;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LuxFormFileBase.prototype, "luxDeleteActionConfig", {
        get: function () {
            return this._luxDeleteActionConfig;
        },
        set: function (config) {
            if (config) {
                this._luxDeleteActionConfig = config;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LuxFormFileBase.prototype, "luxViewActionConfig", {
        get: function () {
            return this._luxViewActionConfig;
        },
        set: function (config) {
            if (config) {
                this._luxViewActionConfig = config;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LuxFormFileBase.prototype, "luxDownloadActionConfig", {
        get: function () {
            return this._luxDownloadActionConfig;
        },
        set: function (config) {
            if (config) {
                this._luxDownloadActionConfig = config;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LuxFormFileBase.prototype, "luxSelectedFiles", {
        get: function () {
            return this.getValue();
        },
        set: function (selectedFiles) {
            this.setValue(selectedFiles);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LuxFormFileBase.prototype, "luxAccept", {
        get: function () {
            return this._luxAccept;
        },
        set: function (accepts) {
            if (!accepts) {
                accepts = '';
            }
            this._luxAccept = Array.isArray(accepts) ? accepts.join(',') : accepts;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LuxFormFileBase.prototype, "progressMode", {
        get: function () {
            return (this.progress === 0 && !this.luxUploadReportProgress) || this.forceProgressIndeterminate
                ? 'indeterminate'
                : 'determinate';
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LuxFormFileBase.prototype, "isProgressVisible", {
        get: function () {
            return this.progress >= 0 || this.forceProgressIndeterminate;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Wird beim Fokussieren des Elements aufgerufen und markiert das FormControl als "touched".
     * @param $event
     */
    LuxFormFileBase.prototype.onFocusIn = function ($event) {
        this.formControl.markAsTouched();
        this.luxFocusIn.emit($event);
    };
    /**
     * Entfernt die aktuell selektierten Dateien und entfernt etwaige (spezifische) Fehler aus dem FormControl.
     * @param $event
     */
    LuxFormFileBase.prototype.clearFiles = function ($event) {
        this.formControl.markAsTouched();
        this.formControl.markAsDirty();
        this.luxSelectedFiles = undefined;
        this.notifyFormValueChanged();
        this.clearFormControlErrors();
        if (this.luxDeleteActionConfig.onClick) {
            this.luxDeleteActionConfig.onClick();
        }
        this.announceAllFilesRemove();
    };
    /**
     * Löst den Download der übergebenen Datei aus.
     * @param file
     */
    LuxFormFileBase.prototype.downloadFile = function (file) {
        this.formControl.markAsTouched();
        file = Array.isArray(file) ? file[0] : file;
        var downloadLink = this.downloadLink.nativeElement;
        downloadLink.download = file.name;
        if (file.content instanceof Blob) {
            if (window.navigator.msSaveBlob) {
                // IE
                window.navigator.msSaveOrOpenBlob(file.content, file.name);
            }
            else {
                var url = window.URL.createObjectURL(file.content);
                downloadLink.href = url;
                downloadLink.click();
                window.URL.revokeObjectURL(url);
            }
        }
        else {
            if (window.navigator.msSaveBlob) {
                // IE
                try {
                    var arrBuffer = LuxUtil.base64ToArrayBuffer(file.content.split(',')[1]);
                    window.navigator.msSaveOrOpenBlob(new Blob([arrBuffer], { type: file.type }), file.name);
                }
                catch (e) {
                    console.log(e);
                }
            }
            else {
                downloadLink.href = file.content;
                downloadLink.click();
            }
        }
        if (this.luxDownloadActionConfig.onClick) {
            this.luxDownloadActionConfig.onClick(file);
        }
    };
    /**
     * Löst den base64Callback der übergebenen Datei aus.
     * Schreibt dann anschließend den Base64-String in die Datei.
     * @param file
     */
    LuxFormFileBase.prototype.viewFile = function (file) {
        var _this = this;
        this.formControl.markAsTouched();
        // Wenn die Datei bereits einen Base64-Wert besitzt, den onClick-Callback ausführen
        if (file.content) {
            this.triggerViewFileClick(file);
            return;
        }
        var callbackResult = file.contentCallback();
        // Wenn der Callback ein Observable ist, dieses auflösen und dem File-Base64 zuweisen
        if (isObservable(callbackResult)) {
            callbackResult.subscribe(function (content) {
                file.content = content;
                _this.triggerViewFileClick(file);
            });
        }
        else {
            // Wenn der Callback ein normaler String oder Promise ist, diesen auflösen und den File-Base64 aktualisieren
            Promise.resolve(callbackResult).then(function (content) {
                file.content = content;
                _this.triggerViewFileClick(file);
            });
        }
    };
    /**
     * Wandelt File-Objekt zu LuxFileObjects um und versucht diese Hochzuladen.
     * Gibt ein Promise mit den neuen FileObjects zurück bzw. einen Fehler aus den internen Promises.
     * @param files
     */
    LuxFormFileBase.prototype.updateSelectedFiles = function (files) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var newFiles_1, error_1;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 3, , 4]);
                        newFiles_1 = [];
                        return [4 /*yield*/, this.mapFilesToFileObjects(files).then(function (fileObjects) { return (newFiles_1 = fileObjects); })];
                    case 1:
                        _a.sent();
                        return [4 /*yield*/, this.uploadFiles(newFiles_1)];
                    case 2:
                        _a.sent();
                        if (this.luxUploadActionConfig.onClick) {
                            this.luxUploadActionConfig.onClick(newFiles_1 && newFiles_1.length === 1 ? newFiles_1[0] : newFiles_1);
                        }
                        this.formControl.markAsTouched();
                        this.formControl.markAsDirty();
                        return [2 /*return*/, Promise.resolve(newFiles_1)];
                    case 3:
                        error_1 = _a.sent();
                        return [2 /*return*/, Promise.reject(error_1)];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    /**
     * Stößt das Hochladen der Dateien zu einer bestimmten URL an.
     */
    LuxFormFileBase.prototype.uploadFiles = function (files) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var formData, selectedFiles;
            var _this = this;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!this.luxUploadUrl) {
                            this.forceProgressIndeterminate = false;
                            return [2 /*return*/, Promise.resolve()];
                        }
                        if (this.luxUploadReportProgress) {
                            this.forceProgressIndeterminate = false;
                        }
                        this.progress = 0;
                        formData = new FormData();
                        selectedFiles = [];
                        if (!files) {
                            selectedFiles = [];
                        }
                        else if (!Array.isArray(files)) {
                            selectedFiles.push(files);
                        }
                        else {
                            selectedFiles.push.apply(selectedFiles, tslib_1.__spread(files));
                        }
                        selectedFiles.forEach(function (fileObject) {
                            formData.append(fileObject.name, fileObject.content);
                        });
                        return [4 /*yield*/, new Promise(function (resolve, reject) {
                                var options = {};
                                if (_this.luxUploadReportProgress) {
                                    options['reportProgress'] = true;
                                    options['observe'] = 'events';
                                }
                                options['responseType'] = 'blob';
                                _this.http.post(_this.luxUploadUrl, formData, options).subscribe(function (event) {
                                    // wenn wir eine determinierte Fortschrittsanzeige haben, dann muss der Fortschritt auch korrekt abgefangen werden
                                    if (_this.luxUploadReportProgress) {
                                        if (event.type === HttpEventType.UploadProgress) {
                                            _this.progress = Math.round((event.loaded / event.total) * 100);
                                        }
                                        else if (event.type === HttpEventType.Response) {
                                            resolve();
                                        }
                                    }
                                    else {
                                        resolve();
                                    }
                                }, function (error) {
                                    // Hier geben wir den speziellen Fehler noch mal in die console
                                    console.error(error);
                                    // Für den Fall das der Upload fehlschlägt, melden wir einen Fehler am Component
                                    reject(error);
                                    return throwError(error);
                                });
                            }).then(function () {
                                _this.progress = -1;
                                _this.forceProgressIndeterminate = false;
                                return Promise.resolve();
                            }, function (error) {
                                _this.progress = -1;
                                _this.forceProgressIndeterminate = false;
                                return Promise.reject({
                                    cause: LuxFileErrorCause.UploadFileError,
                                    exception: error,
                                    file: files
                                });
                            })];
                    case 1:
                        _a.sent();
                        return [2 /*return*/];
                }
            });
        });
    };
    /**
     * Liest die übergebenen Dateien aus und erzeugt daraus ein Promise, welches abgefragt werden kann.
     * Fängt potentielle Fehler ab und gibt diese als abgelehnte Promises zurück.
     * @param files
     */
    LuxFormFileBase.prototype.mapFilesToFileObjects = function (files) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var e_1, _a, filesArray, newFiles, _loop_1, this_1, filesArray_1, filesArray_1_1, file, state_1, e_1_1;
            return tslib_1.__generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        this._luxSelectedFiles = [];
                        filesArray = Array.from(files);
                        newFiles = [];
                        _loop_1 = function (file) {
                            var splitAccepted, splitFileEnding, fileEnding, isAccepted;
                            return tslib_1.__generator(this, function (_a) {
                                switch (_a.label) {
                                    case 0:
                                        if (!file) {
                                            return [2 /*return*/, "continue"];
                                        }
                                        // Prüfen ob Dateigröße überschritten worden ist
                                        if (this_1.getFileSizeInMB(file) > this_1.luxMaxSizeMB) {
                                            return [2 /*return*/, { value: Promise.reject({
                                                        cause: LuxFileErrorCause.MaxSizeError,
                                                        exception: this_1.getMaxSizeErrorMessage(file),
                                                        file: file
                                                    }) }];
                                        }
                                        splitAccepted = this_1.luxAccept ? this_1.luxAccept.split(',') : [];
                                        splitFileEnding = file.name.split('.');
                                        fileEnding = "." + splitFileEnding[splitFileEnding.length - 1];
                                        isAccepted = splitAccepted.length === 0 ? true : false;
                                        splitAccepted.forEach(function (accepted) {
                                            if (accepted) {
                                                accepted = accepted.toLocaleLowerCase();
                                                if (accepted === '.txt') {
                                                    accepted = 'text/plain';
                                                }
                                            }
                                            if (!isAccepted) {
                                                // Für spezielle Wildcards nutzen wir diese Umwandlung
                                                switch (accepted) {
                                                    case 'image/*':
                                                        accepted = 'image';
                                                        break;
                                                    case 'video/*':
                                                        accepted = 'video';
                                                        break;
                                                    case 'audio/*':
                                                        accepted = 'audio';
                                                        break;
                                                }
                                                if (accepted === fileEnding.toLocaleLowerCase() || file.type.toLocaleLowerCase().indexOf(accepted) > -1) {
                                                    isAccepted = true;
                                                }
                                            }
                                        });
                                        if (!isAccepted) {
                                            return [2 /*return*/, { value: Promise.reject({
                                                        cause: LuxFileErrorCause.FileNotAccepted,
                                                        exception: this_1.getFileNotAcceptedMessage(file),
                                                        file: file
                                                    }) }];
                                        }
                                        if (!this_1.luxContentsAsBlob) return [3 /*break*/, 1];
                                        // Wenn direkt die Blobs genutzt werden sollen, einfach die Datei als content merken
                                        newFiles.push({ name: file.name, content: file, type: file.type });
                                        return [3 /*break*/, 3];
                                    case 1: 
                                    // Das Auslesen der Datei anstoßen, wenn erfolgreich, wird die Datei zu selectedFiles hinzugefügt.
                                    // Bei einem Fehler wird das Promise rejected und gibt einen Fehler zurück.
                                    return [4 /*yield*/, this_1.readFile(file)
                                            .then(function (content) {
                                            newFiles.push({ name: file.name, content: content, type: file.type });
                                        })
                                            .catch(function (error) {
                                            return Promise.reject({
                                                cause: LuxFileErrorCause.ReadingFileError,
                                                exception: error,
                                                file: file
                                            });
                                        })];
                                    case 2:
                                        // Das Auslesen der Datei anstoßen, wenn erfolgreich, wird die Datei zu selectedFiles hinzugefügt.
                                        // Bei einem Fehler wird das Promise rejected und gibt einen Fehler zurück.
                                        _a.sent();
                                        _a.label = 3;
                                    case 3: return [2 /*return*/];
                                }
                            });
                        };
                        this_1 = this;
                        _b.label = 1;
                    case 1:
                        _b.trys.push([1, 6, 7, 8]);
                        filesArray_1 = tslib_1.__values(filesArray), filesArray_1_1 = filesArray_1.next();
                        _b.label = 2;
                    case 2:
                        if (!!filesArray_1_1.done) return [3 /*break*/, 5];
                        file = filesArray_1_1.value;
                        return [5 /*yield**/, _loop_1(file)];
                    case 3:
                        state_1 = _b.sent();
                        if (typeof state_1 === "object")
                            return [2 /*return*/, state_1.value];
                        _b.label = 4;
                    case 4:
                        filesArray_1_1 = filesArray_1.next();
                        return [3 /*break*/, 2];
                    case 5: return [3 /*break*/, 8];
                    case 6:
                        e_1_1 = _b.sent();
                        e_1 = { error: e_1_1 };
                        return [3 /*break*/, 8];
                    case 7:
                        try {
                            if (filesArray_1_1 && !filesArray_1_1.done && (_a = filesArray_1.return)) _a.call(filesArray_1);
                        }
                        finally { if (e_1) throw e_1.error; }
                        return [7 /*endfinally*/];
                    case 8: 
                    // Das Array mit den neuen Dateien zurückgeben
                    return [2 /*return*/, Promise.resolve(newFiles)];
                }
            });
        });
    };
    /**
     * Liest (asynchron) den Base64-String aus der übergebenen Datei heraus bzw. gibt den Fehler zurück, wenn einer
     * aufgetreten ist.
     * @param file
     */
    LuxFormFileBase.prototype.readFile = function (file) {
        return new Promise(function (resolve, reject) {
            var reader = new window['FileReader']();
            reader.onload = function (fileData) { return resolve(fileData.target.result); };
            reader.onerror = function (error) { return reject(error); };
            reader.readAsDataURL(file);
        });
    };
    /**
     * Wird beim Drag-Over über dem LuxFormControl aufgerufen.
     * @param $event
     */
    LuxFormFileBase.prototype.handleDragOver = function ($event) {
        this.isDragActive = true;
        $event.stopPropagation();
        $event.preventDefault();
        // Der Drop Effect wird nur gesetzt, wenn die Property auch
        // vorhanden ist. In den Tests gibt es keinen Drop Effect.
        if ($event.dataTransfer && $event.dataTransfer.dropEffect) {
            $event.dataTransfer.dropEffect = 'copy';
        }
    };
    /**
     * Wird beim Drag-Leave über dem LuxFormControl aufgerufen.
     * @param $event
     */
    LuxFormFileBase.prototype.handleDragLeave = function ($event) {
        if ($event.target.nodeName.toLocaleLowerCase() === 'lux-file-input') {
            this.isDragActive = false;
        }
        $event.stopPropagation();
        $event.preventDefault();
    };
    /**
     * Wird beim Drop eines/mehrerer gezogener Elemente über dem LuxFormControl aufgerufen und löst
     * die Auswähl-Methoden für die entsprechenden Dateien aus.
     */
    LuxFormFileBase.prototype.handleDrop = function ($event) {
        this.forceProgressIndeterminate = true;
        this.isDragActive = false;
        $event.stopPropagation();
        $event.preventDefault();
        if ($event.dataTransfer) {
            this.selectFiles($event.dataTransfer.files);
        }
    };
    /**
     * Prüft ob der Base64-String für die Datei gesetzt ist und ob ein onClick-Aufruf für die View-Action vorhanden ist.
     * Wenn ja, wird dieser ausgeführt.
     * @param file
     */
    LuxFormFileBase.prototype.triggerViewFileClick = function (file) {
        if (file.content && this.luxViewActionConfig.onClick) {
            this.luxViewActionConfig.onClick(file);
        }
    };
    /**
     * Entfernt die in dieser Component gesetzten Fehlermeldungen.
     */
    LuxFormFileBase.prototype.clearFormControlErrors = function () {
        var e_2, _a;
        // Das aktuelle Fehlerobjekt auslesen
        var errors = this.formControl.errors;
        if (errors) {
            try {
                // Die componentspezifischen Fehler aus dem Objekt entfernen
                for (var _b = tslib_1.__values(Object.keys(LuxFileErrorCause)), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var cause = _c.value;
                    delete errors[LuxFileErrorCause[cause]];
                }
            }
            catch (e_2_1) { e_2 = { error: e_2_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_2) throw e_2.error; }
            }
            // Falls errors ein leeres Objekt ist, nehmen wir stattdessen null
            errors = Object.keys(errors).length === 0 ? null : errors;
            // Das neue Fehlerobjekt in das FormControl schreiben
            this.formControl.setErrors(errors);
        }
    };
    /**
     * Aktualisiert das Fehlerobjekt am FormControl, damit eine entsprechende Fehlermeldung angezeigt werden kann.
     * Leert die Anzeige und gibt Events mit leerem Array aus.
     * @param error
     */
    LuxFormFileBase.prototype.setFormControlErrors = function (error) {
        this.forceProgressIndeterminate = false;
        // Vorherige definierte Fehler entfernen
        this.clearFormControlErrors();
        // Hier aktualisieren wir das Fehlerobjekt an dem zugrunde liegenden FormControl dieser Component
        var errors = this.formControl.errors ? this.formControl.errors : {};
        errors[error.cause] = { file: error.file };
        this.formControl.setErrors(errors);
    };
    /**
     * Berechnet die Größe der übergebenen Datei in MB.
     * @param file
     */
    LuxFormFileBase.prototype.getFileSizeInMB = function (file) {
        return file.size / 1000000;
    };
    /**
     * Gibt die Message für Überschreitung der maximalen Dateigröße zurück.
     * @param file
     */
    LuxFormFileBase.prototype.getMaxSizeErrorMessage = function (file) {
        return ("Die Datei \"" + file.name + "\" \u00FCberschreitet mit " + +this.getFileSizeInMB(file).toFixed(2) + "MB " +
            ("die erlaubte Dateigr\u00F6\u00DFe von " + +this.luxMaxSizeMB.toFixed(2) + "MB"));
    };
    /**
     * Gibt die Message für Fehler beim Auslesen einer Datei zurück.
     * @param file
     */
    LuxFormFileBase.prototype.getReadingFileErrorMessage = function (file) {
        return "Beim Lesen der Datei \"" + file.name + "\" ist ein Fehler aufgetreten";
    };
    /**
     * Gibt die Message für Fehler beim Upload einer Datei zurück.
     * @param files
     */
    LuxFormFileBase.prototype.getUploadFileErrorMessage = function (files) {
        if (!files) {
            return 'Das Hochladen ist fehlgeschlagen';
        }
        return "Das Hochladen der " + (files.length > 1 ? 'ausgewählten Dateien' : 'ausgewählten Datei') + " ist fehlgeschlagen";
    };
    /**
     * Gibt die Message für falsche Dateitypen zurück.
     * @param file
     */
    LuxFormFileBase.prototype.getFileNotAcceptedMessage = function (file) {
        return "Die Datei \"" + file.name + "\" hat einen nicht akzeptierten Dateityp";
    };
    /**
     * Gibt die Message für falsche Dateitypen zurück.
     * @param file
     */
    LuxFormFileBase.prototype.getMultipleForbiddenMessage = function () {
        return "Es darf nur eine Datei ausgew\u00E4hlt werden";
    };
    /**
     * Meldet dem ScreenReader, dass gerade eine/mehrere Dateien bearbeitet werden (Ladeanzeige).
     * @param multiple
     */
    LuxFormFileBase.prototype.announceFileProcess = function (multiple) {
        this.liveAnnouncer.announce("Bitte warten. Die " + (multiple ? 'Dateien werden' : 'Datei wird') + " verarbeitet.", 'assertive');
    };
    /**
     * Meldet dem ScreenReader, dass alle Dateien entfernt werden sollen.
     */
    LuxFormFileBase.prototype.announceAllFilesRemove = function () {
        this.liveAnnouncer.announce("Alle Dateien werden entfernt.", 'assertive');
    };
    /**
     * Meldet dem ScreenReader, dass eine bestimmte Datei entfernt werden soll.
     * @param fileName
     */
    LuxFormFileBase.prototype.announceFileRemove = function (fileName) {
        this.liveAnnouncer.announce("Die Datei " + fileName + " wird entfernt.", 'assertive');
    };
    /**
     * Gibt wieder, ob Drag-and-Drop gerade aktiv und möglich ist.
     */
    LuxFormFileBase.prototype.isDnDAllowed = function () {
        return this.luxDnDActive && !this.luxDisabled && !this.luxReadonly;
    };
    // region Overridden methods
    LuxFormFileBase.prototype.errorMessageModifier = function (value, errors) {
        if (errors[LuxFileErrorCause.MaxSizeError]) {
            return this.getMaxSizeErrorMessage(errors[LuxFileErrorCause.MaxSizeError].file);
        }
        else if (errors[LuxFileErrorCause.ReadingFileError]) {
            return this.getReadingFileErrorMessage(errors[LuxFileErrorCause.ReadingFileError].file);
        }
        else if (errors[LuxFileErrorCause.UploadFileError]) {
            return this.getUploadFileErrorMessage(errors[LuxFileErrorCause.UploadFileError].file);
        }
        else if (errors[LuxFileErrorCause.FileNotAccepted]) {
            return this.getFileNotAcceptedMessage(errors[LuxFileErrorCause.FileNotAccepted].file);
        }
        else if (errors[LuxFileErrorCause.MultipleForbidden]) {
            return this.getMultipleForbiddenMessage();
        }
        return undefined;
    };
    LuxFormFileBase.prototype.notifyFormValueChanged = function () {
        this.luxSelectedFilesChange.emit(this.luxSelectedFiles);
        // Wir leeren nach jedem Value-Change das Input, da wir das FormControl bereits als SSoT besitzen
        // und das Input durch den Browser gelegentlich sonst geblockt werden (wenn eine Datei ausgewählt worden ist)
        this.fileuploadInput.nativeElement.value = null;
    };
    LuxFormFileBase.prototype.updateValidators = function (validators) {
        if (!validators && this.luxRequired) {
            validators = Validators.required;
        }
        _super.prototype.updateValidators.call(this, validators);
    };
    LuxFormFileBase.prototype.initFormValueSubscription = function () {
        var _this = this;
        this._formValueChangeSubscr = this.formControl.valueChanges.subscribe(function () {
            // Wenn die Dateien erfolgreich gelesen werden konnten, die (spezifischen) Fehler entfernen
            _this.clearFormControlErrors();
        });
        if (this._initialValue !== null && this._initialValue !== undefined) {
            this.setValue(this._initialValue);
        }
    };
    LuxFormFileBase.prototype.triggerOutputPatternCheck = function () {
        this.checkOutputPatternViolation(this.luxSelectedFilesChange.observers);
    };
    LuxFormFileBase.prototype.triggerInputPatternCheck = function (simpleChanges) {
        this.checkInputPatternViolation(simpleChanges.luxSelectedFiles);
    };
    tslib_1.__decorate([
        ViewChild('downloadLink', { read: ElementRef, static: true }),
        tslib_1.__metadata("design:type", ElementRef)
    ], LuxFormFileBase.prototype, "downloadLink", void 0);
    tslib_1.__decorate([
        ViewChild('fileupload', { read: ElementRef, static: true }),
        tslib_1.__metadata("design:type", ElementRef)
    ], LuxFormFileBase.prototype, "fileuploadInput", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", EventEmitter)
    ], LuxFormFileBase.prototype, "luxSelectedFilesChange", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Boolean)
    ], LuxFormFileBase.prototype, "luxUploadReportProgress", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Boolean)
    ], LuxFormFileBase.prototype, "luxContentsAsBlob", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", String)
    ], LuxFormFileBase.prototype, "luxTagId", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Number)
    ], LuxFormFileBase.prototype, "luxMaxSizeMB", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", String)
    ], LuxFormFileBase.prototype, "luxCapture", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", String)
    ], LuxFormFileBase.prototype, "luxUploadUrl", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Boolean)
    ], LuxFormFileBase.prototype, "luxDnDActive", void 0);
    tslib_1.__decorate([
        HostBinding('class.lux-file-highlight'),
        tslib_1.__metadata("design:type", Boolean)
    ], LuxFormFileBase.prototype, "isDragActive", void 0);
    tslib_1.__decorate([
        HostListener('dragover', ['$event']),
        tslib_1.__metadata("design:type", Function),
        tslib_1.__metadata("design:paramtypes", [Object]),
        tslib_1.__metadata("design:returntype", void 0)
    ], LuxFormFileBase.prototype, "onDragOver", null);
    tslib_1.__decorate([
        HostListener('dragleave', ['$event']),
        tslib_1.__metadata("design:type", Function),
        tslib_1.__metadata("design:paramtypes", [Object]),
        tslib_1.__metadata("design:returntype", void 0)
    ], LuxFormFileBase.prototype, "onDragLeave", null);
    tslib_1.__decorate([
        HostListener('drop', ['$event']),
        tslib_1.__metadata("design:type", Function),
        tslib_1.__metadata("design:paramtypes", [Object]),
        tslib_1.__metadata("design:returntype", void 0)
    ], LuxFormFileBase.prototype, "onDrop", null);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object),
        tslib_1.__metadata("design:paramtypes", [Object])
    ], LuxFormFileBase.prototype, "luxUploadActionConfig", null);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object),
        tslib_1.__metadata("design:paramtypes", [Object])
    ], LuxFormFileBase.prototype, "luxDeleteActionConfig", null);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object),
        tslib_1.__metadata("design:paramtypes", [Object])
    ], LuxFormFileBase.prototype, "luxViewActionConfig", null);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object),
        tslib_1.__metadata("design:paramtypes", [Object])
    ], LuxFormFileBase.prototype, "luxDownloadActionConfig", null);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object),
        tslib_1.__metadata("design:paramtypes", [Object])
    ], LuxFormFileBase.prototype, "luxSelectedFiles", null);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object),
        tslib_1.__metadata("design:paramtypes", [Object])
    ], LuxFormFileBase.prototype, "luxAccept", null);
    LuxFormFileBase = tslib_1.__decorate([
        tslib_1.__param(0, Optional()),
        tslib_1.__metadata("design:paramtypes", [ControlContainer,
            ChangeDetectorRef,
            LuxConsoleService,
            LuxComponentsConfigService,
            HttpClient,
            LiveAnnouncer])
    ], LuxFormFileBase);
    return LuxFormFileBase;
}(LuxFormComponentBase));
export { LuxFormFileBase };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibHV4LWZvcm0tZmlsZS1iYXNlLmNsYXNzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGloay1nZmkvbHV4LWNvbXBvbmVudHMvIiwic291cmNlcyI6WyJzcmMvYXBwL21vZHVsZXMvbHV4LWZvcm0vbHV4LWZvcm0tbW9kZWwvbHV4LWZvcm0tZmlsZS1iYXNlLmNsYXNzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsaUJBQWlCLEVBQ2pCLFVBQVUsRUFDVixZQUFZLEVBQ1osV0FBVyxFQUNYLFlBQVksRUFDWixLQUFLLEVBQ0wsUUFBUSxFQUNSLE1BQU0sRUFFTixTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGdCQUFnQixFQUFlLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUN2RSxPQUFPLEVBQWlCLGlCQUFpQixFQUFFLE1BQU0scURBQXFELENBQUM7QUFDdkcsT0FBTyxFQUFFLFVBQVUsRUFBRSxhQUFhLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUVqRSxPQUFPLEVBQUUsWUFBWSxFQUFjLFVBQVUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUU1RCxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSwyREFBMkQsQ0FBQztBQUN2RyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFbEQ7SUFBOEMsMkNBQW9CO0lBd0loRSx5QkFDYyxnQkFBa0MsRUFDOUMsR0FBc0IsRUFDdEIsTUFBeUIsRUFDekIsTUFBa0MsRUFDeEIsSUFBZ0IsRUFDbEIsYUFBNEI7UUFOdEMsWUFRRSxrQkFBTSxnQkFBZ0IsRUFBRSxHQUFHLEVBQUUsTUFBTSxFQUFFLE1B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O1FBQVQsTUFBTSxFQUFFOzBDQUF5QixZQUFZO21FQUFnQztJQUVyRTtRQUFSLEtBQUssRUFBRTs7b0VBQTBDO0lBQ3pDO1FBQVIsS0FBSyxFQUFFOzs4REFBb0M7SUFDbkM7UUFBUixLQUFLLEVBQUU7O3FEQUFrQjtJQUNqQjtRQUFSLEtBQUssRUFBRTs7eURBQTJCO0lBQzFCO1FBQVIsS0FBSyxFQUFFOzt1REFBeUI7SUFDeEI7UUFBUixLQUFLLEVBQUU7O3lEQUEyQjtJQUMxQjtRQUFSLEtBQUssRUFBRTs7eURBQThCO0lBRUc7UUFBeEMsV0FBVyxDQUFDLDBCQUEwQixDQUFDOzt5REFBK0I7SUFFakM7UUFBckMsWUFBWSxDQUFDLFVBQVUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDOzs7O3FEQUlwQztJQUVzQztRQUF0QyxZQUFZLENBQUMsV0FBVyxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUM7Ozs7c0RBSXJDO0lBRWlDO1FBQWpDLFlBQVksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQzs7OztpREFJaEM7SUFNUTtRQUFSLEtBQUssRUFBRTs7O2dFQUlQO0lBTVE7UUFBUixLQUFLLEVBQUU7OztnRUFJUDtJQU1RO1FBQVIsS0FBSyxFQUFFOzs7OERBSVA7SUFNUTtRQUFSLEtBQUssRUFBRTs7O2tFQUlQO0lBTVE7UUFBUixLQUFLLEVBQUU7OzsyREFFUDtJQU1RO1FBQVIsS0FBSyxFQUFFOzs7b0RBS1A7SUE1SG1CLGVBQWU7UUF5SWhDLG1CQUFBLFFBQVEsRUFBRSxDQUFBO2lEQUFtQixnQkFBZ0I7WUFDekMsaUJBQWlCO1lBQ2QsaUJBQWlCO1lBQ2pCLDBCQUEwQjtZQUNsQixVQUFVO1lBQ0gsYUFBYTtPQTlJbEIsZUFBZSxDQXFxQnBDO0lBQUQsc0JBQUM7Q0FBQSxBQXJxQkQsQ0FBOEMsb0JBQW9CLEdBcXFCakU7U0FycUJxQixlQUFlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSG9zdEJpbmRpbmcsXG4gIEhvc3RMaXN0ZW5lcixcbiAgSW5wdXQsXG4gIE9wdGlvbmFsLFxuICBPdXRwdXQsXG4gIFNpbXBsZUNoYW5nZXMsXG4gIFZpZXdDaGlsZFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENvbnRyb2xDb250YWluZXIsIFZhbGlkYXRvckZuLCBWYWxpZGF0b3JzIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgTHV4Q29uc29sZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9sdXgtdXRpbC9sdXgtY29uc29sZS5zZXJ2aWNlJztcbmltcG9ydCB7IEx1eFV0aWwgfSBmcm9tICcuLi8uLi9sdXgtdXRpbC9sdXgtdXRpbCc7XG5pbXBvcnQgeyBMdXhGb3JtQ29tcG9uZW50QmFzZSB9IGZyb20gJy4vbHV4LWZvcm0tY29tcG9uZW50LWJhc2UuY2xhc3MnO1xuaW1wb3J0IHsgSUx1eEZpbGVFcnJvciwgTHV4RmlsZUVycm9yQ2F1c2UgfSBmcm9tICcuLi9sdXgtZmlsZS9sdXgtZmlsZS1tb2RlbC9sdXgtZmlsZS1lcnJvci5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgSHR0cENsaWVudCwgSHR0cEV2ZW50VHlwZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IElMdXhGaWxlQWN0aW9uQ29uZmlnIH0gZnJvbSAnLi4vbHV4LWZpbGUvbHV4LWZpbGUtbW9kZWwvbHV4LWZpbGUtYWN0aW9uLWNvbmZpZy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgaXNPYnNlcnZhYmxlLCBPYnNlcnZhYmxlLCB0aHJvd0Vycm9yIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBJTHV4RmlsZU9iamVjdCB9IGZyb20gJy4uL2x1eC1maWxlL2x1eC1maWxlLW1vZGVsL2x1eC1maWxlLW9iamVjdC5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgTHV4Q29tcG9uZW50c0NvbmZpZ1NlcnZpY2UgfSBmcm9tICcuLi8uLi9sdXgtY29tcG9uZW50cy1jb25maWcvbHV4LWNvbXBvbmVudHMtY29uZmlnLnNlcnZpY2UnO1xuaW1wb3J0IHsgTGl2ZUFubm91bmNlciB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9hMTF5JztcblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEx1eEZvcm1GaWxlQmFzZSBleHRlbmRzIEx1eEZvcm1Db21wb25lbnRCYXNlIHtcbiAgZGVmYXVsdFJlYWRGaWxlRGVsYXk6IG51bWJlciA9IDEwMDA7XG5cbiAgcHJpdmF0ZSBfbHV4QWNjZXB0OiBzdHJpbmcgPSAnJztcbiAgcHJpdmF0ZSBfbHV4U2VsZWN0ZWRGaWxlczogSUx1eEZpbGVPYmplY3RbXTtcblxuICBwcm90ZWN0ZWQgX2x1eFVwbG9hZEFjdGlvbkNvbmZpZzogSUx1eEZpbGVBY3Rpb25Db25maWcgPSB7XG4gICAgZGlzYWJsZWQ6IGZhbHNlLFxuICAgIGhpZGRlbjogZmFsc2UsXG4gICAgaWNvbk5hbWU6ICdmYXMgZmEtY2xvdWQtdXBsb2FkLWFsdCcsXG4gICAgbGFiZWw6ICdIb2NobGFkZW4nXG4gIH07XG4gIHByb3RlY3RlZCBfbHV4RGVsZXRlQWN0aW9uQ29uZmlnOiBJTHV4RmlsZUFjdGlvbkNvbmZpZyA9IHtcbiAgICBkaXNhYmxlZDogZmFsc2UsXG4gICAgaGlkZGVuOiBmYWxzZSxcbiAgICBpY29uTmFtZTogJ2ZhcyBmYS10cmFzaCcsXG4gICAgbGFiZWw6ICdMw7ZzY2hlbidcbiAgfTtcbiAgcHJvdGVjdGVkIF9sdXhWaWV3QWN0aW9uQ29uZmlnOiBJTHV4RmlsZUFjdGlvbkNvbmZpZyA9IHtcbiAgICBkaXNhYmxlZDogZmFsc2UsXG4gICAgaGlkZGVuOiB0cnVlLFxuICAgIGljb25OYW1lOiAnZmFzIGZhLWV5ZScsXG4gICAgbGFiZWw6ICdBbnNlaGVuJ1xuICB9O1xuICBwcm90ZWN0ZWQgX2x1eERvd25sb2FkQWN0aW9uQ29uZmlnOiBJTHV4RmlsZUFjdGlvbkNvbmZpZyA9IHtcbiAgICBkaXNhYmxlZDogZmFsc2UsXG4gICAgaGlkZGVuOiB0cnVlLFxuICAgIGljb25OYW1lOiAnZmFzIGZhLWRvd25sb2FkJyxcbiAgICBsYWJlbDogJ0Rvd25sb2FkJ1xuICB9O1xuXG4gIHByb2dyZXNzOiBudW1iZXIgPSAtMTtcbiAgZm9yY2VQcm9ncmVzc0luZGV0ZXJtaW5hdGU6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBAVmlld0NoaWxkKCdkb3dubG9hZExpbmsnLCB7IHJlYWQ6IEVsZW1lbnRSZWYsIHN0YXRpYzogdHJ1ZSB9KSBkb3dubG9hZExpbms6IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoJ2ZpbGV1cGxvYWQnLCB7IHJlYWQ6IEVsZW1lbnRSZWYsIHN0YXRpYzogdHJ1ZSB9KSBmaWxldXBsb2FkSW5wdXQ6IEVsZW1lbnRSZWY7XG5cbiAgQE91dHB1dCgpIGx1eFNlbGVjdGVkRmlsZXNDaGFuZ2U6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgQElucHV0KCkgbHV4VXBsb2FkUmVwb3J0UHJvZ3Jlc3M6IGJvb2xlYW4gPSBmYWxzZTtcbiAgQElucHV0KCkgbHV4Q29udGVudHNBc0Jsb2I6IGJvb2xlYW4gPSBmYWxzZTtcbiAgQElucHV0KCkgbHV4VGFnSWQ6IHN0cmluZztcbiAgQElucHV0KCkgbHV4TWF4U2l6ZU1COiBudW1iZXIgPSAxMDtcbiAgQElucHV0KCkgbHV4Q2FwdHVyZTogc3RyaW5nID0gJyc7XG4gIEBJbnB1dCgpIGx1eFVwbG9hZFVybDogc3RyaW5nID0gJyc7XG4gIEBJbnB1dCgpIGx1eERuREFjdGl2ZTogYm9vbGVhbiA9IHRydWU7XG5cbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5sdXgtZmlsZS1oaWdobGlnaHQnKSBpc0RyYWdBY3RpdmU6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBASG9zdExpc3RlbmVyKCdkcmFnb3ZlcicsIFsnJGV2ZW50J10pIG9uRHJhZ092ZXIoJGV2ZW50KSB7XG4gICAgaWYgKHRoaXMuaXNEbkRBbGxvd2VkKCkpIHtcbiAgICAgIHRoaXMuaGFuZGxlRHJhZ092ZXIoJGV2ZW50KTtcbiAgICB9XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdkcmFnbGVhdmUnLCBbJyRldmVudCddKSBvbkRyYWdMZWF2ZSgkZXZlbnQpIHtcbiAgICBpZiAodGhpcy5pc0RuREFsbG93ZWQoKSkge1xuICAgICAgdGhpcy5oYW5kbGVEcmFnTGVhdmUoJGV2ZW50KTtcbiAgICB9XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdkcm9wJywgWyckZXZlbnQnXSkgb25Ecm9wKCRldmVudCkge1xuICAgIGlmICh0aGlzLmlzRG5EQWxsb3dlZCgpKSB7XG4gICAgICB0aGlzLmhhbmRsZURyb3AoJGV2ZW50KTtcbiAgICB9XG4gIH1cblxuICBnZXQgbHV4VXBsb2FkQWN0aW9uQ29uZmlnKCk6IElMdXhGaWxlQWN0aW9uQ29uZmlnIHtcbiAgICByZXR1cm4gdGhpcy5fbHV4VXBsb2FkQWN0aW9uQ29uZmlnO1xuICB9XG5cbiAgQElucHV0KCkgc2V0IGx1eFVwbG9hZEFjdGlvbkNvbmZpZyhjb25maWc6IElMdXhGaWxlQWN0aW9uQ29uZmlnKSB7XG4gICAgaWYgKGNvbmZpZykge1xuICAgICAgdGhpcy5fbHV4VXBsb2FkQWN0aW9uQ29uZmlnID0gY29uZmlnO1xuICAgIH1cbiAgfVxuXG4gIGdldCBsdXhEZWxldGVBY3Rpb25Db25maWcoKTogSUx1eEZpbGVBY3Rpb25Db25maWcge1xuICAgIHJldHVybiB0aGlzLl9sdXhEZWxldGVBY3Rpb25Db25maWc7XG4gIH1cblxuICBASW5wdXQoKSBzZXQgbHV4RGVsZXRlQWN0aW9uQ29uZmlnKGNvbmZpZzogSUx1eEZpbGVBY3Rpb25Db25maWcpIHtcbiAgICBpZiAoY29uZmlnKSB7XG4gICAgICB0aGlzLl9sdXhEZWxldGVBY3Rpb25Db25maWcgPSBjb25maWc7XG4gICAgfVxuICB9XG5cbiAgZ2V0IGx1eFZpZXdBY3Rpb25Db25maWcoKTogSUx1eEZpbGVBY3Rpb25Db25maWcge1xuICAgIHJldHVybiB0aGlzLl9sdXhWaWV3QWN0aW9uQ29uZmlnO1xuICB9XG5cbiAgQElucHV0KCkgc2V0IGx1eFZpZXdBY3Rpb25Db25maWcoY29uZmlnOiBJTHV4RmlsZUFjdGlvbkNvbmZpZykge1xuICAgIGlmIChjb25maWcpIHtcbiAgICAgIHRoaXMuX2x1eFZpZXdBY3Rpb25Db25maWcgPSBjb25maWc7XG4gICAgfVxuICB9XG5cbiAgZ2V0IGx1eERvd25sb2FkQWN0aW9uQ29uZmlnKCk6IElMdXhGaWxlQWN0aW9uQ29uZmlnIHtcbiAgICByZXR1cm4gdGhpcy5fbHV4RG93bmxvYWRBY3Rpb25Db25maWc7XG4gIH1cblxuICBASW5wdXQoKSBzZXQgbHV4RG93bmxvYWRBY3Rpb25Db25maWcoY29uZmlnOiBJTHV4RmlsZUFjdGlvbkNvbmZpZykge1xuICAgIGlmIChjb25maWcpIHtcbiAgICAgIHRoaXMuX2x1eERvd25sb2FkQWN0aW9uQ29uZmlnID0gY29uZmlnO1xuICAgIH1cbiAgfVxuXG4gIGdldCBsdXhTZWxlY3RlZEZpbGVzKCk6IGFueSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0VmFsdWUoKTtcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBsdXhTZWxlY3RlZEZpbGVzKHNlbGVjdGVkRmlsZXM6IGFueSkge1xuICAgIHRoaXMuc2V0VmFsdWUoc2VsZWN0ZWRGaWxlcyk7XG4gIH1cblxuICBnZXQgbHV4QWNjZXB0KCk6IGFueSB7XG4gICAgcmV0dXJuIHRoaXMuX2x1eEFjY2VwdDtcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBsdXhBY2NlcHQoYWNjZXB0czogYW55KSB7XG4gICAgaWYgKCFhY2NlcHRzKSB7XG4gICAgICBhY2NlcHRzID0gJyc7XG4gICAgfVxuICAgIHRoaXMuX2x1eEFjY2VwdCA9IEFycmF5LmlzQXJyYXkoYWNjZXB0cykgPyBhY2NlcHRzLmpvaW4oJywnKSA6IGFjY2VwdHM7XG4gIH1cblxuICBnZXQgcHJvZ3Jlc3NNb2RlKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuICh0aGlzLnByb2dyZXNzID09PSAwICYmICF0aGlzLmx1eFVwbG9hZFJlcG9ydFByb2dyZXNzKSB8fCB0aGlzLmZvcmNlUHJvZ3Jlc3NJbmRldGVybWluYXRlXG4gICAgICA/ICdpbmRldGVybWluYXRlJ1xuICAgICAgOiAnZGV0ZXJtaW5hdGUnO1xuICB9XG5cbiAgZ2V0IGlzUHJvZ3Jlc3NWaXNpYmxlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnByb2dyZXNzID49IDAgfHwgdGhpcy5mb3JjZVByb2dyZXNzSW5kZXRlcm1pbmF0ZTtcbiAgfVxuXG4gIHByb3RlY3RlZCBjb25zdHJ1Y3RvcihcbiAgICBAT3B0aW9uYWwoKSBjb250cm9sQ29udGFpbmVyOiBDb250cm9sQ29udGFpbmVyLFxuICAgIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgbG9nZ2VyOiBMdXhDb25zb2xlU2VydmljZSxcbiAgICBjb25maWc6IEx1eENvbXBvbmVudHNDb25maWdTZXJ2aWNlLFxuICAgIHByb3RlY3RlZCBodHRwOiBIdHRwQ2xpZW50LFxuICAgIHByaXZhdGUgbGl2ZUFubm91bmNlcjogTGl2ZUFubm91bmNlclxuICApIHtcbiAgICBzdXBlcihjb250cm9sQ29udGFpbmVyLCBjZHIsIGxvZ2dlciwgY29uZmlnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBXaXJkIGJlaW0gRm9rdXNzaWVyZW4gZGVzIEVsZW1lbnRzIGF1ZmdlcnVmZW4gdW5kIG1hcmtpZXJ0IGRhcyBGb3JtQ29udHJvbCBhbHMgXCJ0b3VjaGVkXCIuXG4gICAqIEBwYXJhbSAkZXZlbnRcbiAgICovXG4gIG9uRm9jdXNJbigkZXZlbnQpIHtcbiAgICB0aGlzLmZvcm1Db250cm9sLm1hcmtBc1RvdWNoZWQoKTtcbiAgICB0aGlzLmx1eEZvY3VzSW4uZW1pdCgkZXZlbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEVudGZlcm50IGRpZSBha3R1ZWxsIHNlbGVrdGllcnRlbiBEYXRlaWVuIHVuZCBlbnRmZXJudCBldHdhaWdlIChzcGV6aWZpc2NoZSkgRmVobGVyIGF1cyBkZW0gRm9ybUNvbnRyb2wuXG4gICAqIEBwYXJhbSAkZXZlbnRcbiAgICovXG4gIGNsZWFyRmlsZXMoJGV2ZW50Pykge1xuICAgIHRoaXMuZm9ybUNvbnRyb2wubWFya0FzVG91Y2hlZCgpO1xuICAgIHRoaXMuZm9ybUNvbnRyb2wubWFya0FzRGlydHkoKTtcblxuICAgIHRoaXMubHV4U2VsZWN0ZWRGaWxlcyA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLm5vdGlmeUZvcm1WYWx1ZUNoYW5nZWQoKTtcbiAgICB0aGlzLmNsZWFyRm9ybUNvbnRyb2xFcnJvcnMoKTtcbiAgICBpZiAodGhpcy5sdXhEZWxldGVBY3Rpb25Db25maWcub25DbGljaykge1xuICAgICAgdGhpcy5sdXhEZWxldGVBY3Rpb25Db25maWcub25DbGljaygpO1xuICAgIH1cblxuICAgIHRoaXMuYW5ub3VuY2VBbGxGaWxlc1JlbW92ZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEzDtnN0IGRlbiBEb3dubG9hZCBkZXIgw7xiZXJnZWJlbmVuIERhdGVpIGF1cy5cbiAgICogQHBhcmFtIGZpbGVcbiAgICovXG4gIGRvd25sb2FkRmlsZShmaWxlOiBJTHV4RmlsZU9iamVjdCB8IElMdXhGaWxlT2JqZWN0W10pIHtcbiAgICB0aGlzLmZvcm1Db250cm9sLm1hcmtBc1RvdWNoZWQoKTtcbiAgICBmaWxlID0gQXJyYXkuaXNBcnJheShmaWxlKSA/IGZpbGVbMF0gOiBmaWxlO1xuICAgIGNvbnN0IGRvd25sb2FkTGluayA9IDxIVE1MQW5jaG9yRWxlbWVudD50aGlzLmRvd25sb2FkTGluay5uYXRpdmVFbGVtZW50O1xuICAgIGRvd25sb2FkTGluay5kb3dubG9hZCA9IGZpbGUubmFtZTtcblxuICAgIGlmIChmaWxlLmNvbnRlbnQgaW5zdGFuY2VvZiBCbG9iKSB7XG4gICAgICBpZiAod2luZG93Lm5hdmlnYXRvci5tc1NhdmVCbG9iKSB7XG4gICAgICAgIC8vIElFXG4gICAgICAgIHdpbmRvdy5uYXZpZ2F0b3IubXNTYXZlT3JPcGVuQmxvYihmaWxlLmNvbnRlbnQsIGZpbGUubmFtZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChmaWxlLmNvbnRlbnQpO1xuICAgICAgICBkb3dubG9hZExpbmsuaHJlZiA9IHVybDtcbiAgICAgICAgZG93bmxvYWRMaW5rLmNsaWNrKCk7XG4gICAgICAgIHdpbmRvdy5VUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh3aW5kb3cubmF2aWdhdG9yLm1zU2F2ZUJsb2IpIHtcbiAgICAgICAgLy8gSUVcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBhcnJCdWZmZXIgPSBMdXhVdGlsLmJhc2U2NFRvQXJyYXlCdWZmZXIoZmlsZS5jb250ZW50LnNwbGl0KCcsJylbMV0pO1xuICAgICAgICAgIHdpbmRvdy5uYXZpZ2F0b3IubXNTYXZlT3JPcGVuQmxvYihuZXcgQmxvYihbYXJyQnVmZmVyXSwgeyB0eXBlOiBmaWxlLnR5cGUgfSksIGZpbGUubmFtZSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZG93bmxvYWRMaW5rLmhyZWYgPSBmaWxlLmNvbnRlbnQ7XG4gICAgICAgIGRvd25sb2FkTGluay5jbGljaygpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLmx1eERvd25sb2FkQWN0aW9uQ29uZmlnLm9uQ2xpY2spIHtcbiAgICAgIHRoaXMubHV4RG93bmxvYWRBY3Rpb25Db25maWcub25DbGljayhmaWxlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTMO2c3QgZGVuIGJhc2U2NENhbGxiYWNrIGRlciDDvGJlcmdlYmVuZW4gRGF0ZWkgYXVzLlxuICAgKiBTY2hyZWlidCBkYW5uIGFuc2NobGllw59lbmQgZGVuIEJhc2U2NC1TdHJpbmcgaW4gZGllIERhdGVpLlxuICAgKiBAcGFyYW0gZmlsZVxuICAgKi9cbiAgdmlld0ZpbGUoZmlsZTogSUx1eEZpbGVPYmplY3QpIHtcbiAgICB0aGlzLmZvcm1Db250cm9sLm1hcmtBc1RvdWNoZWQoKTtcbiAgICAvLyBXZW5uIGRpZSBEYXRlaSBiZXJlaXRzIGVpbmVuIEJhc2U2NC1XZXJ0IGJlc2l0enQsIGRlbiBvbkNsaWNrLUNhbGxiYWNrIGF1c2bDvGhyZW5cbiAgICBpZiAoZmlsZS5jb250ZW50KSB7XG4gICAgICB0aGlzLnRyaWdnZXJWaWV3RmlsZUNsaWNrKGZpbGUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBjYWxsYmFja1Jlc3VsdCA9IGZpbGUuY29udGVudENhbGxiYWNrKCk7XG4gICAgLy8gV2VubiBkZXIgQ2FsbGJhY2sgZWluIE9ic2VydmFibGUgaXN0LCBkaWVzZXMgYXVmbMO2c2VuIHVuZCBkZW0gRmlsZS1CYXNlNjQgenV3ZWlzZW5cbiAgICBpZiAoaXNPYnNlcnZhYmxlKGNhbGxiYWNrUmVzdWx0KSkge1xuICAgICAgKDxPYnNlcnZhYmxlPHN0cmluZz4+Y2FsbGJhY2tSZXN1bHQpLnN1YnNjcmliZSgoY29udGVudDogYW55KSA9PiB7XG4gICAgICAgIGZpbGUuY29udGVudCA9IGNvbnRlbnQ7XG4gICAgICAgIHRoaXMudHJpZ2dlclZpZXdGaWxlQ2xpY2soZmlsZSk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gV2VubiBkZXIgQ2FsbGJhY2sgZWluIG5vcm1hbGVyIFN0cmluZyBvZGVyIFByb21pc2UgaXN0LCBkaWVzZW4gYXVmbMO2c2VuIHVuZCBkZW4gRmlsZS1CYXNlNjQgYWt0dWFsaXNpZXJlblxuICAgICAgUHJvbWlzZS5yZXNvbHZlKDxhbnk+Y2FsbGJhY2tSZXN1bHQpLnRoZW4oKGNvbnRlbnQ6IGFueSkgPT4ge1xuICAgICAgICBmaWxlLmNvbnRlbnQgPSBjb250ZW50O1xuICAgICAgICB0aGlzLnRyaWdnZXJWaWV3RmlsZUNsaWNrKGZpbGUpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFdhbmRlbHQgRmlsZS1PYmpla3QgenUgTHV4RmlsZU9iamVjdHMgdW0gdW5kIHZlcnN1Y2h0IGRpZXNlIEhvY2h6dWxhZGVuLlxuICAgKiBHaWJ0IGVpbiBQcm9taXNlIG1pdCBkZW4gbmV1ZW4gRmlsZU9iamVjdHMgenVyw7xjayBiencuIGVpbmVuIEZlaGxlciBhdXMgZGVuIGludGVybmVuIFByb21pc2VzLlxuICAgKiBAcGFyYW0gZmlsZXNcbiAgICovXG4gIGFzeW5jIHVwZGF0ZVNlbGVjdGVkRmlsZXMoZmlsZXM6IEZpbGVMaXN0IHwgRmlsZVtdKSB7XG4gICAgdHJ5IHtcbiAgICAgIGxldCBuZXdGaWxlcyA9IFtdO1xuICAgICAgYXdhaXQgdGhpcy5tYXBGaWxlc1RvRmlsZU9iamVjdHMoZmlsZXMpLnRoZW4oKGZpbGVPYmplY3RzOiBJTHV4RmlsZU9iamVjdFtdKSA9PiAobmV3RmlsZXMgPSBmaWxlT2JqZWN0cykpO1xuICAgICAgYXdhaXQgdGhpcy51cGxvYWRGaWxlcyhuZXdGaWxlcyk7XG4gICAgICBpZiAodGhpcy5sdXhVcGxvYWRBY3Rpb25Db25maWcub25DbGljaykge1xuICAgICAgICB0aGlzLmx1eFVwbG9hZEFjdGlvbkNvbmZpZy5vbkNsaWNrKG5ld0ZpbGVzICYmIG5ld0ZpbGVzLmxlbmd0aCA9PT0gMSA/IG5ld0ZpbGVzWzBdIDogbmV3RmlsZXMpO1xuICAgICAgfVxuICAgICAgdGhpcy5mb3JtQ29udHJvbC5tYXJrQXNUb3VjaGVkKCk7XG4gICAgICB0aGlzLmZvcm1Db250cm9sLm1hcmtBc0RpcnR5KCk7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG5ld0ZpbGVzKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU3TDtsOfdCBkYXMgSG9jaGxhZGVuIGRlciBEYXRlaWVuIHp1IGVpbmVyIGJlc3RpbW10ZW4gVVJMIGFuLlxuICAgKi9cbiAgYXN5bmMgdXBsb2FkRmlsZXMoZmlsZXM6IElMdXhGaWxlT2JqZWN0W10gfCBJTHV4RmlsZU9iamVjdCkge1xuICAgIGlmICghdGhpcy5sdXhVcGxvYWRVcmwpIHtcbiAgICAgIHRoaXMuZm9yY2VQcm9ncmVzc0luZGV0ZXJtaW5hdGUgPSBmYWxzZTtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5sdXhVcGxvYWRSZXBvcnRQcm9ncmVzcykge1xuICAgICAgdGhpcy5mb3JjZVByb2dyZXNzSW5kZXRlcm1pbmF0ZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIHRoaXMucHJvZ3Jlc3MgPSAwO1xuICAgIC8vIEFuc29uc3RlbiBkaWUgRGF0ZWllbiBpbiBlaW5lbSBGb3JtRGF0YS1PYmpla3Qgc2FtbWVsbiB1bmQgw7xiZXIgZGVuIGh0dHBDbGllbnQgaG9jaGxhZGVuXG4gICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICBsZXQgc2VsZWN0ZWRGaWxlcyA9IFtdO1xuICAgIGlmICghZmlsZXMpIHtcbiAgICAgIHNlbGVjdGVkRmlsZXMgPSBbXTtcbiAgICB9IGVsc2UgaWYgKCFBcnJheS5pc0FycmF5KGZpbGVzKSkge1xuICAgICAgc2VsZWN0ZWRGaWxlcy5wdXNoKGZpbGVzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2VsZWN0ZWRGaWxlcy5wdXNoKC4uLmZpbGVzKTtcbiAgICB9XG4gICAgc2VsZWN0ZWRGaWxlcy5mb3JFYWNoKChmaWxlT2JqZWN0OiBJTHV4RmlsZU9iamVjdCkgPT4ge1xuICAgICAgZm9ybURhdGEuYXBwZW5kKGZpbGVPYmplY3QubmFtZSwgZmlsZU9iamVjdC5jb250ZW50KTtcbiAgICB9KTtcblxuICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGNvbnN0IG9wdGlvbnMgPSB7fTtcbiAgICAgIGlmICh0aGlzLmx1eFVwbG9hZFJlcG9ydFByb2dyZXNzKSB7XG4gICAgICAgIG9wdGlvbnNbJ3JlcG9ydFByb2dyZXNzJ10gPSB0cnVlO1xuICAgICAgICBvcHRpb25zWydvYnNlcnZlJ10gPSAnZXZlbnRzJztcbiAgICAgIH1cbiAgICAgIG9wdGlvbnNbJ3Jlc3BvbnNlVHlwZSddID0gJ2Jsb2InO1xuXG4gICAgICB0aGlzLmh0dHAucG9zdCh0aGlzLmx1eFVwbG9hZFVybCwgZm9ybURhdGEsIG9wdGlvbnMpLnN1YnNjcmliZShcbiAgICAgICAgKGV2ZW50OiBhbnkpID0+IHtcbiAgICAgICAgICAvLyB3ZW5uIHdpciBlaW5lIGRldGVybWluaWVydGUgRm9ydHNjaHJpdHRzYW56ZWlnZSBoYWJlbiwgZGFubiBtdXNzIGRlciBGb3J0c2Nocml0dCBhdWNoIGtvcnJla3QgYWJnZWZhbmdlbiB3ZXJkZW5cbiAgICAgICAgICBpZiAodGhpcy5sdXhVcGxvYWRSZXBvcnRQcm9ncmVzcykge1xuICAgICAgICAgICAgaWYgKGV2ZW50LnR5cGUgPT09IEh0dHBFdmVudFR5cGUuVXBsb2FkUHJvZ3Jlc3MpIHtcbiAgICAgICAgICAgICAgdGhpcy5wcm9ncmVzcyA9IE1hdGgucm91bmQoKGV2ZW50LmxvYWRlZCAvIGV2ZW50LnRvdGFsKSAqIDEwMCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IEh0dHBFdmVudFR5cGUuUmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgLy8gSGllciBnZWJlbiB3aXIgZGVuIHNwZXppZWxsZW4gRmVobGVyIG5vY2ggbWFsIGluIGRpZSBjb25zb2xlXG4gICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgLy8gRsO8ciBkZW4gRmFsbCBkYXMgZGVyIFVwbG9hZCBmZWhsc2NobMOkZ3QsIG1lbGRlbiB3aXIgZWluZW4gRmVobGVyIGFtIENvbXBvbmVudFxuICAgICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICAgICAgcmV0dXJuIHRocm93RXJyb3IoZXJyb3IpO1xuICAgICAgICB9XG4gICAgICApO1xuICAgIH0pLnRoZW4oXG4gICAgICAoKSA9PiB7XG4gICAgICAgIHRoaXMucHJvZ3Jlc3MgPSAtMTtcbiAgICAgICAgdGhpcy5mb3JjZVByb2dyZXNzSW5kZXRlcm1pbmF0ZSA9IGZhbHNlO1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICB9LFxuICAgICAgZXJyb3IgPT4ge1xuICAgICAgICB0aGlzLnByb2dyZXNzID0gLTE7XG4gICAgICAgIHRoaXMuZm9yY2VQcm9ncmVzc0luZGV0ZXJtaW5hdGUgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KHtcbiAgICAgICAgICBjYXVzZTogTHV4RmlsZUVycm9yQ2F1c2UuVXBsb2FkRmlsZUVycm9yLFxuICAgICAgICAgIGV4Y2VwdGlvbjogZXJyb3IsXG4gICAgICAgICAgZmlsZTogZmlsZXNcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMaWVzdCBkaWUgw7xiZXJnZWJlbmVuIERhdGVpZW4gYXVzIHVuZCBlcnpldWd0IGRhcmF1cyBlaW4gUHJvbWlzZSwgd2VsY2hlcyBhYmdlZnJhZ3Qgd2VyZGVuIGthbm4uXG4gICAqIEbDpG5ndCBwb3RlbnRpZWxsZSBGZWhsZXIgYWIgdW5kIGdpYnQgZGllc2UgYWxzIGFiZ2VsZWhudGUgUHJvbWlzZXMgenVyw7xjay5cbiAgICogQHBhcmFtIGZpbGVzXG4gICAqL1xuICBhc3luYyBtYXBGaWxlc1RvRmlsZU9iamVjdHMoZmlsZXM6IEZpbGVMaXN0IHwgRmlsZVtdKSB7XG4gICAgdGhpcy5fbHV4U2VsZWN0ZWRGaWxlcyA9IFtdO1xuICAgIGNvbnN0IGZpbGVzQXJyYXk6IEZpbGVbXSA9IEFycmF5LmZyb20oZmlsZXMpO1xuICAgIGNvbnN0IG5ld0ZpbGVzOiBJTHV4RmlsZU9iamVjdFtdID0gW107XG4gICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzQXJyYXkpIHtcbiAgICAgIGlmICghZmlsZSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgLy8gUHLDvGZlbiBvYiBEYXRlaWdyw7bDn2Ugw7xiZXJzY2hyaXR0ZW4gd29yZGVuIGlzdFxuICAgICAgaWYgKHRoaXMuZ2V0RmlsZVNpemVJbk1CKGZpbGUpID4gdGhpcy5sdXhNYXhTaXplTUIpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KHtcbiAgICAgICAgICBjYXVzZTogTHV4RmlsZUVycm9yQ2F1c2UuTWF4U2l6ZUVycm9yLFxuICAgICAgICAgIGV4Y2VwdGlvbjogdGhpcy5nZXRNYXhTaXplRXJyb3JNZXNzYWdlKGZpbGUpLFxuICAgICAgICAgIGZpbGU6IGZpbGVcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFByw7xmZW4gb2IgZGVyIERhdGVpdHlwIFwiYWNjZXB0ZWRcIiBpc3RcbiAgICAgIGNvbnN0IHNwbGl0QWNjZXB0ZWQgPSB0aGlzLmx1eEFjY2VwdCA/IHRoaXMubHV4QWNjZXB0LnNwbGl0KCcsJykgOiBbXTtcbiAgICAgIGNvbnN0IHNwbGl0RmlsZUVuZGluZyA9IGZpbGUubmFtZS5zcGxpdCgnLicpO1xuICAgICAgY29uc3QgZmlsZUVuZGluZyA9IGAuJHtzcGxpdEZpbGVFbmRpbmdbc3BsaXRGaWxlRW5kaW5nLmxlbmd0aCAtIDFdfWA7XG4gICAgICBsZXQgaXNBY2NlcHRlZDogYm9vbGVhbiA9IHNwbGl0QWNjZXB0ZWQubGVuZ3RoID09PSAwID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgc3BsaXRBY2NlcHRlZC5mb3JFYWNoKChhY2NlcHRlZDogc3RyaW5nKSA9PiB7XG4gICAgICAgIGlmIChhY2NlcHRlZCkge1xuICAgICAgICAgIGFjY2VwdGVkID0gYWNjZXB0ZWQudG9Mb2NhbGVMb3dlckNhc2UoKTtcblxuICAgICAgICAgIGlmIChhY2NlcHRlZCA9PT0gJy50eHQnKSB7XG4gICAgICAgICAgICBhY2NlcHRlZCA9ICd0ZXh0L3BsYWluJztcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWlzQWNjZXB0ZWQpIHtcbiAgICAgICAgICAvLyBGw7xyIHNwZXppZWxsZSBXaWxkY2FyZHMgbnV0emVuIHdpciBkaWVzZSBVbXdhbmRsdW5nXG4gICAgICAgICAgc3dpdGNoIChhY2NlcHRlZCkge1xuICAgICAgICAgICAgY2FzZSAnaW1hZ2UvKic6XG4gICAgICAgICAgICAgIGFjY2VwdGVkID0gJ2ltYWdlJztcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd2aWRlby8qJzpcbiAgICAgICAgICAgICAgYWNjZXB0ZWQgPSAndmlkZW8nO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2F1ZGlvLyonOlxuICAgICAgICAgICAgICBhY2NlcHRlZCA9ICdhdWRpbyc7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChhY2NlcHRlZCA9PT0gZmlsZUVuZGluZy50b0xvY2FsZUxvd2VyQ2FzZSgpIHx8IGZpbGUudHlwZS50b0xvY2FsZUxvd2VyQ2FzZSgpLmluZGV4T2YoYWNjZXB0ZWQpID4gLTEpIHtcbiAgICAgICAgICAgIGlzQWNjZXB0ZWQgPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGlmICghaXNBY2NlcHRlZCkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3Qoe1xuICAgICAgICAgIGNhdXNlOiBMdXhGaWxlRXJyb3JDYXVzZS5GaWxlTm90QWNjZXB0ZWQsXG4gICAgICAgICAgZXhjZXB0aW9uOiB0aGlzLmdldEZpbGVOb3RBY2NlcHRlZE1lc3NhZ2UoZmlsZSksXG4gICAgICAgICAgZmlsZTogZmlsZVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMubHV4Q29udGVudHNBc0Jsb2IpIHtcbiAgICAgICAgLy8gV2VubiBkaXJla3QgZGllIEJsb2JzIGdlbnV0enQgd2VyZGVuIHNvbGxlbiwgZWluZmFjaCBkaWUgRGF0ZWkgYWxzIGNvbnRlbnQgbWVya2VuXG4gICAgICAgIG5ld0ZpbGVzLnB1c2goeyBuYW1lOiBmaWxlLm5hbWUsIGNvbnRlbnQ6IDxCbG9iPmZpbGUsIHR5cGU6IGZpbGUudHlwZSB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIERhcyBBdXNsZXNlbiBkZXIgRGF0ZWkgYW5zdG/Dn2VuLCB3ZW5uIGVyZm9sZ3JlaWNoLCB3aXJkIGRpZSBEYXRlaSB6dSBzZWxlY3RlZEZpbGVzIGhpbnp1Z2Vmw7xndC5cbiAgICAgICAgLy8gQmVpIGVpbmVtIEZlaGxlciB3aXJkIGRhcyBQcm9taXNlIHJlamVjdGVkIHVuZCBnaWJ0IGVpbmVuIEZlaGxlciB6dXLDvGNrLlxuICAgICAgICBhd2FpdCB0aGlzLnJlYWRGaWxlKGZpbGUpXG4gICAgICAgICAgLnRoZW4oKGNvbnRlbnQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgbmV3RmlsZXMucHVzaCh7IG5hbWU6IGZpbGUubmFtZSwgY29udGVudDogY29udGVudCwgdHlwZTogZmlsZS50eXBlIH0pO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCh7XG4gICAgICAgICAgICAgIGNhdXNlOiBMdXhGaWxlRXJyb3JDYXVzZS5SZWFkaW5nRmlsZUVycm9yLFxuICAgICAgICAgICAgICBleGNlcHRpb246IGVycm9yLFxuICAgICAgICAgICAgICBmaWxlOiBmaWxlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBEYXMgQXJyYXkgbWl0IGRlbiBuZXVlbiBEYXRlaWVuIHp1csO8Y2tnZWJlblxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobmV3RmlsZXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIExpZXN0IChhc3luY2hyb24pIGRlbiBCYXNlNjQtU3RyaW5nIGF1cyBkZXIgw7xiZXJnZWJlbmVuIERhdGVpIGhlcmF1cyBiencuIGdpYnQgZGVuIEZlaGxlciB6dXLDvGNrLCB3ZW5uIGVpbmVyXG4gICAqIGF1ZmdldHJldGVuIGlzdC5cbiAgICogQHBhcmFtIGZpbGVcbiAgICovXG4gIHJlYWRGaWxlKGZpbGU6IEZpbGUpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgY29uc3QgcmVhZGVyID0gbmV3IHdpbmRvd1snRmlsZVJlYWRlciddKCk7XG5cbiAgICAgIHJlYWRlci5vbmxvYWQgPSBmaWxlRGF0YSA9PiByZXNvbHZlKGZpbGVEYXRhLnRhcmdldC5yZXN1bHQpO1xuICAgICAgcmVhZGVyLm9uZXJyb3IgPSBlcnJvciA9PiByZWplY3QoZXJyb3IpO1xuICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogV2lyZCBiZWltIERyYWctT3ZlciDDvGJlciBkZW0gTHV4Rm9ybUNvbnRyb2wgYXVmZ2VydWZlbi5cbiAgICogQHBhcmFtICRldmVudFxuICAgKi9cbiAgaGFuZGxlRHJhZ092ZXIoJGV2ZW50KSB7XG4gICAgdGhpcy5pc0RyYWdBY3RpdmUgPSB0cnVlO1xuICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAkZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgIC8vIERlciBEcm9wIEVmZmVjdCB3aXJkIG51ciBnZXNldHp0LCB3ZW5uIGRpZSBQcm9wZXJ0eSBhdWNoXG4gICAgLy8gdm9yaGFuZGVuIGlzdC4gSW4gZGVuIFRlc3RzIGdpYnQgZXMga2VpbmVuIERyb3AgRWZmZWN0LlxuICAgIGlmICgkZXZlbnQuZGF0YVRyYW5zZmVyICYmICRldmVudC5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdCkge1xuICAgICAgJGV2ZW50LmRhdGFUcmFuc2Zlci5kcm9wRWZmZWN0ID0gJ2NvcHknO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBXaXJkIGJlaW0gRHJhZy1MZWF2ZSDDvGJlciBkZW0gTHV4Rm9ybUNvbnRyb2wgYXVmZ2VydWZlbi5cbiAgICogQHBhcmFtICRldmVudFxuICAgKi9cbiAgaGFuZGxlRHJhZ0xlYXZlKCRldmVudCkge1xuICAgIGlmICgkZXZlbnQudGFyZ2V0Lm5vZGVOYW1lLnRvTG9jYWxlTG93ZXJDYXNlKCkgPT09ICdsdXgtZmlsZS1pbnB1dCcpIHtcbiAgICAgIHRoaXMuaXNEcmFnQWN0aXZlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFdpcmQgYmVpbSBEcm9wIGVpbmVzL21laHJlcmVyIGdlem9nZW5lciBFbGVtZW50ZSDDvGJlciBkZW0gTHV4Rm9ybUNvbnRyb2wgYXVmZ2VydWZlbiB1bmQgbMO2c3RcbiAgICogZGllIEF1c3fDpGhsLU1ldGhvZGVuIGbDvHIgZGllIGVudHNwcmVjaGVuZGVuIERhdGVpZW4gYXVzLlxuICAgKi9cbiAgaGFuZGxlRHJvcCgkZXZlbnQpIHtcbiAgICB0aGlzLmZvcmNlUHJvZ3Jlc3NJbmRldGVybWluYXRlID0gdHJ1ZTtcbiAgICB0aGlzLmlzRHJhZ0FjdGl2ZSA9IGZhbHNlO1xuICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAkZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgIGlmICgkZXZlbnQuZGF0YVRyYW5zZmVyKSB7XG4gICAgICB0aGlzLnNlbGVjdEZpbGVzKCRldmVudC5kYXRhVHJhbnNmZXIuZmlsZXMpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBGdW5rdGlvbiwgZGllIGRhcyBBdXN3w6RobGVuIHZvbiBEYXRlaWVuIGhhbmRlbG4gc29sbC5cbiAgICogRGllIGVyYmVuZGVuIEtsYXNzZW4gaW1wbGVtZW50aWVyZW4gZGllc2UgRnVua3Rpb24gYXVzLlxuICAgKi9cbiAgYWJzdHJhY3Qgc2VsZWN0RmlsZXMoZmlsZXM6IEZpbGVMaXN0IHwgRmlsZVtdKTtcblxuICAvKipcbiAgICogUHLDvGZ0IG9iIGRlciBCYXNlNjQtU3RyaW5nIGbDvHIgZGllIERhdGVpIGdlc2V0enQgaXN0IHVuZCBvYiBlaW4gb25DbGljay1BdWZydWYgZsO8ciBkaWUgVmlldy1BY3Rpb24gdm9yaGFuZGVuIGlzdC5cbiAgICogV2VubiBqYSwgd2lyZCBkaWVzZXIgYXVzZ2Vmw7xocnQuXG4gICAqIEBwYXJhbSBmaWxlXG4gICAqL1xuICBwcm90ZWN0ZWQgdHJpZ2dlclZpZXdGaWxlQ2xpY2soZmlsZTogSUx1eEZpbGVPYmplY3QpIHtcbiAgICBpZiAoZmlsZS5jb250ZW50ICYmIHRoaXMubHV4Vmlld0FjdGlvbkNvbmZpZy5vbkNsaWNrKSB7XG4gICAgICB0aGlzLmx1eFZpZXdBY3Rpb25Db25maWcub25DbGljayhmaWxlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRW50ZmVybnQgZGllIGluIGRpZXNlciBDb21wb25lbnQgZ2VzZXR6dGVuIEZlaGxlcm1lbGR1bmdlbi5cbiAgICovXG4gIHByb3RlY3RlZCBjbGVhckZvcm1Db250cm9sRXJyb3JzKCkge1xuICAgIC8vIERhcyBha3R1ZWxsZSBGZWhsZXJvYmpla3QgYXVzbGVzZW5cbiAgICBsZXQgZXJyb3JzID0gdGhpcy5mb3JtQ29udHJvbC5lcnJvcnM7XG4gICAgaWYgKGVycm9ycykge1xuICAgICAgLy8gRGllIGNvbXBvbmVudHNwZXppZmlzY2hlbiBGZWhsZXIgYXVzIGRlbSBPYmpla3QgZW50ZmVybmVuXG4gICAgICBmb3IgKGNvbnN0IGNhdXNlIG9mIE9iamVjdC5rZXlzKEx1eEZpbGVFcnJvckNhdXNlKSkge1xuICAgICAgICBkZWxldGUgZXJyb3JzW0x1eEZpbGVFcnJvckNhdXNlW2NhdXNlXV07XG4gICAgICB9XG4gICAgICAvLyBGYWxscyBlcnJvcnMgZWluIGxlZXJlcyBPYmpla3QgaXN0LCBuZWhtZW4gd2lyIHN0YXR0ZGVzc2VuIG51bGxcbiAgICAgIGVycm9ycyA9IE9iamVjdC5rZXlzKGVycm9ycykubGVuZ3RoID09PSAwID8gbnVsbCA6IGVycm9ycztcbiAgICAgIC8vIERhcyBuZXVlIEZlaGxlcm9iamVrdCBpbiBkYXMgRm9ybUNvbnRyb2wgc2NocmVpYmVuXG4gICAgICB0aGlzLmZvcm1Db250cm9sLnNldEVycm9ycyhlcnJvcnMpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBa3R1YWxpc2llcnQgZGFzIEZlaGxlcm9iamVrdCBhbSBGb3JtQ29udHJvbCwgZGFtaXQgZWluZSBlbnRzcHJlY2hlbmRlIEZlaGxlcm1lbGR1bmcgYW5nZXplaWd0IHdlcmRlbiBrYW5uLlxuICAgKiBMZWVydCBkaWUgQW56ZWlnZSB1bmQgZ2lidCBFdmVudHMgbWl0IGxlZXJlbSBBcnJheSBhdXMuXG4gICAqIEBwYXJhbSBlcnJvclxuICAgKi9cbiAgcHJvdGVjdGVkIHNldEZvcm1Db250cm9sRXJyb3JzKGVycm9yOiBJTHV4RmlsZUVycm9yKSB7XG4gICAgdGhpcy5mb3JjZVByb2dyZXNzSW5kZXRlcm1pbmF0ZSA9IGZhbHNlO1xuICAgIC8vIFZvcmhlcmlnZSBkZWZpbmllcnRlIEZlaGxlciBlbnRmZXJuZW5cbiAgICB0aGlzLmNsZWFyRm9ybUNvbnRyb2xFcnJvcnMoKTtcbiAgICAvLyBIaWVyIGFrdHVhbGlzaWVyZW4gd2lyIGRhcyBGZWhsZXJvYmpla3QgYW4gZGVtIHp1Z3J1bmRlIGxpZWdlbmRlbiBGb3JtQ29udHJvbCBkaWVzZXIgQ29tcG9uZW50XG4gICAgY29uc3QgZXJyb3JzID0gdGhpcy5mb3JtQ29udHJvbC5lcnJvcnMgPyB0aGlzLmZvcm1Db250cm9sLmVycm9ycyA6IHt9O1xuICAgIGVycm9yc1tlcnJvci5jYXVzZV0gPSB7IGZpbGU6IGVycm9yLmZpbGUgfTtcbiAgICB0aGlzLmZvcm1Db250cm9sLnNldEVycm9ycyhlcnJvcnMpO1xuICB9XG5cbiAgLyoqXG4gICAqIEJlcmVjaG5ldCBkaWUgR3LDtsOfZSBkZXIgw7xiZXJnZWJlbmVuIERhdGVpIGluIE1CLlxuICAgKiBAcGFyYW0gZmlsZVxuICAgKi9cbiAgcHJvdGVjdGVkIGdldEZpbGVTaXplSW5NQihmaWxlOiBGaWxlKSB7XG4gICAgcmV0dXJuIGZpbGUuc2l6ZSAvIDEwMDAwMDA7XG4gIH1cblxuICAvKipcbiAgICogR2lidCBkaWUgTWVzc2FnZSBmw7xyIMOcYmVyc2NocmVpdHVuZyBkZXIgbWF4aW1hbGVuIERhdGVpZ3LDtsOfZSB6dXLDvGNrLlxuICAgKiBAcGFyYW0gZmlsZVxuICAgKi9cbiAgcHJvdGVjdGVkIGdldE1heFNpemVFcnJvck1lc3NhZ2UoZmlsZTogRmlsZSk6IHN0cmluZyB7XG4gICAgcmV0dXJuIChcbiAgICAgIGBEaWUgRGF0ZWkgXCIke2ZpbGUubmFtZX1cIiDDvGJlcnNjaHJlaXRldCBtaXQgJHsrdGhpcy5nZXRGaWxlU2l6ZUluTUIoZmlsZSkudG9GaXhlZCgyKX1NQiBgICtcbiAgICAgIGBkaWUgZXJsYXVidGUgRGF0ZWlncsO2w59lIHZvbiAkeyt0aGlzLmx1eE1heFNpemVNQi50b0ZpeGVkKDIpfU1CYFxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2lidCBkaWUgTWVzc2FnZSBmw7xyIEZlaGxlciBiZWltIEF1c2xlc2VuIGVpbmVyIERhdGVpIHp1csO8Y2suXG4gICAqIEBwYXJhbSBmaWxlXG4gICAqL1xuICBwcm90ZWN0ZWQgZ2V0UmVhZGluZ0ZpbGVFcnJvck1lc3NhZ2UoZmlsZTogRmlsZSk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBCZWltIExlc2VuIGRlciBEYXRlaSBcIiR7ZmlsZS5uYW1lfVwiIGlzdCBlaW4gRmVobGVyIGF1ZmdldHJldGVuYDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHaWJ0IGRpZSBNZXNzYWdlIGbDvHIgRmVobGVyIGJlaW0gVXBsb2FkIGVpbmVyIERhdGVpIHp1csO8Y2suXG4gICAqIEBwYXJhbSBmaWxlc1xuICAgKi9cbiAgcHJvdGVjdGVkIGdldFVwbG9hZEZpbGVFcnJvck1lc3NhZ2UoZmlsZXM6IEZpbGVbXSk6IHN0cmluZyB7XG4gICAgaWYgKCFmaWxlcykge1xuICAgICAgcmV0dXJuICdEYXMgSG9jaGxhZGVuIGlzdCBmZWhsZ2VzY2hsYWdlbic7XG4gICAgfVxuICAgIHJldHVybiBgRGFzIEhvY2hsYWRlbiBkZXIgJHtmaWxlcy5sZW5ndGggPiAxID8gJ2F1c2dld8OkaGx0ZW4gRGF0ZWllbicgOiAnYXVzZ2V3w6RobHRlbiBEYXRlaSd9IGlzdCBmZWhsZ2VzY2hsYWdlbmA7XG4gIH1cblxuICAvKipcbiAgICogR2lidCBkaWUgTWVzc2FnZSBmw7xyIGZhbHNjaGUgRGF0ZWl0eXBlbiB6dXLDvGNrLlxuICAgKiBAcGFyYW0gZmlsZVxuICAgKi9cbiAgcHJvdGVjdGVkIGdldEZpbGVOb3RBY2NlcHRlZE1lc3NhZ2UoZmlsZTogRmlsZSk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBEaWUgRGF0ZWkgXCIke2ZpbGUubmFtZX1cIiBoYXQgZWluZW4gbmljaHQgYWt6ZXB0aWVydGVuIERhdGVpdHlwYDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHaWJ0IGRpZSBNZXNzYWdlIGbDvHIgZmFsc2NoZSBEYXRlaXR5cGVuIHp1csO8Y2suXG4gICAqIEBwYXJhbSBmaWxlXG4gICAqL1xuICBwcm90ZWN0ZWQgZ2V0TXVsdGlwbGVGb3JiaWRkZW5NZXNzYWdlKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBFcyBkYXJmIG51ciBlaW5lIERhdGVpIGF1c2dld8OkaGx0IHdlcmRlbmA7XG4gIH1cblxuICAvKipcbiAgICogTWVsZGV0IGRlbSBTY3JlZW5SZWFkZXIsIGRhc3MgZ2VyYWRlIGVpbmUvbWVocmVyZSBEYXRlaWVuIGJlYXJiZWl0ZXQgd2VyZGVuIChMYWRlYW56ZWlnZSkuXG4gICAqIEBwYXJhbSBtdWx0aXBsZVxuICAgKi9cbiAgcHJvdGVjdGVkIGFubm91bmNlRmlsZVByb2Nlc3MobXVsdGlwbGU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmxpdmVBbm5vdW5jZXIuYW5ub3VuY2UoXG4gICAgICBgQml0dGUgd2FydGVuLiBEaWUgJHttdWx0aXBsZSA/ICdEYXRlaWVuIHdlcmRlbicgOiAnRGF0ZWkgd2lyZCd9IHZlcmFyYmVpdGV0LmAsXG4gICAgICAnYXNzZXJ0aXZlJ1xuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogTWVsZGV0IGRlbSBTY3JlZW5SZWFkZXIsIGRhc3MgYWxsZSBEYXRlaWVuIGVudGZlcm50IHdlcmRlbiBzb2xsZW4uXG4gICAqL1xuICBwcm90ZWN0ZWQgYW5ub3VuY2VBbGxGaWxlc1JlbW92ZSgpIHtcbiAgICB0aGlzLmxpdmVBbm5vdW5jZXIuYW5ub3VuY2UoYEFsbGUgRGF0ZWllbiB3ZXJkZW4gZW50ZmVybnQuYCwgJ2Fzc2VydGl2ZScpO1xuICB9XG5cbiAgLyoqXG4gICAqIE1lbGRldCBkZW0gU2NyZWVuUmVhZGVyLCBkYXNzIGVpbmUgYmVzdGltbXRlIERhdGVpIGVudGZlcm50IHdlcmRlbiBzb2xsLlxuICAgKiBAcGFyYW0gZmlsZU5hbWVcbiAgICovXG4gIHByb3RlY3RlZCBhbm5vdW5jZUZpbGVSZW1vdmUoZmlsZU5hbWU6IHN0cmluZykge1xuICAgIHRoaXMubGl2ZUFubm91bmNlci5hbm5vdW5jZShgRGllIERhdGVpICR7ZmlsZU5hbWV9IHdpcmQgZW50ZmVybnQuYCwgJ2Fzc2VydGl2ZScpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdpYnQgd2llZGVyLCBvYiBEcmFnLWFuZC1Ecm9wIGdlcmFkZSBha3RpdiB1bmQgbcO2Z2xpY2ggaXN0LlxuICAgKi9cbiAgcHJpdmF0ZSBpc0RuREFsbG93ZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMubHV4RG5EQWN0aXZlICYmICF0aGlzLmx1eERpc2FibGVkICYmICF0aGlzLmx1eFJlYWRvbmx5O1xuICB9XG5cbiAgLy8gcmVnaW9uIE92ZXJyaWRkZW4gbWV0aG9kc1xuXG4gIHByb3RlY3RlZCBlcnJvck1lc3NhZ2VNb2RpZmllcih2YWx1ZTogYW55LCBlcnJvcnM6IGFueSkge1xuICAgIGlmIChlcnJvcnNbTHV4RmlsZUVycm9yQ2F1c2UuTWF4U2l6ZUVycm9yXSkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0TWF4U2l6ZUVycm9yTWVzc2FnZShlcnJvcnNbTHV4RmlsZUVycm9yQ2F1c2UuTWF4U2l6ZUVycm9yXS5maWxlKTtcbiAgICB9IGVsc2UgaWYgKGVycm9yc1tMdXhGaWxlRXJyb3JDYXVzZS5SZWFkaW5nRmlsZUVycm9yXSkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0UmVhZGluZ0ZpbGVFcnJvck1lc3NhZ2UoZXJyb3JzW0x1eEZpbGVFcnJvckNhdXNlLlJlYWRpbmdGaWxlRXJyb3JdLmZpbGUpO1xuICAgIH0gZWxzZSBpZiAoZXJyb3JzW0x1eEZpbGVFcnJvckNhdXNlLlVwbG9hZEZpbGVFcnJvcl0pIHtcbiAgICAgIHJldHVybiB0aGlzLmdldFVwbG9hZEZpbGVFcnJvck1lc3NhZ2UoZXJyb3JzW0x1eEZpbGVFcnJvckNhdXNlLlVwbG9hZEZpbGVFcnJvcl0uZmlsZSk7XG4gICAgfSBlbHNlIGlmIChlcnJvcnNbTHV4RmlsZUVycm9yQ2F1c2UuRmlsZU5vdEFjY2VwdGVkXSkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0RmlsZU5vdEFjY2VwdGVkTWVzc2FnZShlcnJvcnNbTHV4RmlsZUVycm9yQ2F1c2UuRmlsZU5vdEFjY2VwdGVkXS5maWxlKTtcbiAgICB9IGVsc2UgaWYgKGVycm9yc1tMdXhGaWxlRXJyb3JDYXVzZS5NdWx0aXBsZUZvcmJpZGRlbl0pIHtcbiAgICAgIHJldHVybiB0aGlzLmdldE11bHRpcGxlRm9yYmlkZGVuTWVzc2FnZSgpO1xuICAgIH1cblxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBwcm90ZWN0ZWQgbm90aWZ5Rm9ybVZhbHVlQ2hhbmdlZCgpIHtcbiAgICB0aGlzLmx1eFNlbGVjdGVkRmlsZXNDaGFuZ2UuZW1pdCh0aGlzLmx1eFNlbGVjdGVkRmlsZXMpO1xuXG4gICAgLy8gV2lyIGxlZXJlbiBuYWNoIGplZGVtIFZhbHVlLUNoYW5nZSBkYXMgSW5wdXQsIGRhIHdpciBkYXMgRm9ybUNvbnRyb2wgYmVyZWl0cyBhbHMgU1NvVCBiZXNpdHplblxuICAgIC8vIHVuZCBkYXMgSW5wdXQgZHVyY2ggZGVuIEJyb3dzZXIgZ2VsZWdlbnRsaWNoIHNvbnN0IGdlYmxvY2t0IHdlcmRlbiAod2VubiBlaW5lIERhdGVpIGF1c2dld8OkaGx0IHdvcmRlbiBpc3QpXG4gICAgdGhpcy5maWxldXBsb2FkSW5wdXQubmF0aXZlRWxlbWVudC52YWx1ZSA9IG51bGw7XG4gIH1cblxuICBwcm90ZWN0ZWQgdXBkYXRlVmFsaWRhdG9ycyh2YWxpZGF0b3JzOiBWYWxpZGF0b3JGbiB8IFZhbGlkYXRvckZuW10pIHtcbiAgICBpZiAoIXZhbGlkYXRvcnMgJiYgdGhpcy5sdXhSZXF1aXJlZCkge1xuICAgICAgdmFsaWRhdG9ycyA9IFZhbGlkYXRvcnMucmVxdWlyZWQ7XG4gICAgfVxuXG4gICAgc3VwZXIudXBkYXRlVmFsaWRhdG9ycyh2YWxpZGF0b3JzKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBpbml0Rm9ybVZhbHVlU3Vic2NyaXB0aW9uKCkge1xuICAgIHRoaXMuX2Zvcm1WYWx1ZUNoYW5nZVN1YnNjciA9IHRoaXMuZm9ybUNvbnRyb2wudmFsdWVDaGFuZ2VzLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAvLyBXZW5uIGRpZSBEYXRlaWVuIGVyZm9sZ3JlaWNoIGdlbGVzZW4gd2VyZGVuIGtvbm50ZW4sIGRpZSAoc3BlemlmaXNjaGVuKSBGZWhsZXIgZW50ZmVybmVuXG4gICAgICB0aGlzLmNsZWFyRm9ybUNvbnRyb2xFcnJvcnMoKTtcbiAgICB9KTtcblxuICAgIGlmICh0aGlzLl9pbml0aWFsVmFsdWUgIT09IG51bGwgJiYgdGhpcy5faW5pdGlhbFZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuc2V0VmFsdWUodGhpcy5faW5pdGlhbFZhbHVlKTtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgdHJpZ2dlck91dHB1dFBhdHRlcm5DaGVjaygpIHtcbiAgICB0aGlzLmNoZWNrT3V0cHV0UGF0dGVyblZpb2xhdGlvbih0aGlzLmx1eFNlbGVjdGVkRmlsZXNDaGFuZ2Uub2JzZXJ2ZXJzKTtcbiAgfVxuXG4gIHByb3RlY3RlZCB0cmlnZ2VySW5wdXRQYXR0ZXJuQ2hlY2soc2ltcGxlQ2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgIHRoaXMuY2hlY2tJbnB1dFBhdHRlcm5WaW9sYXRpb24oc2ltcGxlQ2hhbmdlcy5sdXhTZWxlY3RlZEZpbGVzKTtcbiAgfVxuXG4gIC8vIGVuZHJlZ2lvblxufVxuIl19